---
title: Funciones asincrónicas definidas por el usuario
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 142eb27e-fb6f-4da3-bfb7-a88115bbb5d5
description: 'Hace referencia a: Excel 2013 | Office 2013 | Visual Studio'
ms.openlocfilehash: 7fdf3bd09914981865c911fd65a78d044ad582f4
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/28/2019
ms.locfileid: "33412313"
---
# <a name="asynchronous-user-defined-functions"></a><span data-ttu-id="6daa0-103">Funciones asincrónicas definidas por el usuario</span><span class="sxs-lookup"><span data-stu-id="6daa0-103">Asynchronous user-defined functions</span></span>

<span data-ttu-id="6daa0-104">**Hace referencia a**: Excel 2013 | Office 2013 | Visual Studio</span><span class="sxs-lookup"><span data-stu-id="6daa0-104">**Applies to**: Excel 2013 | Office 2013 | Visual Studio</span></span> 
  
<span data-ttu-id="6daa0-105">Microsoft Excel 2013 puede llamar a funciones definidas por el usuario de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="6daa0-105">Microsoft Excel 2013 can call user-defined functions asynchronously.</span></span> <span data-ttu-id="6daa0-106">Llamar a las funciones de forma asincrónica puede mejorar el rendimiento al permitir que se ejecuten varios cálculos a la vez.</span><span class="sxs-lookup"><span data-stu-id="6daa0-106">Calling functions asynchronously can improve performance by allowing several calculations to run at the same time.</span></span> <span data-ttu-id="6daa0-107">Al ejecutar funciones definidas por el usuario en un clúster de cálculo, llamar a funciones asincrónicamente permite usar varios equipos para realizar los cálculos.</span><span class="sxs-lookup"><span data-stu-id="6daa0-107">When you run user-defined functions on a compute cluster, calling functions asynchronously enables several computers to be used to complete the calculations.</span></span>
  
## <a name="when-to-use-asynchronous-user-defined-functions"></a><span data-ttu-id="6daa0-108">Cuándo se deben usar las funciones asincrónicas definidas por el usuario</span><span class="sxs-lookup"><span data-stu-id="6daa0-108">When to use asynchronous user-defined functions</span></span>

<span data-ttu-id="6daa0-109">Algunas funciones definidas por el usuario deben esperar recursos externos.</span><span class="sxs-lookup"><span data-stu-id="6daa0-109">Some user-defined functions must wait for external resources.</span></span> <span data-ttu-id="6daa0-110">Mientras esperan, se bloquea el subproceso de cálculo de Excel.</span><span class="sxs-lookup"><span data-stu-id="6daa0-110">While they wait, the Excel calculation thread is blocked.</span></span> <span data-ttu-id="6daa0-111">En Excel 2013, las funciones definidas por el usuario pueden ejecutarse de forma asincrónica.</span><span class="sxs-lookup"><span data-stu-id="6daa0-111">In Excel 2013, user-defined functions can run asynchronously.</span></span> <span data-ttu-id="6daa0-112">Esto libera el subproceso de cálculo para que ejecute otros cálculos mientras la función definida por el usuario espera.</span><span class="sxs-lookup"><span data-stu-id="6daa0-112">This frees the calculation thread to run other calculations while the user-defined function waits.</span></span>
  
<span data-ttu-id="6daa0-113">En Excel 2007, los programadores podían ejecutar varias funciones definidas por el usuario al mismo tiempo, aumentando el número de subprocesos que se usaban en los cálculos de varios subprocesos.</span><span class="sxs-lookup"><span data-stu-id="6daa0-113">In Excel 2007, programmers could run multiple user-defined functions at the same time by increasing the number of threads used in multiple-thread recalculations.</span></span> <span data-ttu-id="6daa0-114">Este método tiene inconvenientes principalmente porque el número de subprocesos es una configuración de ámbito de una aplicación y no puede controlarse en el nivel de una sola función o de un complemento.</span><span class="sxs-lookup"><span data-stu-id="6daa0-114">This method has drawbacks primarily because the number of threads is a setting scoped to an application and cannot be controlled at the level of a single function or an add-in.</span></span>
  
<span data-ttu-id="6daa0-115">Los programadores deben usar llamadas a funciones asincrónicas definidas por el usuario cuando la función debe esperar los recursos externos.</span><span class="sxs-lookup"><span data-stu-id="6daa0-115">Programmers should use asynchronous user-defined function calls when the function must wait for external resources.</span></span> <span data-ttu-id="6daa0-116">Por ejemplo, una función que envía una solicitud SOAP a través de Internet debe esperar a que la red entregue la solicitud, al servidor remoto para completar la solicitud y a la red para que devuelva el resultado.</span><span class="sxs-lookup"><span data-stu-id="6daa0-116">For example, a function that sends a SOAP request over the Internet must wait for the network to deliver the request, the remote server to complete the request, and the network to return the result.</span></span> <span data-ttu-id="6daa0-117">En este caso, no se produce ninguna informática significativa y Excel puede continuar con otros cálculos.</span><span class="sxs-lookup"><span data-stu-id="6daa0-117">In this case, there is no significant computing occurring and Excel can continue with other calculations.</span></span>
  
<span data-ttu-id="6daa0-118">Los programadores también pueden usar funciones asincrónicas definidas por el usuario cuando una función envía solicitudes a un clúster de cálculo.</span><span class="sxs-lookup"><span data-stu-id="6daa0-118">Programmers can also use asynchronous user-defined functions when a function is sending requests to a compute cluster.</span></span> <span data-ttu-id="6daa0-119">En este caso, no solo hay que esperar la latencia de red, pero el clúster puede ejecutar llamadas independientes en servidores independientes.</span><span class="sxs-lookup"><span data-stu-id="6daa0-119">In this case, there is not only network latency to wait for, but the cluster can execute separate calls on separate servers.</span></span> <span data-ttu-id="6daa0-120">Al no esperar a que termine cada llamada, las llamadas se pueden superponer para mejorar el rendimiento.</span><span class="sxs-lookup"><span data-stu-id="6daa0-120">By not waiting for each call to finish, the calls can be overlapped to improve performance.</span></span> <span data-ttu-id="6daa0-121">En algunos casos, esta mejora es importante.</span><span class="sxs-lookup"><span data-stu-id="6daa0-121">In some cases this improvement is significant.</span></span>
  
> [!NOTE]
> <span data-ttu-id="6daa0-122">Las funciones definidas por el usuario no se pueden registrar como seguras tanto asincrónicas como de clúster.</span><span class="sxs-lookup"><span data-stu-id="6daa0-122">User-defined functions cannot be registered as both asynchronous and cluster safe.</span></span> 
  
## <a name="writing-an-asynchronous-user-defined-function"></a><span data-ttu-id="6daa0-123">Escritura de una función asincrónica definida por el usuario</span><span class="sxs-lookup"><span data-stu-id="6daa0-123">Writing an asynchronous user-defined function</span></span>

<span data-ttu-id="6daa0-124">Las funciones asincrónicas definidas por el usuario deben realizar un seguimiento de un controlador y usar dicho controlador cuando se informa a Excel de que la llamada a la función ha finalizado.</span><span class="sxs-lookup"><span data-stu-id="6daa0-124">Asynchronous user-defined functions must keep track of a handle and use that handle when informing Excel that the function call is finished.</span></span> <span data-ttu-id="6daa0-125">Una función asincrónica definida por el usuario se divide en dos partes.</span><span class="sxs-lookup"><span data-stu-id="6daa0-125">An asynchronous user-defined function is split into two pieces.</span></span> <span data-ttu-id="6daa0-126">La primera parte es el punto de entrada UDF estándar, que iniciará una segunda operación asincrónica independiente.</span><span class="sxs-lookup"><span data-stu-id="6daa0-126">The first piece is the standard UDF entry point, which will launch a second, separate asynchronous operation.</span></span> <span data-ttu-id="6daa0-127">Las deVoluciones de llamada en Excel deben realizarse durante el punto de entrada de UDF.</span><span class="sxs-lookup"><span data-stu-id="6daa0-127">Callbacks into Excel should be made during the UDF entry point.</span></span> <span data-ttu-id="6daa0-128">La primera parte que se inicia de la función devolverá el control de su subproceso de cálculo a Excel, que continuará el cálculo.</span><span class="sxs-lookup"><span data-stu-id="6daa0-128">The first launching portion of the function will then return control of its calculation thread to Excel, which will continue calculation.</span></span> <span data-ttu-id="6daa0-129">Una vez completada la segunda operación asincrónica, debe volver a llamar a Excel y proporcionar a Excel el resultado.</span><span class="sxs-lookup"><span data-stu-id="6daa0-129">When the second asynchronous operation is complete, it must call back into Excel and provide Excel with its result.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="6daa0-130">Cualquier argumento que se pasa a la UDF que necesita la parte asincrónica la función debe copiarse en profundidad porque Excel libera estos argumentos cuando se devuelve el punto de entrada de la FDU.</span><span class="sxs-lookup"><span data-stu-id="6daa0-130">Any arguments passed into the UDF that are needed by the asynchronous portion the function must be deep copied because Excel frees these arguments when the UDF entry point returns.</span></span> 
  
<span data-ttu-id="6daa0-131">Excel proporciona un conjunto de eventos que un complemento XLL puede usar para administrar el ciclo de vida de las llamadas a UDF asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="6daa0-131">Excel provides a set of events that an XLL add-in can use in order to manage the life cycle of asynchronous UDF calls.</span></span> <span data-ttu-id="6daa0-132">Estos eventos indican que Excel ha finalizado con cálculos o que se ha cancelado el cálculo.</span><span class="sxs-lookup"><span data-stu-id="6daa0-132">These events indicate that Excel is finished with calculations or that the calculation was canceled.</span></span>
  
### <a name="declaring-an-asynchronous-function"></a><span data-ttu-id="6daa0-133">Declaración de una función asincrónica</span><span class="sxs-lookup"><span data-stu-id="6daa0-133">Declaring an asynchronous function</span></span>

<span data-ttu-id="6daa0-134">Debe declarar las funciones definidas por el usuario asincrónicas como asincrónicas cuando se registran.</span><span class="sxs-lookup"><span data-stu-id="6daa0-134">You must declare asynchronous user-defined functions as asynchronous when they are registered.</span></span> <span data-ttu-id="6daa0-135">Esto se lleva a cabo agregando un parámetro que apunta a una estructura XLOPER12, representada por "X" en la cadena de tipo de registro, en cualquier lugar de la lista de parámetros de UDF.</span><span class="sxs-lookup"><span data-stu-id="6daa0-135">This is performed by adding a parameter that points to a XLOPER12 structure, represented by "X" in the registration type string, anywhere in the list of UDF parameters.</span></span> <span data-ttu-id="6daa0-136">Excel usa este parámetro para pasar el controlador de llamadas asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="6daa0-136">Excel uses this parameter to pass the asynchronous call handle.</span></span> <span data-ttu-id="6daa0-137">El complemento XLL debe pasar el controlador de la llamada asincrónica y el resultado de la función de vuelta a Excel cuando el resultado está listo.</span><span class="sxs-lookup"><span data-stu-id="6daa0-137">The XLL add-in must pass the asynchronous call handle and the result of the function back to Excel when the result is ready.</span></span> <span data-ttu-id="6daa0-138">Además, el tipo de valor devuelto de UDF debe ser **void**, designado por ">" como el primer carácter de la cadena de tipo.</span><span class="sxs-lookup"><span data-stu-id="6daa0-138">In addition, the return type of the UDF should be **void**, designated by ">" as the first character in the type string.</span></span> <span data-ttu-id="6daa0-139">El tipo de valor devuelto es void porque la parte sincrónica del UDF no devuelve un valor a Excel.</span><span class="sxs-lookup"><span data-stu-id="6daa0-139">The return type is void because the synchronous part of the UDF does not return a value to Excel.</span></span> <span data-ttu-id="6daa0-140">En su lugar, el complemento XLL devuelve un valor de forma asincrónica a través de una devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="6daa0-140">Instead, the XLL add-in returns a value asynchronously through a callback.</span></span> 
  
<span data-ttu-id="6daa0-141">Puede declarar las funciones asincrónicas como seguras para subprocesos y, a continuación, se usa la parte sincrónica de UDF en un recálculo multiproceso.</span><span class="sxs-lookup"><span data-stu-id="6daa0-141">You can declare asynchronous functions as thread-safe and then the synchronous part of the UDF is used in a multi-threaded recalculation.</span></span> 
  
<span data-ttu-id="6daa0-142">El siguiente ejemplo de código muestra una función definida por el usuario asincrónica registrada mediante "\>QX" como la cadena de tipo de registro:</span><span class="sxs-lookup"><span data-stu-id="6daa0-142">The following code example shows an asynchronous user-defined function registered by using "\>QX" as the registration type string:</span></span>
  
```cpp
void MyAsyncUDF(LPXLOPER12 arg1, LPXLOPER12 pxAsyncHandle)
{
…
}
```

### <a name="returning-values"></a><span data-ttu-id="6daa0-143">Devolver valores</span><span class="sxs-lookup"><span data-stu-id="6daa0-143">Returning values</span></span>

<span data-ttu-id="6daa0-144">Cuando el resultado de la llamada asincrónica está listo, el complemento XLL devuelve el resultado a Excel realizando una devolución de llamada de tipo [xlAsyncReturn](xlasyncreturn.md).</span><span class="sxs-lookup"><span data-stu-id="6daa0-144">When the result of the asynchronous call is ready, the XLL add-in returns the result to Excel by performing a callback of type [xlAsyncReturn](xlasyncreturn.md).</span></span>
  
<span data-ttu-id="6daa0-145">**xlAsyncReturn** es la única devolución de llamada que puede usar en los subprocesos que no son de cálculo durante la actualización.</span><span class="sxs-lookup"><span data-stu-id="6daa0-145">**xlAsyncReturn** is the only callback you can use on non-calculation threads during recalculation.</span></span> <span data-ttu-id="6daa0-146">Por lo tanto, la parte asincrónica de una UDF asincrónica no debe realizar ninguna otra devolución de llamada.</span><span class="sxs-lookup"><span data-stu-id="6daa0-146">Therefore, the asynchronous part of an asynchronous UDF should not perform any other callbacks.</span></span> 
  
### <a name="handling-events"></a><span data-ttu-id="6daa0-147">Administración de eventos</span><span class="sxs-lookup"><span data-stu-id="6daa0-147">Handling events</span></span>

<span data-ttu-id="6daa0-148">A partir de Excel 2010, los XLL pueden recibir eventos diseñados para administrar el ciclo de vida de la función asincrónica.</span><span class="sxs-lookup"><span data-stu-id="6daa0-148">Starting in Excel 2010, XLLs can receive events designed to manage the asynchronous function life cycle.</span></span> <span data-ttu-id="6daa0-149">Para obtener más información, vea [controlar eventos](handling-events.md).</span><span class="sxs-lookup"><span data-stu-id="6daa0-149">For more information, see [Handling Events](handling-events.md).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="6daa0-150">Ver también</span><span class="sxs-lookup"><span data-stu-id="6daa0-150">See also</span></span>

- [<span data-ttu-id="6daa0-151">Desarrollar archivos XLL de Excel</span><span class="sxs-lookup"><span data-stu-id="6daa0-151">Developing Excel XLLs</span></span>](developing-excel-xlls.md)

