---
title: Implementar el método FlushQueues
manager: soliver
ms.date: 03/09/2015
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 8719f8aa-a537-4253-b67d-c4d38c40472b
description: 'Última modificación: 09 de marzo de 2015'
ms.openlocfilehash: 1e5c78c71f7fddb04d3517aca0a34efa151ece08
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/28/2019
ms.locfileid: "33411781"
---
# <a name="implementing-the-flushqueues-method"></a><span data-ttu-id="53a6e-103">Implementar el método FlushQueues</span><span class="sxs-lookup"><span data-stu-id="53a6e-103">Implementing the FlushQueues Method</span></span>

  
  
<span data-ttu-id="53a6e-104">**Se aplica a**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="53a6e-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="53a6e-105">La cola MAPI usa el método [IXPLogon:: FlushQueues](ixplogon-flushqueues.md) para descargar y cargar todos los mensajes pendientes a y desde un proveedor de transporte.</span><span class="sxs-lookup"><span data-stu-id="53a6e-105">The MAPI spooler uses the [IXPLogon::FlushQueues](ixplogon-flushqueues.md) method to download and upload any pending messages to and from a transport provider.</span></span> <span data-ttu-id="53a6e-106">Normalmente, la cola de espera de MAPI vaciará las colas de todos los proveedores de transporte que hayan iniciado sesión en la sesión, empezando por el primer proveedor de transporte establecido en la sección orden de transporte del perfil del usuario.</span><span class="sxs-lookup"><span data-stu-id="53a6e-106">Typically, the MAPI spooler will flush the queues for all transport providers that are logged on to the session, starting with the first transport provider as set in the transport order section of the user's profile.</span></span> <span data-ttu-id="53a6e-107">Vaciar colas es casi siempre el resultado de una solicitud directa del usuario, por lo que el envío y la recepción de mensajes mientras se están vaciando las colas es sincrónico a la cola MAPI.</span><span class="sxs-lookup"><span data-stu-id="53a6e-107">Flushing queues is almost always the result of a direct request by the user, so the sending and receiving of messages while queues are flushing is synchronous to the MAPI spooler.</span></span> <span data-ttu-id="53a6e-108">Como estas llamadas son sincrónicas, el proveedor de transporte debería procesarlas tan rápido como sea posible.</span><span class="sxs-lookup"><span data-stu-id="53a6e-108">Because these calls are synchronous, the transport provider should process them as quickly as possible.</span></span> 
  
<span data-ttu-id="53a6e-109">Los proveedores de transporte deben administrar la llamada **FlushQueues** como se describe en la siguiente secuencia de pasos para habilitar el procesamiento adecuado de mensajes y habilitar recursos externos, como módems que pueden usar otros proveedores de transporte como parte de la cola MAPI del Operación **FlushQueues** .</span><span class="sxs-lookup"><span data-stu-id="53a6e-109">Transport providers must handle the **FlushQueues** call as described in the following sequence of steps to enable proper message processing and to enable external resources such as modems to be used by other transport providers as part of the MAPI spooler's **FlushQueues** operation.</span></span> 
  
|<span data-ttu-id="53a6e-110">**Paso**</span><span class="sxs-lookup"><span data-stu-id="53a6e-110">**Step**</span></span>|<span data-ttu-id="53a6e-111">**Componente**</span><span class="sxs-lookup"><span data-stu-id="53a6e-111">**Component**</span></span>|<span data-ttu-id="53a6e-112">**Implementación**</span><span class="sxs-lookup"><span data-stu-id="53a6e-112">**Implementation**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="53a6e-113">1.</span><span class="sxs-lookup"><span data-stu-id="53a6e-113">1.</span></span>  <br/> |<span data-ttu-id="53a6e-114">Cola MAPI</span><span class="sxs-lookup"><span data-stu-id="53a6e-114">MAPI spooler</span></span>  <br/> |<span data-ttu-id="53a6e-115">Llama al método **FlushQueues** para el primer proveedor de transporte enumerado en el orden de transporte del perfil del usuario, pasando los indicadores solicitados en el parámetro _ulFlags_ .</span><span class="sxs-lookup"><span data-stu-id="53a6e-115">Calls the **FlushQueues** method for the first transport provider listed in the transport order of the user's profile, passing the requested flags in the  _ulFlags_ parameter.</span></span> <span data-ttu-id="53a6e-116">Se llama a **FlushQueues** una vez con todos los indicadores establecidos para toda la operación de carga y descarga.</span><span class="sxs-lookup"><span data-stu-id="53a6e-116">**FlushQueues** is called once with all flags set for the entire upload and download operation.</span></span>  <br/> |
|<span data-ttu-id="53a6e-117">2.</span><span class="sxs-lookup"><span data-stu-id="53a6e-117">2.</span></span>  <br/> |<span data-ttu-id="53a6e-118">Proveedor de transporte</span><span class="sxs-lookup"><span data-stu-id="53a6e-118">Transport Provider</span></span>  <br/> |<span data-ttu-id="53a6e-119">Tiene que hacer una serie de cosas antes de volver de la llamada **FlushQueues** .</span><span class="sxs-lookup"><span data-stu-id="53a6e-119">Needs to do a number of things before returning from the **FlushQueues** call.</span></span> <span data-ttu-id="53a6e-120">Si se aplazan los mensajes enviados anteriormente, se debe llamar al método [IMAPISupport:: SpoolerNotify](imapisupport-spoolernotify.md) con el conjunto de marcas NOTIFY_SENT_DEFERRED.</span><span class="sxs-lookup"><span data-stu-id="53a6e-120">If previously submitted messages are being deferred, the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) method should be called with the NOTIFY_SENT_DEFERRED flag set.</span></span> <span data-ttu-id="53a6e-121">Tenga en cuenta que la cola MAPI puede cancelar un mensaje aplazado antes de que el proveedor de transporte tenga la oportunidad de finalizar el procesamiento del mensaje.</span><span class="sxs-lookup"><span data-stu-id="53a6e-121">Note that it is possible for the MAPI spooler to cancel a message that has been deferred before the transport provider has a chance to finish processing the message.</span></span>  <br/> <span data-ttu-id="53a6e-122">Si el proveedor de transporte usa un recurso externo, como un módem, se debe establecer la conexión con el recurso externo.</span><span class="sxs-lookup"><span data-stu-id="53a6e-122">If the transport provider uses an external resource such as a modem, the connection to the external resource should be established.</span></span>  <br/> <span data-ttu-id="53a6e-123">El bit STATUS_OUTBOUND_FLUSH de la propiedad **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) de la fila de estado del proveedor de transporte debe establecerse mediante el método [IMAPISupport:: ModifyStatusRow](imapisupport-modifystatusrow.md) .</span><span class="sxs-lookup"><span data-stu-id="53a6e-123">The STATUS_OUTBOUND_FLUSH bit in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of the transport provider's status row must be set using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span>  <br/> <span data-ttu-id="53a6e-124">El proveedor de transporte debería devolver S_OK para la llamada **FlushQueues** .</span><span class="sxs-lookup"><span data-stu-id="53a6e-124">The transport provider should then return S_OK for the **FlushQueues** call.</span></span>  <br/> |
|<span data-ttu-id="53a6e-125">3.</span><span class="sxs-lookup"><span data-stu-id="53a6e-125">3.</span></span>  <br/> |<span data-ttu-id="53a6e-126">Cola MAPI</span><span class="sxs-lookup"><span data-stu-id="53a6e-126">MAPI spooler</span></span>  <br/> |<span data-ttu-id="53a6e-127">Comprueba la fila de estado del proveedor de transporte para el bit STATUS_OUTBOUND_FLUSH y llama a [IXPLogon:: SubmitMessage](ixplogon-submitmessage.md) para el primer mensaje de la cola.</span><span class="sxs-lookup"><span data-stu-id="53a6e-127">Checks the transport provider's status row for the STATUS_OUTBOUND_FLUSH bit and calls [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) for the first message in the queue.</span></span>  <br/> |
|<span data-ttu-id="53a6e-128">4.</span><span class="sxs-lookup"><span data-stu-id="53a6e-128">4.</span></span>  <br/> |<span data-ttu-id="53a6e-129">Proveedor de transporte</span><span class="sxs-lookup"><span data-stu-id="53a6e-129">Transport provider</span></span>  <br/> |<span data-ttu-id="53a6e-130">Administra el mensaje y vuelve de la llamada de **SubmitMessage** .</span><span class="sxs-lookup"><span data-stu-id="53a6e-130">Handles the message and returns from the **SubmitMessage** call.</span></span>  <br/> |
|<span data-ttu-id="53a6e-131">5.</span><span class="sxs-lookup"><span data-stu-id="53a6e-131">5.</span></span>  <br/> |<span data-ttu-id="53a6e-132">Cola MAPI</span><span class="sxs-lookup"><span data-stu-id="53a6e-132">MAPI spooler</span></span>  <br/> |<span data-ttu-id="53a6e-133">Si el proveedor de transporte Devuelve S_OK desde **SubmitMessage**, la cola MAPI llama a [IXPLogon:: EndMessage](ixplogon-endmessage.md) para el mensaje como lo haría con el envío normal de mensajes.</span><span class="sxs-lookup"><span data-stu-id="53a6e-133">If the transport provider returns S_OK from **SubmitMessage**, the MAPI spooler calls [IXPLogon::EndMessage](ixplogon-endmessage.md) for the message as it does with regular message sending.</span></span>  <br/> <span data-ttu-id="53a6e-134">Si el proveedor de transporte devuelve un valor distinto de S_OK desde **SubmitMessage**, la cola MAPI controla el valor adecuadamente antes de llamar a **EndMessage**o a volver a llamar a **SubmitMessage** .</span><span class="sxs-lookup"><span data-stu-id="53a6e-134">If the transport provider returns a value other than S_OK from **SubmitMessage**, the MAPI spooler handles the value appropriately before calling **EndMessage**, or before calling **SubmitMessage** again.</span></span>  <br/> |
|<span data-ttu-id="53a6e-135">6.</span><span class="sxs-lookup"><span data-stu-id="53a6e-135">6.</span></span>  <br/> |<span data-ttu-id="53a6e-136">Proveedor de transporte</span><span class="sxs-lookup"><span data-stu-id="53a6e-136">Transport provider</span></span>  <br/> |<span data-ttu-id="53a6e-137">Devuelve de **EndMessage** con el estado de procesamiento de mensajes en el parámetro _lpulFlags_ .</span><span class="sxs-lookup"><span data-stu-id="53a6e-137">Returns from **EndMessage** with its message processing status in the  _lpulFlags_ parameter.</span></span>  <br/> |
|<span data-ttu-id="53a6e-138">7.</span><span class="sxs-lookup"><span data-stu-id="53a6e-138">7.</span></span>  <br/> |<span data-ttu-id="53a6e-139">Cola MAPI y proveedor de transporte</span><span class="sxs-lookup"><span data-stu-id="53a6e-139">MAPI spooler and transport provider</span></span>  <br/> |<span data-ttu-id="53a6e-140">El bucle**EndMessage** de **SubmitMessage**- continuará hasta que se hayan descargado todos los mensajes de la cola.</span><span class="sxs-lookup"><span data-stu-id="53a6e-140">The **SubmitMessage**- **EndMessage** loop continues until all messages in the queue have been downloaded.</span></span>  <br/> |
|<span data-ttu-id="53a6e-141">8.</span><span class="sxs-lookup"><span data-stu-id="53a6e-141">8.</span></span>  <br/> |<span data-ttu-id="53a6e-142">Cola MAPI</span><span class="sxs-lookup"><span data-stu-id="53a6e-142">MAPI spooler</span></span>  <br/> |<span data-ttu-id="53a6e-143">Notifica al proveedor de transporte que ha terminado de descargar mensajes llamando al método [IXPLogon:: TransportNotify](ixplogon-transportnotify.md) del proveedor de transporte con el indicador NOTIFY_END_OUTBOUND_FLUSH establecido.</span><span class="sxs-lookup"><span data-stu-id="53a6e-143">Notifies the transport provider that it has finished downloading messages by calling the transport provider's [IXPLogon::TransportNotify](ixplogon-transportnotify.md) method with the NOTIFY_END_OUTBOUND_FLUSH flag set.</span></span>  <br/> |
|<span data-ttu-id="53a6e-144">9.</span><span class="sxs-lookup"><span data-stu-id="53a6e-144">9.</span></span>  <br/> |<span data-ttu-id="53a6e-145">Proveedor de transporte</span><span class="sxs-lookup"><span data-stu-id="53a6e-145">Transport provider</span></span>  <br/> |<span data-ttu-id="53a6e-146">Libera los recursos externos usados para enviar mensajes salientes para que otros proveedores de transporte puedan usarlos para vaciar sus colas.</span><span class="sxs-lookup"><span data-stu-id="53a6e-146">Frees any external resources used in sending outbound messages so they can be used by other transport providers to flush their queues.</span></span>  <br/> <span data-ttu-id="53a6e-147">El bit STATUS_INBOUND_FLUSH de la propiedad **PR_STATUS_CODE** de la fila de estado del proveedor de transporte debe establecerse mediante **ModifyStatusRow**.</span><span class="sxs-lookup"><span data-stu-id="53a6e-147">The STATUS_INBOUND_FLUSH bit in the **PR_STATUS_CODE** property of the transport provider's status row must be set using **ModifyStatusRow**.</span></span>  <br/> |
|<span data-ttu-id="53a6e-148">10.</span><span class="sxs-lookup"><span data-stu-id="53a6e-148">10.</span></span>  <br/> |<span data-ttu-id="53a6e-149">Cola MAPI</span><span class="sxs-lookup"><span data-stu-id="53a6e-149">MAPI spooler</span></span>  <br/> |<span data-ttu-id="53a6e-150">Comprueba la fila de estado del proveedor de transporte para el bit STATUS_INBOUND_FLUSH y llama a [IXPLogon:: StartMessage](ixplogon-startmessage.md) si está establecida.</span><span class="sxs-lookup"><span data-stu-id="53a6e-150">Checks the transport provider's status row for the STATUS_INBOUND_FLUSH bit and calls [IXPLogon::StartMessage](ixplogon-startmessage.md) if it is set.</span></span>  <br/> |
|<span data-ttu-id="53a6e-151">11.</span><span class="sxs-lookup"><span data-stu-id="53a6e-151">11.</span></span>  <br/> |<span data-ttu-id="53a6e-152">Proveedor de transporte</span><span class="sxs-lookup"><span data-stu-id="53a6e-152">Transport provider</span></span>  <br/> |<span data-ttu-id="53a6e-153">Procesa el mensaje y vuelve de **StartMessage**.</span><span class="sxs-lookup"><span data-stu-id="53a6e-153">Processes the message and returns from **StartMessage**.</span></span> <span data-ttu-id="53a6e-154">Si el proveedor de transporte tiene otros mensajes que cargar, debe llamar a **SpoolerNotify** con el indicador NOTIFY_NEWMAIL establecido.</span><span class="sxs-lookup"><span data-stu-id="53a6e-154">If the transport provider has other messages to upload, it should call **SpoolerNotify** with the NOTIFY_NEWMAIL flag set.</span></span>  <br/> <span data-ttu-id="53a6e-155">Si el proveedor de transporte no tiene mensajes que cargar, debe llamar a [IMAPIProp:: SaveChanges](imapiprop-savechanges.md) en el mensaje que la cola MAPI pasa en **StartMessage** y volver.</span><span class="sxs-lookup"><span data-stu-id="53a6e-155">If the transport provider has no messages to upload, it should call [IMAPIProp::SaveChanges](imapiprop-savechanges.md) on the message the MAPI spooler passed in **StartMessage** and return.</span></span>  <br/> |
|<span data-ttu-id="53a6e-156">12.</span><span class="sxs-lookup"><span data-stu-id="53a6e-156">12.</span></span>  <br/> |<span data-ttu-id="53a6e-157">Cola MAPI</span><span class="sxs-lookup"><span data-stu-id="53a6e-157">MAPI spooler</span></span>  <br/> |<span data-ttu-id="53a6e-158">Sigue llamando a **StartMessage** hasta que se llama a **SaveChanges** en un mensaje.</span><span class="sxs-lookup"><span data-stu-id="53a6e-158">Continues calling **StartMessage** until **SaveChanges** is called on a message.</span></span> <span data-ttu-id="53a6e-159">Una vez finalizada la carga del proveedor de transporte, la cola MAPI llama a **TransportNotify** con el indicador NOTIFY_END_INBOUND_FLUSH establecido.</span><span class="sxs-lookup"><span data-stu-id="53a6e-159">After the transport provider has finished uploading, the MAPI spooler calls **TransportNotify** with the NOTIFY_END_INBOUND_FLUSH flag set.</span></span>  <br/> |
|<span data-ttu-id="53a6e-160">apartado.</span><span class="sxs-lookup"><span data-stu-id="53a6e-160">13.</span></span>  <br/> |<span data-ttu-id="53a6e-161">Proveedor de transporte</span><span class="sxs-lookup"><span data-stu-id="53a6e-161">Transport provider</span></span>  <br/> |<span data-ttu-id="53a6e-162">Borra el bit STATUS_INBOUND_FLUSH de la propiedad **PR_STATUS_CODE** de la fila de estado mediante **ModifyStatusRow** y libera todos los recursos externos para que estén disponibles para su uso por otros proveedores de transporte.</span><span class="sxs-lookup"><span data-stu-id="53a6e-162">Clears the STATUS_INBOUND_FLUSH bit in the **PR_STATUS_CODE** property of its status row using **ModifyStatusRow** and releases all external resources so they are available for use by other transport providers.</span></span>  <br/> |
|<span data-ttu-id="53a6e-163">apartado.</span><span class="sxs-lookup"><span data-stu-id="53a6e-163">14.</span></span>  <br/> |<span data-ttu-id="53a6e-164">Cola MAPI</span><span class="sxs-lookup"><span data-stu-id="53a6e-164">MAPI spooler</span></span>  <br/> |<span data-ttu-id="53a6e-165">Llama a **FlushQueues** para el siguiente proveedor de transporte que aparece en el orden de transporte del perfil del usuario.</span><span class="sxs-lookup"><span data-stu-id="53a6e-165">Calls **FlushQueues** for the next transport provider listed in the transport order of the user's profile.</span></span>  <br/> |
   
<span data-ttu-id="53a6e-166">Si una aplicación de cliente llama a [IMAPIStatus:: FlushQueues](imapistatus-flushqueues.md) en el objeto de estado de un proveedor de transporte, el proveedor de transporte debe establecer el bit apropiado en su fila de estado con **ModifyStatusRow**.</span><span class="sxs-lookup"><span data-stu-id="53a6e-166">If a client application calls [IMAPIStatus::FlushQueues](imapistatus-flushqueues.md) on a transport provider's status object, the transport provider should set the appropriate bit in its status row with **ModifyStatusRow**.</span></span> <span data-ttu-id="53a6e-167">A continuación, la cola MAPI llama al método **IXPLogon:: FlushQueues** del proveedor de transporte en la comodidad del administrador de trabajos de impresión MAPI.</span><span class="sxs-lookup"><span data-stu-id="53a6e-167">The MAPI spooler then calls the transport provider's **IXPLogon::FlushQueues** method at the MAPI spooler's convenience.</span></span> <span data-ttu-id="53a6e-168">Cuando se llama al método **IXPLogon:: FlushQueues** del proveedor de transporte como resultado de la llamada **IMAPIStatus:: FlushQueues** de una aplicación cliente, la operación se produce de forma asincrónica en la aplicación cliente.</span><span class="sxs-lookup"><span data-stu-id="53a6e-168">When the transport provider's **IXPLogon::FlushQueues** method is called as a result of a client application's **IMAPIStatus::FlushQueues** call, the operation occurs asynchronously to the client application.</span></span> <span data-ttu-id="53a6e-169">De lo contrario, **IXPLogon:: FlushQueues** funciona sincrónicamente con la cola MAPI.</span><span class="sxs-lookup"><span data-stu-id="53a6e-169">Otherwise **IXPLogon::FlushQueues** works synchronously with the MAPI spooler.</span></span> 
  
<span data-ttu-id="53a6e-170">Por motivos de rendimiento, la cola de impresión MAPI solo llamará al método **FlushQueues** de un proveedor de transporte si se establecen las marcas STATUS_INBOUND_FLUSH y STATUS_OUTBOUND_FLUSH en la fila de estado del proveedor de transporte.</span><span class="sxs-lookup"><span data-stu-id="53a6e-170">For performance reasons, the MAPI spooler will only call a transport provider's **FlushQueues** method if the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH flags are set in the transport provider's status row.</span></span> <span data-ttu-id="53a6e-171">Por lo tanto, un proveedor de transporte puede detener la operación **FlushQueues** en cualquier momento borrando los indicadores STATUS_OUTBOUND_FLUSH y STATUS_INBOUND_FLUSH en su fila de estado.</span><span class="sxs-lookup"><span data-stu-id="53a6e-171">Consequently, a transport provider can stop the **FlushQueues** operation at any time by clearing the STATUS_OUTBOUND_FLUSH and STATUS_INBOUND_FLUSH flags in its status row.</span></span> <span data-ttu-id="53a6e-172">Si la cola MAPI se está cerrando y necesita finalizar la operación **FlushQueues** , llama a **TransportNotify** con los indicadores NOTIFY_END_INBOUND_FLUSH y NOTIFY_END_OUTBOUND_FLUSH establecidos.</span><span class="sxs-lookup"><span data-stu-id="53a6e-172">If the MAPI spooler is shutting down and needs to end the **FlushQueues** operation, it calls **TransportNotify** with both the NOTIFY_END_INBOUND_FLUSH and NOTIFY_END_OUTBOUND_FLUSH flags set.</span></span> <span data-ttu-id="53a6e-173">El proveedor de transporte debe liberar todos los recursos externos y volver.</span><span class="sxs-lookup"><span data-stu-id="53a6e-173">The transport provider should release all external resources and return.</span></span> 
  

