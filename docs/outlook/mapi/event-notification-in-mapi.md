---
title: Notificación de eventos de MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 7b3b625b-6dea-4b12-99a9-152935bdfe39
description: 'Última modificación: 23 de julio de 2011'
ms.openlocfilehash: 30d4ad5e0fc1ecdc4c8eb06f75d39e38dd481269
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/23/2019
ms.locfileid: "32321402"
---
# <a name="event-notification-in-mapi"></a><span data-ttu-id="d3ff2-103">Notificación de eventos de MAPI</span><span class="sxs-lookup"><span data-stu-id="d3ff2-103">Event notification in MAPI</span></span>

<span data-ttu-id="d3ff2-104">**Se aplica a**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="d3ff2-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="d3ff2-105">La notificación de eventos es la comunicación de información entre dos objetos MAPI.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-105">Event notification is the communication of information between two MAPI objects.</span></span> <span data-ttu-id="d3ff2-106">A través de uno de los objetos, un cliente o proveedor de servicios se registra para la notificación de un cambio o error, denominado evento, que puede tener lugar en el otro objeto.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-106">Through one of the objects, a client or service provider registers for notification of a change or error, called an event, which may take place in the other object.</span></span> <span data-ttu-id="d3ff2-107">Después de que se produzca el evento, se notificará al primer objeto del cambio o error.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-107">After the event occurs, the first object is notified of the change or error.</span></span> <span data-ttu-id="d3ff2-108">El objeto que recibe la notificación se denomina receptor de notificaciones; el objeto responsable de la notificación se denomina el origen del aviso.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-108">The object receiving the notification is called the advise sink; the object responsible for the notification is called the advise source.</span></span>
  
<span data-ttu-id="d3ff2-109">Hay tres tipos de objetos receptores de aviso (todos los tipos son objetos MAPI estándar):</span><span class="sxs-lookup"><span data-stu-id="d3ff2-109">There are three types of advise sink objects (all types are standard MAPI objects):</span></span>
  
- <span data-ttu-id="d3ff2-110">Aconsejar objetos de receptor.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-110">Advise sink objects.</span></span>   
- <span data-ttu-id="d3ff2-111">Formulario aconseja objetos de receptor.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-111">Form advise sink objects.</span></span>  
- <span data-ttu-id="d3ff2-112">Ver objetos de receptor de aviso.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-112">View advise sink objects.</span></span>
    
<span data-ttu-id="d3ff2-113">Aconsejar que los objetos receptores sean el tipo más común.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-113">Advise sink objects are the most common type.</span></span> <span data-ttu-id="d3ff2-114">Las aplicaciones cliente suelen implementar receptores para recibir notificaciones de libreta de direcciones y almacén de mensajes y admitir la interfaz [IMAPIAdviseSink : IUnknown.](imapiadvisesinkiunknown.md)</span><span class="sxs-lookup"><span data-stu-id="d3ff2-114">Advise sinks are typically implemented by client applications to receive address book and message store notifications and support the [IMAPIAdviseSink : IUnknown](imapiadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="d3ff2-115">**IMAPIAdviseSink** contiene un único método, [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md).</span><span class="sxs-lookup"><span data-stu-id="d3ff2-115">**IMAPIAdviseSink** contains a single method, [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md).</span></span> <span data-ttu-id="d3ff2-116">Los receptores de aviso de formulario y vista son menos comunes; se implementan para recibir notificaciones sobre cambios en formularios personalizados.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-116">Form and view advise sinks are less common; they are implemented to receive notifications about changes to custom forms.</span></span> <span data-ttu-id="d3ff2-117">Los receptores de aviso de formulario admiten [la interfaz IMAPIFormAdviseSink: la interfaz IUnknown](imapiformadvisesinkiunknown.md) y los receptores de avisos de vista admiten la interfaz [IMAPIViewAdviseSink : IUnknown.](imapiviewadvisesinkiunknown.md)</span><span class="sxs-lookup"><span data-stu-id="d3ff2-117">Form advise sinks support the [IMAPIFormAdviseSink : IUnknown](imapiformadvisesinkiunknown.md) interface and view advise sinks support the [IMAPIViewAdviseSink : IUnknown](imapiviewadvisesinkiunknown.md) interface.</span></span> <span data-ttu-id="d3ff2-118">Dado que la mayoría de los clientes implementan objetos receptores de aviso estándar, supongamos que las discusiones de notificaciones se relacionan con notificaciones de libreta de direcciones y almacén de mensajes en lugar de notificaciones de formularios.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-118">Because most clients implement standard advise sink objects, assume that discussions of notifications relate to address book and message store notifications rather than forms notifications.</span></span> <span data-ttu-id="d3ff2-119">Para obtener más información acerca de las notificaciones de formularios, vea [MAPI Forms Notifications](mapi-forms-notifications.md) and [Writing Form Server Code](writing-form-server-code.md).</span><span class="sxs-lookup"><span data-stu-id="d3ff2-119">For more information about forms notifications, see [MAPI Forms Notifications](mapi-forms-notifications.md) and [Writing Form Server Code](writing-form-server-code.md).</span></span>
  
<span data-ttu-id="d3ff2-120">Aconseje que los proveedores de servicios y MAPI implementen los objetos de origen.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-120">Advise source objects are implemented by service providers and by MAPI.</span></span> <span data-ttu-id="d3ff2-121">No todos los proveedores de servicios admiten la notificación de eventos; es opcional, pero se recomienda encarecidamente.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-121">Not all service providers support event notification; it is optional, but strongly recommended.</span></span> <span data-ttu-id="d3ff2-122">Los proveedores de almacén de mensajes y libreta de direcciones suelen admitir notificaciones de objetos en varios de sus objetos y notificaciones de tabla en sus tablas de contenido y jerarquía.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-122">Message store and address book providers usually support object notifications on several of their objects and table notifications on their contents and hierarchy tables.</span></span> <span data-ttu-id="d3ff2-123">Los proveedores de transporte no admiten notificaciones directamente; se basan en métodos alternativos de comunicación con los clientes.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-123">Transport providers do not support notifications directly; they rely on alternative methods of communication with clients.</span></span>
  
<span data-ttu-id="d3ff2-124">A diferencia de los receptores de aviso, los objetos de origen de aviso no son un tipo único de objeto MAPI.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-124">Unlike advise sinks, advise source objects are not a unique type of MAPI object.</span></span> <span data-ttu-id="d3ff2-125">Muchos objetos MAPI, como almacenes de mensajes y tablas, pueden asumir el rol de origen de aviso.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-125">Many MAPI objects, such as message stores and tables, can take on the role of advise source.</span></span> <span data-ttu-id="d3ff2-126">Un origen de aviso es cualquier objeto MAPI que haga lo siguiente:</span><span class="sxs-lookup"><span data-stu-id="d3ff2-126">An advise source is any MAPI object that does the following:</span></span>
  
- <span data-ttu-id="d3ff2-127">Implementa un método **Advise** para recibir registros de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-127">Implements an **Advise** method to receive notification registrations.</span></span> 
    
- <span data-ttu-id="d3ff2-128">Implementa un método **Unadvise** para recibir cancelaciones de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-128">Implements an **Unadvise** method to receive notification cancellations.</span></span> 
    
- <span data-ttu-id="d3ff2-129">Genera notificaciones del tipo adecuado a los objetos receptores de aviso adecuados que se han registrado llamando a sus **métodos IMAPIAdviseSink::OnNotify.**</span><span class="sxs-lookup"><span data-stu-id="d3ff2-129">Generates notifications of the appropriate type to the appropriate advise sink objects that have registered by calling their **IMAPIAdviseSink::OnNotify** methods.</span></span> 
    
<span data-ttu-id="d3ff2-130">Los clientes que implementan objetos receptores de avisos llaman a **Advise** cuando quieren registrarse para una notificación, en la mayoría de los casos pasando el identificador de entrada del objeto con el que debe producirse el registro y **Unadvise** cuando quieren cancelar el registro.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-130">Clients that implement advise sink objects call **Advise** when they want to register for a notification, in most cases passing in the entry identifier of the object with which registration should occur, and **Unadvise** when they want to cancel the registration.</span></span> <span data-ttu-id="d3ff2-131">Los clientes pasan un parámetro **a Advise** que indica cuál de los varios tipos de eventos que desea supervisar.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-131">Clients pass a parameter to **Advise** that indicates which of the several types of events they want to monitor.</span></span> <span data-ttu-id="d3ff2-132">**Advise** devuelve un número distinto de cero que representa una conexión correcta entre el receptor de avisos y el origen de aviso.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-132">**Advise** returns a nonzero number that represents a successful connection between the advise sink and advise source.</span></span> 
  
<span data-ttu-id="d3ff2-133">Antes de llamar a **Advise,** los clientes pueden determinar si un proveedor de almacén de mensajes admite notificaciones comprobando que la marca STORE_NOTIFY_OK está establecida en la propiedad PR_STORE_SUPPORT_MASK **(** [PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) del almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-133">Before calling **Advise**, clients can determine whether a message store provider supports notification by checking that the STORE_NOTIFY_OK flag is set in the message store's **PR_STORE_SUPPORT_MASK** ([PidTagStoreSupportMask](pidtagstoresupportmask-canonical-property.md)) property.</span></span> <span data-ttu-id="d3ff2-134">No hay manera de que los clientes determinen con antelación si un proveedor de libreta de direcciones admite o no notificaciones.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-134">There is no way for clients to determine ahead of time whether or not an address book provider supports notifications.</span></span> <span data-ttu-id="d3ff2-135">Los clientes deben intentar registrarse y, si se produce un error en el intento, pueden asumir que las notificaciones no son compatibles.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-135">Clients must attempt to register and if the attempt fails, they can assume notifications are unsupported.</span></span>
  
<span data-ttu-id="d3ff2-136">Cuando se produce un evento para el que se ha registrado un cliente, el origen del aviso notifica al receptor de notificaciones llamando a su método [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) con una estructura de datos de notificación que contiene información sobre el evento.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-136">When an event for which a client has registered occurs, the advise source notifies the advise sink by calling its [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) method with a notification data structure that contains information about the event.</span></span> <span data-ttu-id="d3ff2-137">La implementación de **OnNotify** de un receptor de notificaciones puede realizar tareas en respuesta a la notificación, como actualizar datos en la memoria o actualizar una pantalla.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-137">An advise sink's implementation of **OnNotify** can perform tasks in response to the notification, such as updating data in memory or refreshing a screen display.</span></span> 
  
<span data-ttu-id="d3ff2-138">Los proveedores de servicios pueden implementar la compatibilidad con las notificaciones manualmente o aprovechar la ayuda proporcionada en tres métodos **IMAPISupport:** [IMAPISupport::Subscribe](imapisupport-subscribe.md), [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md)y [IMAPISupport::Notify](imapisupport-notify.md).</span><span class="sxs-lookup"><span data-stu-id="d3ff2-138">Service providers can implement support for notifications manually or take advantage of the help provided in three **IMAPISupport** methods: [IMAPISupport::Subscribe](imapisupport-subscribe.md), [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md), and [IMAPISupport::Notify](imapisupport-notify.md).</span></span> <span data-ttu-id="d3ff2-139">Los **métodos Subscribe** y **Unsubscribe** controlan el registro y la anulación de registro de notificaciones para los proveedores; el **método Notify** controla el envío de notificaciones cuando corresponda.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-139">The **Subscribe** and **Unsubscribe** methods handle notification registration and deregistration for providers; the **Notify** method handles sending notifications when appropriate.</span></span> 
  
<span data-ttu-id="d3ff2-140">Para usar los métodos de objeto de soporte técnico para el registro de notificaciones, los proveedores de servicios llaman a [IMAPISupport::Subscribe](imapisupport-subscribe.md) en sus métodos **Advise** y pasan a **Subscribe** el puntero del receptor de notificaciones que los clientes pasan a **Advise**.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-140">To use the support object methods for notification registration, service providers call [IMAPISupport::Subscribe](imapisupport-subscribe.md) in their **Advise** methods and pass to **Subscribe** the advise sink pointer that clients pass to **Advise**.</span></span> <span data-ttu-id="d3ff2-141">Si se pasa un identificador de entrada como parámetro de entrada para especificar un origen de aviso, los proveedores de servicios lo convierten en una clave binaria.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-141">If an entry identifier is passed as an input parameter to specify an advise source, service providers convert it to a binary key.</span></span> <span data-ttu-id="d3ff2-142">**Subscribe** crea un número de conexión único y es este número el que los proveedores de servicios devuelven a los clientes.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-142">**Subscribe** creates a unique connection number and it is this number that service providers return to clients.</span></span> <span data-ttu-id="d3ff2-143">Los proveedores de servicios pueden liberar el puntero de objeto de receptor de aviso del cliente en cualquier momento después de **que** se haya completado la llamada advise.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-143">Service providers can release the client's advise sink object pointer at any time after the **Advise** call has completed.</span></span> 
  
<span data-ttu-id="d3ff2-144">Cuando los clientes llaman a **Unadvise** para cancelar un registro, los proveedores de servicios disminuyen el número de referencias en el puntero receptor de aviso del cliente o llaman a **Cancelar** suscripción para hacer lo mismo.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-144">When clients call **Unadvise** to cancel a registration, service providers either decrement the reference count on the client's advise sink pointer or call **Unsubscribe** to do the same.</span></span> 
  
<span data-ttu-id="d3ff2-145">Cuando es el momento de generar una notificación, los proveedores de servicios realizan cualquier procesamiento interno relacionado con la notificación e inicializan una estructura [notification](notification.md) estableciendo todos sus miembros no usados en cero.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-145">When it is time to generate a notification, service providers perform any internal processing that relates to the notification and initializes a [NOTIFICATION](notification.md) structure by setting all of its unused members to zero.</span></span> <span data-ttu-id="d3ff2-146">Esta técnica para inicializar la estructura **notification** puede ayudar a los clientes a crear implementaciones **onNotify** más pequeñas, rápidas y menos propensas a errores.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-146">This technique for initializing the **NOTIFICATION** structure can help clients create smaller, faster, and less error-prone **OnNotify** implementations.</span></span> 
  
<span data-ttu-id="d3ff2-147">En la siguiente ilustración se muestra la comunicación entre los objetos de receptor advise, advise source objects y MAPI.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-147">The following illustration shows the communication between advise sink objects, advise source objects, and MAPI.</span></span> <span data-ttu-id="d3ff2-148">MAPI solo interviene cuando el origen del aviso llama a los **métodos IMAPISupport** para la compatibilidad con notificaciones.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-148">MAPI is involved only when the advise source calls the **IMAPISupport** methods for notification support.</span></span> 
  
<span data-ttu-id="d3ff2-149">**Llamadas de notificación de eventos**</span><span class="sxs-lookup"><span data-stu-id="d3ff2-149">**Event notification calls**</span></span>
  
<span data-ttu-id="d3ff2-150">![Llamadas de notificación de eventos Llamadas]de notificación de(media/amapi_51.gif "eventos")</span><span class="sxs-lookup"><span data-stu-id="d3ff2-150">![Event notification calls](media/amapi_51.gif "Event notification calls")</span></span>
  
<span data-ttu-id="d3ff2-151">La clase **CAdviseSink** de MFCMAPI (mediante los archivos AdviseSink.h y AdviseSink.cpp) implementa el objeto de receptor advise para todas las llamadas a **Advise**.</span><span class="sxs-lookup"><span data-stu-id="d3ff2-151">The MFCMAPI **CAdviseSink** class (using the AdviseSink.h and AdviseSink.cpp files) implements the advise sink object for all calls to **Advise**.</span></span> <span data-ttu-id="d3ff2-152">Para obtener más información acerca de MFCMAPI, vea [MFCMAPI como un ejemplo de código](mfcmapi-as-a-code-sample.md) y [MFCMAPI](https://go.microsoft.com/fwlink/?LinkId=124154).</span><span class="sxs-lookup"><span data-stu-id="d3ff2-152">For more information about MFCMAPI, see [MFCMAPI as a Code Sample](mfcmapi-as-a-code-sample.md) and [MFCMAPI](https://go.microsoft.com/fwlink/?LinkId=124154).</span></span>
  

