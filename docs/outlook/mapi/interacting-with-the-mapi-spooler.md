---
title: Interacción con la cola MAPI
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 5cc1d0a8-ad23-4173-b220-b7c0169073fa
description: 'Última modificación: 23 de julio de 2011'
ms.openlocfilehash: da94347dcb47e5fdbd4a6c1d404b795f4f7938ab
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/23/2019
ms.locfileid: "32317209"
---
# <a name="interacting-with-the-mapi-spooler"></a><span data-ttu-id="5f89f-103">Interacción con la cola MAPI</span><span class="sxs-lookup"><span data-stu-id="5f89f-103">Interacting with the MAPI Spooler</span></span>

  
  
<span data-ttu-id="5f89f-104">**Se aplica a**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="5f89f-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="5f89f-105">La cola MAPI usa los métodos de la interfaz [IXPLogon: IUnknown](ixplogoniunknown.md) al llamar al proveedor de transporte.</span><span class="sxs-lookup"><span data-stu-id="5f89f-105">The methods in the [IXPLogon : IUnknown](ixplogoniunknown.md) interface are used by the MAPI spooler when calling the transport provider.</span></span> <span data-ttu-id="5f89f-106">Para la mayoría de los tipos de proveedores de transporte, es necesario que implementen la mayoría de estos métodos para que vuelvan rápidamente.</span><span class="sxs-lookup"><span data-stu-id="5f89f-106">It should be possible for most types of transport providers to implement most of these methods so that they return quickly.</span></span> <span data-ttu-id="5f89f-107">Esto es conveniente porque, si un método tarda mucho tiempo en volver, se debe dividir con las llamadas de vuelta a la cola MAPI para liberar la CPU de otras tareas.</span><span class="sxs-lookup"><span data-stu-id="5f89f-107">This is desirable because if a method takes a long time to return then it should be broken up with calls back to the MAPI spooler to release the CPU for other tasks.</span></span> 
  
<span data-ttu-id="5f89f-108">La cola MAPI realiza su trabajo y realiza sus llamadas a los proveedores de transporte cuando las aplicaciones de primer plano están inactivas.</span><span class="sxs-lookup"><span data-stu-id="5f89f-108">The MAPI spooler does its work and makes its calls to transport providers when foreground applications are idle.</span></span> <span data-ttu-id="5f89f-109">Después de mostrar de forma opcional los cuadros de diálogo cuando el proveedor de transporte inicia sesión por primera vez (regido por marcas pasadas de MAPI al proveedor de transporte), los proveedores de transporte operan en segundo plano a menos que el cliente lo llame para vaciar las colas de envío y recepción.</span><span class="sxs-lookup"><span data-stu-id="5f89f-109">After optionally displaying dialog boxes when the transport provider is first logged on (governed by flags passed from MAPI to the transport provider), transport providers operate in the background unless called by the client to flush send and receive queues.</span></span> <span data-ttu-id="5f89f-110">Vaciar colas es la única vez que un proveedor de transporte no necesita liberar la CPU y, a continuación, solo si se informa al usuario de que una acción potencialmente prolongada está en curso.</span><span class="sxs-lookup"><span data-stu-id="5f89f-110">Flushing queues is the only time that a transport provider need not release the CPU, and then only if the user is informed that a potentially long action is in progress.</span></span> <span data-ttu-id="5f89f-111">La cola MAPI suele solicitar que un proveedor de transporte vacíe sus colas en respuesta a una acción del usuario, por lo que el proveedor de transporte no suele tener que hacer nada para asegurarse de que se informa al usuario.</span><span class="sxs-lookup"><span data-stu-id="5f89f-111">The MAPI spooler typically requests that a transport provider flush its queues in response to a user action, so the transport provider typically does not need to do anything to ensure that the user is informed.</span></span>
  
<span data-ttu-id="5f89f-112">Un proveedor de transporte puede decidir por separado vaciar una cola y usar los bits STATUS_INBOUND_FLUSH y STATUS_OUTBOUND_FLUSH en la propiedad **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) de su fila de estado para informar a la cola MAPI que desea atención para que pueda llevarse a cabo el trabajo.</span><span class="sxs-lookup"><span data-stu-id="5f89f-112">A transport provider can independently decide to flush a queue and use the STATUS_INBOUND_FLUSH and STATUS_OUTBOUND_FLUSH bits in the **PR_STATUS_CODE** ([PidTagStatusCode](pidtagstatuscode-canonical-property.md)) property of its status row to inform the MAPI spooler that it wants attention so that it can get the job done.</span></span> <span data-ttu-id="5f89f-113">La fila de estado se actualiza con el método [IMAPISupport:: ModifyStatusRow](imapisupport-modifystatusrow.md) .</span><span class="sxs-lookup"><span data-stu-id="5f89f-113">The status row is updated using the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> <span data-ttu-id="5f89f-114">En este caso, el proveedor de transporte probablemente debería mostrar un indicador de progreso u otra interfaz para informar al usuario de que se está produciendo una acción de larga duración.</span><span class="sxs-lookup"><span data-stu-id="5f89f-114">In this case the transport provider should probably display a progress indicator or other interface to inform the user that a long action is occuring.</span></span> 
  
<span data-ttu-id="5f89f-115">Dado que la actividad de red suele tardar más de 0,2 segundos, los proveedores de transporte deben, siempre que sea posible, usar solicitudes de red asincrónicas.</span><span class="sxs-lookup"><span data-stu-id="5f89f-115">Since network activity often takes more than 0.2 seconds, transport providers should, whenever possible, use asynchronous network requests.</span></span> <span data-ttu-id="5f89f-116">Esto les permite iniciar una solicitud, liberar la CPU al volver a llamar a la cola de espera de MAPI y, cuando vuelva a proporcionar el administrador de cola MAPI, para comprobar si se ha completado la solicitud de red.</span><span class="sxs-lookup"><span data-stu-id="5f89f-116">This enables them to initiate a request, release the CPU by calling back to the MAPI spooler, and when the MAPI spooler again gives them control, to check to see if their network request has completed.</span></span> <span data-ttu-id="5f89f-117">Si aún no se ha completado, vuelven a liberar la CPU mediante la devolución de llamada a la cola MAPI con el método [IMAPISupport:: SpoolerYield](imapisupport-spooleryield.md) .</span><span class="sxs-lookup"><span data-stu-id="5f89f-117">If it has not yet completed, they again release the CPU by calling back to the MAPI spooler with the [IMAPISupport::SpoolerYield](imapisupport-spooleryield.md) method.</span></span> 
  
<span data-ttu-id="5f89f-118">Durante el procesamiento de mensajes, entre [IXPLogon:: SubmitMessage](ixplogon-submitmessage.md) y [IXPLogon:: EndMessage](ixplogon-endmessage.md) y durante la [IXPLogon:: StartMessage](ixplogon-startmessage.md), el proveedor de transporte suele realizar muchas llamadas en objetos expuestos por la cola MAPI.</span><span class="sxs-lookup"><span data-stu-id="5f89f-118">During message processing, between [IXPLogon::SubmitMessage](ixplogon-submitmessage.md) and [IXPLogon::EndMessage](ixplogon-endmessage.md) and during [IXPLogon::StartMessage](ixplogon-startmessage.md), the transport provider typically makes many calls on objects exposed to it by the MAPI spooler.</span></span> <span data-ttu-id="5f89f-119">Como parte de su control de estos objetos, la cola MAPI ayuda al proveedor de transporte a que se comporte de manera adecuada como un proceso en segundo plano al proporcionar por sí solo cuando sea necesario.</span><span class="sxs-lookup"><span data-stu-id="5f89f-119">As part of its handling of these objects, the MAPI spooler helps the transport provider behave appropriately as a background process by yielding on its own when appropriate.</span></span> <span data-ttu-id="5f89f-120">Un proveedor de transporte que requiera un procesamiento de tiempo crítico puede declarar una sección crítica a la cola MAPI mediante el método de objeto de compatibilidad [IMAPISupport:: SpoolerNotify](imapisupport-spoolernotify.md) .</span><span class="sxs-lookup"><span data-stu-id="5f89f-120">A transport provider requiring time-critical processing can declare a critical section to the MAPI spooler using the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) support object method.</span></span> <span data-ttu-id="5f89f-121">En este caso, la CPU solo se publica en llamadas **SpoolerYield** realizadas por el proveedor de transporte hasta que el proveedor de transporte finalice el procesamiento de secciones críticas con otra llamada a **SpoolerNotify**.</span><span class="sxs-lookup"><span data-stu-id="5f89f-121">In this case, the CPU is released only on explicit **SpoolerYield** calls by the transport provider until the transport provider ends critical section processing with another call to **SpoolerNotify**.</span></span>
  
> [!NOTE]
> <span data-ttu-id="5f89f-122">No es lo mismo que una sección crítica de Win32.</span><span class="sxs-lookup"><span data-stu-id="5f89f-122">This is not the same as a Win32 critical section.</span></span> <span data-ttu-id="5f89f-123">Esto solo debe realizarse cuando el proveedor de transporte necesite control en tiempo real de recursos externos, como la lectura de datos entrantes de una línea de fax.</span><span class="sxs-lookup"><span data-stu-id="5f89f-123">This should only be done when the transport provider needs real-time control of external resources such as reading incoming data from a fax line.</span></span> <span data-ttu-id="5f89f-124">Puesto que esto eleva la prioridad del proceso de cola MAPI y puede provocar que la estación de trabajo deje de responder durante la operación, es aconsejable notificar al usuario que se está llevando a cabo una acción potencialmente larga y proporcionar un indicador de progreso si es posible.</span><span class="sxs-lookup"><span data-stu-id="5f89f-124">Since this raises the priority of the MAPI spooler process and can cause the workstation to be unresponsive for the duration of the operation, it is a good idea to notify the user that a potentially long action is underway and provide a progress indicator if possible.</span></span> 
  

