---
title: Abrir un archivo adjunto
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: c0350698-5304-40cd-903d-279471f3c226
description: 'Última modificación: 23 de julio de 2011'
ms.openlocfilehash: 768528c59d7aa5888c0d0427f86b8be8e1d33669
ms.sourcegitcommit: 0cf39e5382b8c6f236c8a63c6036849ed3527ded
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 08/23/2018
ms.locfileid: "22579980"
---
# <a name="opening-an-attachment"></a><span data-ttu-id="b5e15-103">Abrir un archivo adjunto</span><span class="sxs-lookup"><span data-stu-id="b5e15-103">Opening an attachment</span></span>

<span data-ttu-id="b5e15-104">**Se aplica a**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="b5e15-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="b5e15-105">Abrir un archivo adjunto implica la visualización de sus datos.</span><span class="sxs-lookup"><span data-stu-id="b5e15-105">Opening an attachment involves displaying its data.</span></span> <span data-ttu-id="b5e15-106">Por ejemplo, cuando se abre un archivo adjunto, se muestra el contenido del archivo.</span><span class="sxs-lookup"><span data-stu-id="b5e15-106">For example, when a file attachment is opened, the contents of the file are displayed.</span></span> <span data-ttu-id="b5e15-107">Mientras que los mensajes y las carpetas se abren con sus identificadores de entrada, los datos adjuntos se abren utilizando sus números de datos adjuntos: propiedades **PR_ATTACH_NUM** .</span><span class="sxs-lookup"><span data-stu-id="b5e15-107">Whereas messages and folders are opened using their entry identifiers, attachments are opened using their attachment numbers — **PR_ATTACH_NUM** properties.</span></span> <span data-ttu-id="b5e15-108">Para obtener más información, vea **PR_ATTACH_NUM** ([PidTagAttachNumber](pidtagattachnumber-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="b5e15-108">For more information, see **PR_ATTACH_NUM** ([PidTagAttachNumber](pidtagattachnumber-canonical-property.md)).</span></span> <span data-ttu-id="b5e15-109">Los números de los datos adjuntos están disponibles a través de la tabla de datos adjuntos de un mensaje.</span><span class="sxs-lookup"><span data-stu-id="b5e15-109">Attachment numbers are available through a message's attachment table.</span></span>
  
### <a name="to-open-all-attachments-in-a-message"></a><span data-ttu-id="b5e15-110">Para abrir todos los datos adjuntos en un mensaje</span><span class="sxs-lookup"><span data-stu-id="b5e15-110">To open all attachments in a message</span></span>
  
1. <span data-ttu-id="b5e15-111">Llamar al método [IMessage::GetAttachmentTable](imessage-getattachmenttable.md) del mensaje para obtener acceso a su tabla de datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="b5e15-111">Call the message's [IMessage::GetAttachmentTable](imessage-getattachmenttable.md) method to access its attachment table.</span></span> 
    
2. <span data-ttu-id="b5e15-112">Llame a [HrQueryAllRows](hrqueryallrows.md) para recuperar todas las filas de la tabla.</span><span class="sxs-lookup"><span data-stu-id="b5e15-112">Call [HrQueryAllRows](hrqueryallrows.md) to retrieve all the rows in the table.</span></span> 
    
3. <span data-ttu-id="b5e15-113">Para cada fila:</span><span class="sxs-lookup"><span data-stu-id="b5e15-113">For each row:</span></span> 
    
    1. <span data-ttu-id="b5e15-114">Abra los datos adjuntos, pase el número de datos adjuntos que se representan en la columna **PR_ATTACH_NUM** en una llamada al método **IMessage::OpenAttach** del mensaje.</span><span class="sxs-lookup"><span data-stu-id="b5e15-114">Open the attachment by passing the attachment number represented in the **PR_ATTACH_NUM** column in a call to the message's **IMessage::OpenAttach** method.</span></span> <span data-ttu-id="b5e15-115">Para obtener más información, vea [IMessage::OpenAttach](imessage-openattach.md).</span><span class="sxs-lookup"><span data-stu-id="b5e15-115">For more information, see [IMessage::OpenAttach](imessage-openattach.md).</span></span> <span data-ttu-id="b5e15-116">**OpenAttach** devuelve un puntero a una implementación de **IAttach** que proporciona acceso a las propiedades de los datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="b5e15-116">**OpenAttach** returns a pointer to an **IAttach** implementation that provides access to attachment properties.</span></span> 
        
    2. <span data-ttu-id="b5e15-117">Llamar al método **IMAPIProp::GetProps** de los datos adjuntos para recuperar su propiedad **PR_ATTACH_METHOD** .</span><span class="sxs-lookup"><span data-stu-id="b5e15-117">Call the attachment's **IMAPIProp::GetProps** method to retrieve its **PR_ATTACH_METHOD** property.</span></span> <span data-ttu-id="b5e15-118">Para obtener más información, vea [IMAPIProp::GetProps](imapiprop-getprops.md) y **PR_ATTACH_METHOD** ([PidTagAttachMethod](pidtagattachmethod-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="b5e15-118">For more information, see [IMAPIProp::GetProps](imapiprop-getprops.md) and **PR_ATTACH_METHOD** ([PidTagAttachMethod](pidtagattachmethod-canonical-property.md)).</span></span>
        
    3. <span data-ttu-id="b5e15-119">Si se establece **PR_ATTACH_METHOD** en ATTACH_BY_REF_ONLY, llame a **IMAPIProp::GetProps** para recuperar la propiedad **PR_ATTACH_PATHNAME** .</span><span class="sxs-lookup"><span data-stu-id="b5e15-119">If **PR_ATTACH_METHOD** is set to ATTACH_BY_REF_ONLY, call **IMAPIProp::GetProps** to retrieve the **PR_ATTACH_PATHNAME** property.</span></span> <span data-ttu-id="b5e15-120">Para obtener más información, vea **PR_ATTACH_PATHNAME** ([PidTagAttachPathname](pidtagattachpathname-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="b5e15-120">For more information, see **PR_ATTACH_PATHNAME** ([PidTagAttachPathname](pidtagattachpathname-canonical-property.md)).</span></span>
        
    4. <span data-ttu-id="b5e15-121">Si **PR\_ATTACH_METHOD** está establecida en ATTACH\_BY_VALUE, llame a **IMAPIProp::OpenProperty** para abrir el **PR\_ATTACH_DATA_BIN** (propiedad) con la interfaz **IStream** .</span><span class="sxs-lookup"><span data-stu-id="b5e15-121">If **PR\_ATTACH_METHOD** is set to ATTACH\_BY_VALUE, call **IMAPIProp::OpenProperty** to open the **PR\_ATTACH_DATA_BIN** property with the **IStream** interface.</span></span> <span data-ttu-id="b5e15-122">Vea el código de ejemplo, siga este procedimiento.</span><span class="sxs-lookup"><span data-stu-id="b5e15-122">See the sample code following this procedure.</span></span> <span data-ttu-id="b5e15-123">Para obtener más información, vea [IMAPIProp::OpenProperty](imapiprop-openproperty.md) y **PR_ATTACH_DATA_BIN** ([PidTagAttachDataBinary](pidtagattachdatabinary-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="b5e15-123">For more information, see [IMAPIProp::OpenProperty](imapiprop-openproperty.md) and **PR_ATTACH_DATA_BIN** ([PidTagAttachDataBinary](pidtagattachdatabinary-canonical-property.md)).</span></span>
        
    5. <span data-ttu-id="b5e15-124">Si se establece **PR_ATTACH_METHOD** en ATTACH_OLE y los datos adjuntos es un objeto OLE 2:</span><span class="sxs-lookup"><span data-stu-id="b5e15-124">If **PR_ATTACH_METHOD** is set to ATTACH_OLE and the attachment is an OLE 2 object:</span></span> 
        
        1. <span data-ttu-id="b5e15-125">Llame a **IMAPIProp::OpenProperty** para abrir el **PR\_ATTACH_DATA_OBJ** (propiedad) con la interfaz **IStreamDocfile** .</span><span class="sxs-lookup"><span data-stu-id="b5e15-125">Call **IMAPIProp::OpenProperty** to open the **PR\_ATTACH_DATA_OBJ** property with the **IStreamDocfile** interface.</span></span> <span data-ttu-id="b5e15-126">Intenta utilizar esta interfaz porque es una implementación de **IStream** garantizada que funcionen con almacenamiento estructurado con la menor cantidad de sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="b5e15-126">Attempt to use this interface because it is an implementation of **IStream** guaranteed to work with structured storage with the least amount of overhead.</span></span> <span data-ttu-id="b5e15-127">Para obtener más información, vea **PR_ATTACH_DATA_OBJ** ([PidTagAttachDataObject](pidtagattachdataobject-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="b5e15-127">For more information, see **PR_ATTACH_DATA_OBJ** ([PidTagAttachDataObject](pidtagattachdataobject-canonical-property.md)).</span></span>
            
        2. <span data-ttu-id="b5e15-128">Si se produce un error en la llamada **OpenProperty** , llame al nuevo para recuperar la propiedad **PR_ATTACH_DATA_BIN** con la interfaz **IStreamDocfile** .</span><span class="sxs-lookup"><span data-stu-id="b5e15-128">If the **OpenProperty** call fails, call it again to retrieve the **PR_ATTACH_DATA_BIN** property with the **IStreamDocfile** interface.</span></span> 
            
        3. <span data-ttu-id="b5e15-129">Si se produce un error en esta segunda llamada **OpenProperty** , vuelva a intentar llamar **OpenProperty** para recuperar **PR_ATTACH_DATA_OBJ**.</span><span class="sxs-lookup"><span data-stu-id="b5e15-129">If this second **OpenProperty** call fails, try again to call **OpenProperty** to retrieve **PR_ATTACH_DATA_OBJ**.</span></span> <span data-ttu-id="b5e15-130">Sin embargo, en lugar de especificar **IStreamDocfile**, especificar la interfaz **IStorage** .</span><span class="sxs-lookup"><span data-stu-id="b5e15-130">However, rather than specifying **IStreamDocfile**, specify the **IStorage** interface.</span></span> 
    
4. <span data-ttu-id="b5e15-131">Si se establece **PR_ATTACH_METHOD** en ATTACH_EMBEDDED_MSG, no es extraño que el valor de **PR_ATTACH_DATA_OBJ** para que contenga un error.</span><span class="sxs-lookup"><span data-stu-id="b5e15-131">If **PR_ATTACH_METHOD** is set to ATTACH_EMBEDDED_MSG, it is not unusual for the value of **PR_ATTACH_DATA_OBJ** to contain an error.</span></span> <span data-ttu-id="b5e15-132">Esto es debido a que usted y el implementador de la tabla no tienen forma está de acuerdo en el tipo de objeto que se va a devolver.</span><span class="sxs-lookup"><span data-stu-id="b5e15-132">This is because you and the table implementer have no way to agree on the type of object to return.</span></span> <span data-ttu-id="b5e15-133">Para recuperar un puntero al mensaje adjunto, abra los datos adjuntos con **IMessage::OpenAttach**.</span><span class="sxs-lookup"><span data-stu-id="b5e15-133">To retrieve a pointer to the attached message, open the attachment using **IMessage::OpenAttach**.</span></span> <span data-ttu-id="b5e15-134">A continuación, tener acceso a los datos adjuntos mediante una llamada a su método **IMAPIProp::OpenProperty** .</span><span class="sxs-lookup"><span data-stu-id="b5e15-134">Then access the attachment data by calling its **IMAPIProp::OpenProperty** method.</span></span> <span data-ttu-id="b5e15-135">Para obtener más información, vea [IMessage::OpenAttach](imessage-openattach.md) y [IMAPIProp::OpenProperty](imapiprop-openproperty.md).</span><span class="sxs-lookup"><span data-stu-id="b5e15-135">For more information, see [IMessage::OpenAttach](imessage-openattach.md) and [IMAPIProp::OpenProperty](imapiprop-openproperty.md).</span></span>
    
<span data-ttu-id="b5e15-136">Puede solicitar que los datos adjuntos se abren en modo de sólo lectura o de lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="b5e15-136">You can request that an attachment is opened in read/write or read-only mode.</span></span> <span data-ttu-id="b5e15-137">Sólo lectura es el modo predeterminado y muchos de los proveedores de almacén de mensajes abrir todos los datos adjuntos en este modo, independientemente de los clientes que solicitan.</span><span class="sxs-lookup"><span data-stu-id="b5e15-137">Read-only is the default mode, and many message store providers open all attachments in this mode regardless of what clients request.</span></span> <span data-ttu-id="b5e15-138">Pase el indicador MAPI_BEST_ACCESS para solicitar que el proveedor de almacenamiento de mensaje conceder el mayor nivel de acceso puede y, a continuación, recuperar la propiedad **PR_ACCESS_LEVEL** de los datos adjuntos abiertos para determinar el nivel de acceso que realmente se ha concedido.</span><span class="sxs-lookup"><span data-stu-id="b5e15-138">Pass the MAPI_BEST_ACCESS flag to request that the message store provider grant the highest level of access it can and then retrieve the open attachment's **PR_ACCESS_LEVEL** property to determine the level of access that was actually granted.</span></span> <span data-ttu-id="b5e15-139">Para obtener más información, vea **PR_ACCESS_LEVEL** ([PidTagAccessLevel](pidtagaccesslevel-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="b5e15-139">For more information, see **PR_ACCESS_LEVEL** ([PidTagAccessLevel](pidtagaccesslevel-canonical-property.md)).</span></span>
  
<span data-ttu-id="b5e15-140">En el ejemplo siguiente se muestra cómo abrir los datos en un documento adjunto **PR\_ATTACH_DATA_BIN** (propiedad).</span><span class="sxs-lookup"><span data-stu-id="b5e15-140">The following example shows how to open the data in an attachment's **PR\_ATTACH_DATA_BIN** property.</span></span> <span data-ttu-id="b5e15-141">Asigna punteros a dos secuencias: uno para el archivo y otro para los datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="b5e15-141">It allocates pointers to two streams: one for the file and one for the attachment.</span></span> <span data-ttu-id="b5e15-142">La función **OpenStreamOnFile** abre la secuencia de archivo en modo de sólo lectura.</span><span class="sxs-lookup"><span data-stu-id="b5e15-142">The **OpenStreamOnFile** function opens the file stream in read-only mode.</span></span> <span data-ttu-id="b5e15-143">La llamada al método de **IMAPIProp::OpenProperty** de los datos adjuntos, abre la secuencia de datos adjuntos en el modo de lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="b5e15-143">The call to the attachment's **IMAPIProp::OpenProperty** method opens the attachment stream in read/write mode.</span></span> <span data-ttu-id="b5e15-144">Para obtener más información, vea **PR_ATTACH_DATA_BIN**, [OpenStreamOnFile](openstreamonfile.md)y [IMAPIProp::OpenProperty](imapiprop-openproperty.md).</span><span class="sxs-lookup"><span data-stu-id="b5e15-144">For more information, see **PR_ATTACH_DATA_BIN**, [OpenStreamOnFile](openstreamonfile.md), and [IMAPIProp::OpenProperty](imapiprop-openproperty.md).</span></span> <span data-ttu-id="b5e15-145">El código, a continuación, copia de la secuencia de archivo en la secuencia de datos adjuntos y libera ambas secuencias.</span><span class="sxs-lookup"><span data-stu-id="b5e15-145">The code then copies from the file stream to the attachment stream and releases both streams.</span></span>
  
```cpp
LPSTREAM pStreamFile, pStreamAtt;
HRESULT hr;
hr = OpenStreamOnFile (MAPIAllocateBuffer, MAPIFreeBuffer,
                       STGM_READ, "myfile.doc", NULL, &pStreamFile);
if (HR_SUCCEEDED(hr))
{
    // Open the destination stream in the attachment object
    hr = pAttach->OpenProperty (PR_ATTACH_DATA_BIN,
                                &IID_IStream,
                                0,
                                MAPI_MODIFY | MAPI_CREATE,
                                (LPUNKNOWN *)&pStreamAtt);
    if (HR_SUCCEEDED(hr))
    {
        STATSTG StatInfo;
        pStreamFile->Stat (&StatInfo, STATFLAG_NONAME);
        hResult = pStreamFile->CopyTo (pStreamAtt, StatInfo.cbSize,
                                       NULL, NULL);
        pStreamAtt->Release();
    }
    pStreamFile->Release();
}
```


