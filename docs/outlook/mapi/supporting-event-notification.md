---
title: Admitir notificaciones de eventos
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: a1e3e49c-8d1d-4f7e-ba5a-be441f0f10ae
description: 'Última modificación: 23 de julio de 2011'
ms.openlocfilehash: 83c102c25b17b6769c0c676bbadd874224f75cf6
ms.sourcegitcommit: ef717c65d8dd41ababffb01eafc443c79950aed4
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 10/04/2018
ms.locfileid: "25397145"
---
# <a name="supporting-event-notification"></a><span data-ttu-id="3ca9d-103">Admitir notificaciones de eventos</span><span class="sxs-lookup"><span data-stu-id="3ca9d-103">Supporting Event Notification</span></span>

  
  
<span data-ttu-id="3ca9d-104">**Hace referencia a**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="3ca9d-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="3ca9d-105">Debido a que la compatibilidad con notificación de evento puede ser complicada, MAPI proporciona tres métodos de objeto de soporte técnico que implementan las partes más difíciles del proceso.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-105">Because supporting event notification can be complicated, MAPI supplies three support object methods that implement the most difficult parts of the process.</span></span> <span data-ttu-id="3ca9d-106">Estos métodos funcionan como una unidad, y debe usar un proveedor de las tres o ninguno de ellos.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-106">These methods work as a unit, and a provider must use all three or none of them.</span></span>
  
<span data-ttu-id="3ca9d-107">Los métodos de soporte técnico MAPI usan claves de notificación para administrar las conexiones entre los receptores advise y los objetos que generan las notificaciones.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-107">The MAPI support methods use notification keys to manage the connections between the advise sinks and the objects that generate the notifications.</span></span> <span data-ttu-id="3ca9d-108">Una clave de notificación es una estructura [NOTIFKEY](notifkey.md) que contiene datos binarios que identifica un objeto a través de los procesos.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-108">A notification key is a [NOTIFKEY](notifkey.md) structure that contains binary data that identifies an object across processes.</span></span> <span data-ttu-id="3ca9d-109">Normalmente, una clave de notificación se copia desde el identificador de entrada a largo plazo del objeto de origen advise.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-109">A notification key is typically copied from the long-term entry identifier of the advise source object.</span></span> <span data-ttu-id="3ca9d-110">Si el cliente ha suministrado un identificador de entrada en la llamada a **Advise**, puede utilizarlo para la clave de notificación.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-110">If the client has supplied an entry identifier in the call to **Advise**, you can use it for the notification key.</span></span> <span data-ttu-id="3ca9d-111">Si el parámetro _lpEntryID_ **Advise** es NULL, utilice el identificador de entrada del objeto contenedor posibles externo, como el almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-111">If the  _lpEntryID_ parameter to **Advise** is NULL, use the entry identifier of the outermost possible container object, such as the message store.</span></span> 
  
<span data-ttu-id="3ca9d-112">Para usar los métodos de soporte técnico, llame a [IMAPISupport::Subscribe](imapisupport-subscribe.md) cada vez que un cliente llama al método **Advise** se registre para una notificación.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-112">To use the support methods, call [IMAPISupport::Subscribe](imapisupport-subscribe.md) whenever a client calls your **Advise** method to register for a notification.</span></span> <span data-ttu-id="3ca9d-113">Asignar una estructura [NOTIFKEY](notifkey.md) y crear una clave de notificación único para el objeto de origen advise.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-113">Allocate a [NOTIFKEY](notifkey.md) structure and create a unique notification key for your advise source object.</span></span> <span data-ttu-id="3ca9d-114">Por ejemplo, un proveedor de almacén de mensajes que se le pide que notificar a un cliente cuando se recibe un mensaje en una carpeta determinada crea una clave de notificación para esa carpeta.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-114">For example, a message store provider that is prompted to notify a client when a message is received into a particular folder creates a notification key for that folder.</span></span> <span data-ttu-id="3ca9d-115">Pase un puntero a la estructura **NOTIFKEY** en la llamada a **Subscribe** junto con un puntero para el cliente de aviso receptor.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-115">Pass a pointer to the **NOTIFKEY** structure in the call to **Subscribe** along with a pointer to the client's advise sink.</span></span> <span data-ttu-id="3ca9d-116">**SUBSCRIBE** llama al método [IUnknown:: AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) del receptor de notificaciones para incrementar su recuento de referencia y MAPI conserva el puntero hasta que se cancela el registro.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-116">**Subscribe** calls the advise sink's [IUnknown::AddRef](https://msdn.microsoft.com/library/b4316efd-73d4-4995-b898-8025a316ba63%28Office.15%29.aspx) method to increment its reference count and MAPI retains the pointer until the registration is canceled.</span></span> 
  
<span data-ttu-id="3ca9d-117">Puede pasar la marca NOTIFY_SYNC **suscribirse** para solicitar que se comportan los **Notify** devueltos de forma sincrónica y no hasta que haya realizado todas las llamadas a los métodos [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) del registrado receptores de aviso.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-117">You can pass the NOTIFY_SYNC flag to **Subscribe** to request that **Notify** behave synchronously and not return until it has made all calls to the [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) methods of registered advise sinks.</span></span> <span data-ttu-id="3ca9d-118">Establezca esta marca sólo para su propio uso interno.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-118">Set this flag only for your own internal use.</span></span> <span data-ttu-id="3ca9d-119">No se establece al responder a un cliente **Advise** llamada.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-119">Do not set it when you respond to a client **Advise** call.</span></span> <span data-ttu-id="3ca9d-120">Notificación de eventos entre los clientes y proveedores siempre es asincrónico.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-120">Event notification between clients and providers is always asynchronous.</span></span> <span data-ttu-id="3ca9d-121">Es decir, MAPI, garantiza que la llamada durante el cual se produce un evento devolverá al cliente antes de cualquiera de las llamadas de **OnNotify** se realizan.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-121">That is, MAPI guarantees that the call during which an event happens will return to the client before any of the **OnNotify** calls are made.</span></span> 
  
<span data-ttu-id="3ca9d-122">Si se establece la marca NOTIFY_SYNC, no realice ningún cambio en cualquiera de los objetos del receptor de advise y no se pasa un receptor de notificaciones de contenedor creado por [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) **suscribirse**.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-122">If you set the NOTIFY_SYNC flag, do not make any changes to any of the advise sink objects, and do not pass a wrapper advise sink created by [HrThisThreadAdviseSink](hrthisthreadadvisesink.md) to **Subscribe**.</span></span> <span data-ttu-id="3ca9d-123">**HrThisThreadAdviseSink** crea una versión de subprocesos de un receptor de notificaciones que se usará con sólo la notificación asincrónica.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-123">**HrThisThreadAdviseSink** creates a thread-safe version of an advise sink to be used with asynchronous notification only.</span></span> 
  
<span data-ttu-id="3ca9d-124">Si un receptor de notificaciones que se registró para la notificación sincrónica devuelve de **OnNotify** con el conjunto de marca CALLBACK_DISCONTINUE, [IMAPISupport::Notify](imapisupport-notify.md) establece la marca NOTIFY_CANCELED y devuelve sin realizar todas las llamadas a **OnNotify**.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-124">If an advise sink registered for synchronous notification returns from **OnNotify** with the CALLBACK_DISCONTINUE flag set, [IMAPISupport::Notify](imapisupport-notify.md) sets the NOTIFY_CANCELED flag and returns without making any calls to **OnNotify**.</span></span> 
  
<span data-ttu-id="3ca9d-125">Una vez que ha devuelto **Subscribe** , ya no tendrá ninguna necesidad de retener su copia del receptor de aviso del cliente.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-125">Once **Subscribe** has returned, you will no longer have any need to hold onto your copy of the client's advise sink.</span></span> <span data-ttu-id="3ca9d-126">Llame a su método [IUnknown:: Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) para liberarlo.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-126">Call its [IUnknown::Release](https://msdn.microsoft.com/library/4b494c6f-f0ee-4c35-ae45-ed956f40dc7a%28Office.15%29.aspx) method to release it.</span></span> <span data-ttu-id="3ca9d-127">**SUBSCRIBE** devuelve un número distinto de cero de conexión que se debe devolver al cliente.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-127">**Subscribe** returns a nonzero connection number that you should return to the client.</span></span> <span data-ttu-id="3ca9d-128">El número de conexión representa el vínculo entre el origen de advise y el receptor de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-128">The connection number represents the link between the advise source and the advise sink.</span></span> <span data-ttu-id="3ca9d-129">Sigue siendo válida hasta que el cliente realiza una llamada satisfactoria a **Unadvise**.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-129">It remains valid until the client makes a successful call to **Unadvise**.</span></span> 
  
<span data-ttu-id="3ca9d-130">Cuando el cliente está listo para cancelar un registro, se llama al método **Unadvise** .</span><span class="sxs-lookup"><span data-stu-id="3ca9d-130">When the client is ready to cancel a registration, it calls your **Unadvise** method.</span></span> <span data-ttu-id="3ca9d-131">Pase el número de conexión de la llamada **Unadvise** a [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md).</span><span class="sxs-lookup"><span data-stu-id="3ca9d-131">Pass the connection number from the **Unadvise** call to [IMAPISupport::Unsubscribe](imapisupport-unsubscribe.md).</span></span> <span data-ttu-id="3ca9d-132">**Cancelar suscripción** llama a método de **IUnknown:: Release** del receptor de notificaciones.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-132">**Unsubscribe** calls the advise sink's **IUnknown::Release** method.</span></span> <span data-ttu-id="3ca9d-133">Al igual que con **Advise** y **Unadvise**, las llamadas a \*\* **Subscribe** y\*\* deben estar emparejadas.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-133">As with **Advise** and **Unadvise**, calls to **Subscribe** and **Unsubscribe** must be paired.</span></span> <span data-ttu-id="3ca9d-134">Debe realizar una llamada a **Unsubscribe** por cada llamada que se realiza a **Subscribe**.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-134">You must make one call to **Unsubscribe** for every call that is made to **Subscribe**.</span></span> <span data-ttu-id="3ca9d-135">Sin embargo, no es necesario llamar a **Subscribe** cada vez que se llame al método **Advise** .</span><span class="sxs-lookup"><span data-stu-id="3ca9d-135">However, you do not have to call **Subscribe** every time your **Advise** method is called.</span></span> <span data-ttu-id="3ca9d-136">Por el contrario, se puede llamar para configurar notificaciones internas.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-136">Conversely, you can call it for setting up internal notifications.</span></span> 
  
<span data-ttu-id="3ca9d-137">Cuando se produce un evento, asignar uno o más estructuras de [notificación](notification.md) del tipo apropiado para el evento y llame a [IMAPISupport::Notify](imapisupport-notify.md).</span><span class="sxs-lookup"><span data-stu-id="3ca9d-137">When an event occurs, allocate one or more [NOTIFICATION](notification.md) structures of the type appropriate for the event and call [IMAPISupport::Notify](imapisupport-notify.md).</span></span> <span data-ttu-id="3ca9d-138">**Notify** genera una notificación para cada receptor de notificaciones registrados.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-138">**Notify** generates a notification for each registered advise sink.</span></span> <span data-ttu-id="3ca9d-139">Debe establecer todos los miembros no usados de la estructura de [notificación](notification.md) en cero.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-139">You should set all the unused members of the [NOTIFICATION](notification.md) structure to zero.</span></span> <span data-ttu-id="3ca9d-140">Esta técnica para inicializar la estructura de **notificación** puede ayudar a los clientes a crear más pequeños, con mayor rapidez y menos propensas a errores implementaciones de **OnNotify** .</span><span class="sxs-lookup"><span data-stu-id="3ca9d-140">This technique for initializing the **NOTIFICATION** structure can help clients create smaller, faster, and less error-prone **OnNotify** implementations.</span></span> 
  
<span data-ttu-id="3ca9d-141">Tenga en cuenta que es necesaria para cada evento, incluso para varios eventos del mismo tipo de una estructura de **notificación** independiente.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-141">Note that a separate **NOTIFICATION** structure is necessary for each event, even for multiple events of the same type.</span></span> <span data-ttu-id="3ca9d-142">Por ejemplo, si tres clientes se registran para la notificación de la tabla en una tabla determinada y cinco filas se agregan a la tabla, debe crear cinco estructuras **OBJECT_NOTIFICATION** para la llamada de **notificación** .</span><span class="sxs-lookup"><span data-stu-id="3ca9d-142">For example, if three clients are registered for table notification on a particular table and five rows are added to the table, you must create five **OBJECT_NOTIFICATION** structures for your **Notify** call.</span></span> <span data-ttu-id="3ca9d-143">Una notificación por lotes como esto da como resultado un mejor rendimiento que una llamada a **Notify** cinco veces.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-143">A batch notification such as this results in better performance than calling **Notify** five times.</span></span> <span data-ttu-id="3ca9d-144">Para cada llamada **Notify** , MAPI llama al método de [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) de cada receptor de notificaciones registrados.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-144">For each **Notify** call, MAPI calls the [IMAPIAdviseSink::OnNotify](imapiadvisesink-onnotify.md) method of every registered advise sink.</span></span> <span data-ttu-id="3ca9d-145">Si hay no registrado de aviso receptores, MAPI, pasa por alto la llamada.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-145">If there are no registered advise sinks, MAPI ignores the call.</span></span> 
  
<span data-ttu-id="3ca9d-146">Proveedores de servicios que envían notificaciones por lotes deben ordenarlas por lo que puede interpretar de la primera notificación a la última.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-146">Service providers that send batched notifications must order them so that they can be interpreted from the first notification to the last.</span></span> <span data-ttu-id="3ca9d-147">En este orden es especialmente necesaria cuando un lote de notificación contiene una serie de eventos, como TABLE_ROW_ADDED con un evento que hace referencia a una fila anterior que se ha agregado en otro evento en el mismo lote.</span><span class="sxs-lookup"><span data-stu-id="3ca9d-147">This ordering is especially necessary when a notification batch contains a series of events, such as TABLE_ROW_ADDED with one event that refers to a prior row that was added in another event in the same batch.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="3ca9d-148">Vea también</span><span class="sxs-lookup"><span data-stu-id="3ca9d-148">See also</span></span>



[<span data-ttu-id="3ca9d-149">Proveedores de servicios de MAPI</span><span class="sxs-lookup"><span data-stu-id="3ca9d-149">MAPI Service Providers</span></span>](mapi-service-providers.md)

