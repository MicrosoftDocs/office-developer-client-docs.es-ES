---
title: Actuar como un proveedor de libreta de direcciones externo
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 6d532ed4-7dc5-46a9-995a-72bc97d16f6e
description: 'Última modificación: 23 de julio de 2011'
ms.openlocfilehash: 300681bd585e9d534113404a82f43565f4e79bb4
ms.sourcegitcommit: 8657170d071f9bcf680aba50b9c07f2a4fb82283
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/28/2019
ms.locfileid: "33435743"
---
# <a name="acting-as-a-foreign-address-book-provider"></a><span data-ttu-id="01ca1-103">Actuar como un proveedor de libreta de direcciones externo</span><span class="sxs-lookup"><span data-stu-id="01ca1-103">Acting as a foreign address book provider</span></span>

<span data-ttu-id="01ca1-104">**Se aplica a**: Outlook 2013 | Outlook 2016</span><span class="sxs-lookup"><span data-stu-id="01ca1-104">**Applies to**: Outlook 2013 | Outlook 2016</span></span> 
  
<span data-ttu-id="01ca1-105">Un proveedor externo es un proveedor de libretas de direcciones que:</span><span class="sxs-lookup"><span data-stu-id="01ca1-105">A foreign provider is an address book provider that:</span></span> 
  
- <span data-ttu-id="01ca1-106">Asigna identificadores de plantilla para sus destinatarios.</span><span class="sxs-lookup"><span data-stu-id="01ca1-106">Assigns template identifiers for its recipients.</span></span>
    
- <span data-ttu-id="01ca1-107">Admite el [método IABLogon::OpenTemplateID.](iablogon-opentemplateid.md)</span><span class="sxs-lookup"><span data-stu-id="01ca1-107">Supports the [IABLogon::OpenTemplateID](iablogon-opentemplateid.md) method.</span></span> 
    
- <span data-ttu-id="01ca1-108">Proporciona código para mantener los destinatarios que existen en los contenedores de otros proveedores de libretas de direcciones conocidos como proveedores de host.</span><span class="sxs-lookup"><span data-stu-id="01ca1-108">Supplies code for maintaining recipients that exist in the containers of other address book providers known as host providers.</span></span> <span data-ttu-id="01ca1-109">Este código implica un objeto de propiedad, normalmente **una implementación de interfaz IMAPIProp,** que encapsula un objeto de propiedad del proveedor de host.</span><span class="sxs-lookup"><span data-stu-id="01ca1-109">This code involves a property object, typically an **IMAPIProp** interface implementation, which wraps a property object from the host provider.</span></span> 
    
<span data-ttu-id="01ca1-110">Actuar como proveedor externo es un rol opcional; no todos los proveedores necesitan admitir identificadores de plantilla y su código relacionado.</span><span class="sxs-lookup"><span data-stu-id="01ca1-110">Acting as a foreign provider is an optional role; not all providers need to support template identifiers and their related code.</span></span> <span data-ttu-id="01ca1-111">Implemente su proveedor como un proveedor externo si desea mantener el control sobre los destinatarios que los proveedores de host crean mediante plantillas proporcionadas por el proveedor.</span><span class="sxs-lookup"><span data-stu-id="01ca1-111">Implement your provider as a foreign provider if you want to maintain control over recipients that host providers create using templates supplied by your provider.</span></span> 
  
<span data-ttu-id="01ca1-112">El formato que el proveedor usa para sus identificadores de entrada también se puede usar para sus identificadores de plantilla.</span><span class="sxs-lookup"><span data-stu-id="01ca1-112">The format that your provider uses for its entry identifiers can also be used for its template identifiers.</span></span> <span data-ttu-id="01ca1-113">Los identificadores de plantilla deben incluir el **MAPIUID** registrado del proveedor para permitir que MAPI enlace correctamente los destinatarios a los proveedores adecuados.</span><span class="sxs-lookup"><span data-stu-id="01ca1-113">Template identifiers must include your provider's registered **MAPIUID** to enable MAPI to successfully bind recipients to the appropriate providers.</span></span> 
  
<span data-ttu-id="01ca1-114">MAPI llama al método **IABLogon::OpenTemplateID** del proveedor cuando un proveedor de host llama a [IMAPISupport::OpenTemplateID](imapisupport-opentemplateid.md).</span><span class="sxs-lookup"><span data-stu-id="01ca1-114">MAPI calls your provider's **IABLogon::OpenTemplateID** method when a host provider calls [IMAPISupport::OpenTemplateID](imapisupport-opentemplateid.md).</span></span> <span data-ttu-id="01ca1-115">El proveedor de host pasa el identificador de plantilla del destinatario en el parámetro  _lpTemplateID_ en su llamada a **IMAPISupport::OpenTemplateID**.</span><span class="sxs-lookup"><span data-stu-id="01ca1-115">The host provider passes the template identifier of the recipient in the  _lpTemplateID_ parameter in its call to **IMAPISupport::OpenTemplateID**.</span></span> <span data-ttu-id="01ca1-116">MAPI determina que el identificador de plantilla pertenece a su proveedor al hacer coincidir [el MAPIUID](mapiuid.md) en el identificador de plantilla con el **MAPIUID** que el proveedor registró en el momento de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="01ca1-116">MAPI determines that the template identifier belongs to your provider by matching the [MAPIUID](mapiuid.md) in the template identifier with the **MAPIUID** that your provider registered at logon time.</span></span> <span data-ttu-id="01ca1-117">A continuación, MAPI reenvía la llamada del proveedor de host a su proveedor a través del método **IABLogon::OpenTemplateID.**</span><span class="sxs-lookup"><span data-stu-id="01ca1-117">MAPI then forwards the host provider's call to your provider through the **IABLogon::OpenTemplateID** method.</span></span> 
  
<span data-ttu-id="01ca1-118">El proveedor de host también pasa un puntero a su implementación de objeto de propiedad para el destinatario en el parámetro  _lpMAPIPropData,_ un identificador de interfaz en el parámetro  _lpInterface_ que corresponde al tipo de implementación de interfaz pasado en  _lpMAPIPropData_ y una marca opcional, FILL_ENTRY.</span><span class="sxs-lookup"><span data-stu-id="01ca1-118">The host provider also passes a pointer to its property object implementation for the recipient in the  _lpMAPIPropData_ parameter, an interface identifier in the  _lpInterface_ parameter that corresponds to the type of interface implementation passed in  _lpMAPIPropData_, and an optional flag, FILL_ENTRY.</span></span> <span data-ttu-id="01ca1-119">Se espera que el proveedor devuelva en el parámetro  _lppMAPIPropNew_ un puntero a una implementación de objeto de propiedad del tipo especificado en  _lpInterface_.</span><span class="sxs-lookup"><span data-stu-id="01ca1-119">Your provider is expected to return in the  _lppMAPIPropNew_ parameter a pointer to a property object implementation of the type specified in  _lpInterface_.</span></span> <span data-ttu-id="01ca1-120">El puntero devuelto puede ser al objeto de propiedad ajustado implementado por el proveedor o al objeto proporcionado por el proveedor de host  _en lpMAPIPropData_.</span><span class="sxs-lookup"><span data-stu-id="01ca1-120">The returned pointer can either be to the wrapped property object implemented by your provider or to the object supplied by the host provider in  _lpMAPIPropData_.</span></span> <span data-ttu-id="01ca1-121">El proveedor debe devolver un puntero de objeto de propiedad ajustado cuando:</span><span class="sxs-lookup"><span data-stu-id="01ca1-121">Your provider should return a wrapped property object pointer when:</span></span>
  
- <span data-ttu-id="01ca1-122">La tabla para mostrar del destinatario contiene controles de cuadro de lista.</span><span class="sxs-lookup"><span data-stu-id="01ca1-122">The recipient's display table contains list box controls.</span></span>
    
- <span data-ttu-id="01ca1-123">La dirección de correo electrónico del destinatario debe ensamblarse a partir de datos en varios controles de tabla para mostrar.</span><span class="sxs-lookup"><span data-stu-id="01ca1-123">The email address for the recipient must be assembled from data in multiple display table controls.</span></span>
    
- <span data-ttu-id="01ca1-124">El proveedor emite notificaciones de tabla de visualización.</span><span class="sxs-lookup"><span data-stu-id="01ca1-124">Your provider issues display table notifications.</span></span>
    
<span data-ttu-id="01ca1-125">La FILL_ENTRY indica al proveedor que el proveedor de host requiere que se actualicen todas las propiedades del destinatario.</span><span class="sxs-lookup"><span data-stu-id="01ca1-125">The FILL_ENTRY flag indicates to your provider that the host provider requires all the properties of the recipient to be updated.</span></span> <span data-ttu-id="01ca1-126">Su proveedor debe cumplir esta solicitud.</span><span class="sxs-lookup"><span data-stu-id="01ca1-126">Your provider is required to fulfill this request.</span></span>
  
<span data-ttu-id="01ca1-127">Cuando un proveedor de host llama al método **OpenTemplateID** del proveedor, es posible que:</span><span class="sxs-lookup"><span data-stu-id="01ca1-127">When a host provider calls your provider's **OpenTemplateID** method, your provider might:</span></span> 
  
- <span data-ttu-id="01ca1-128">Actualice periódicamente los datos de una entrada copiada.</span><span class="sxs-lookup"><span data-stu-id="01ca1-128">Periodically update the data for a copied entry.</span></span>
    
- <span data-ttu-id="01ca1-129">Mantenga una entrada copiada sincronizada con su original, por ejemplo, cuando se copia una entrada de la libreta de direcciones en la libreta de direcciones personal.</span><span class="sxs-lookup"><span data-stu-id="01ca1-129">Keep a copied entry synchronized with its original, such as when an address book entry is copied to the personal address book.</span></span>
    
- <span data-ttu-id="01ca1-130">Implemente funciones que el proveedor de host no pueda implementar, como rellenar dinámicamente cuadros de lista en la tabla de detalles de la entrada copiada a partir de los datos de un servidor.</span><span class="sxs-lookup"><span data-stu-id="01ca1-130">Implement functionality that cannot be implemented by the host provider, such as dynamically populating list boxes in the copied entry's details table from data on a server.</span></span>
    
- <span data-ttu-id="01ca1-131">Controlar la interacción entre las propiedades de una entrada copiada o una plantilla con instancias.</span><span class="sxs-lookup"><span data-stu-id="01ca1-131">Control the interaction among properties in a copied entry or instantiated template.</span></span> <span data-ttu-id="01ca1-132">Por ejemplo, la informática **PR_EMAIL_ADDRESS** otras propiedades mostradas en la tabla de detalles.</span><span class="sxs-lookup"><span data-stu-id="01ca1-132">For example, computing **PR_EMAIL_ADDRESS** from other properties displayed in the details table.</span></span> 
    
<span data-ttu-id="01ca1-133">Los dos primeros elementos son ejemplos de tareas que no requieren que el proveedor proporcione un objeto de propiedad ajustado: una implementación de **IMAPIProp** basada en la implementación del proveedor de host.</span><span class="sxs-lookup"><span data-stu-id="01ca1-133">The first two items are examples of tasks that do not require your provider to supply a wrapped property object — an implementation of **IMAPIProp** that is based on the host provider's implementation.</span></span> <span data-ttu-id="01ca1-134">El proveedor simplemente puede actualizar las propiedades según sea necesario y devolver, estableciendo el parámetro _lppMAPIPropNew_ para que apunte al puntero pasado por el proveedor de host en el parámetro _lpMAPIPropData._</span><span class="sxs-lookup"><span data-stu-id="01ca1-134">Your provider can simply update the properties as necessary and return, setting the  _lppMAPIPropNew_ parameter to point to the pointer passed in by the host provider in the  _lpMAPIPropData_ parameter.</span></span> 
  
<span data-ttu-id="01ca1-135">Las dos segundas tareas requieren que el proveedor devuelva al proveedor de host un objeto de propiedad que ajuste el objeto del proveedor de host con funciones adicionales, como la capacidad de mostrar una hoja de propiedades para la entrada.</span><span class="sxs-lookup"><span data-stu-id="01ca1-135">The second two tasks require that your provider return to the host provider a property object that wraps the host provider's object with additional functionality, such as the ability to display a property sheet for the entry.</span></span> <span data-ttu-id="01ca1-136">Este objeto de propiedad será un usuario de mensajería o una lista de distribución, según el tipo de objeto pasado por el proveedor de host en el parámetro _lpMAPIPropData_ e indicado por el identificador de interfaz en el parámetro _lpInterface._</span><span class="sxs-lookup"><span data-stu-id="01ca1-136">This property object will either be a messaging user or distribution list, depending on the type of object passed in by the host provider in the  _lpMAPIPropData_ parameter and indicated by the interface identifier in the  _lpInterface_ parameter.</span></span> <span data-ttu-id="01ca1-137">Si el _parámetro lpMAPIPropData_ apunta a un usuario de mensajería, el objeto de propiedad ajustada del proveedor debe ser una **implementación de IMailUser.**</span><span class="sxs-lookup"><span data-stu-id="01ca1-137">If the  _lpMAPIPropData_ parameter points to a messaging user, your provider's wrapped property object must be an **IMailUser** implementation.</span></span> <span data-ttu-id="01ca1-138">Si _lpMAPIPropData apunta_ a una lista de distribución, debe ser una **implementación de IDistList.**</span><span class="sxs-lookup"><span data-stu-id="01ca1-138">If  _lpMAPIPropData_ points to a distribution list, it must be an **IDistList** implementation.</span></span> 
  
<span data-ttu-id="01ca1-139">El objeto de propiedad ajustada del proveedor intercepta las llamadas al método **IMAPIProp** para realizar una manipulación específica del contexto del destinatario del proveedor de host, el objeto que está envolviendo.</span><span class="sxs-lookup"><span data-stu-id="01ca1-139">Your provider's wrapped property object intercepts **IMAPIProp** method calls to perform context-specific manipulation of the host provider's recipient—the object it is wrapping.</span></span> <span data-ttu-id="01ca1-140">MAPI solo tiene un requisito para objetos de propiedad ajustados: todas las llamadas a [IMAPIProp::OpenProperty](imapiprop-openproperty.md) que solicitan la propiedad **PR_DETAILS_TABLE** ([PidTagDetailsTable](pidtagdetailstable-canonical-property.md)) deben pasarse al proveedor de host.</span><span class="sxs-lookup"><span data-stu-id="01ca1-140">MAPI only has one requirement for wrapped property objects: all calls to [IMAPIProp::OpenProperty](imapiprop-openproperty.md) requesting the **PR_DETAILS_TABLE** ([PidTagDetailsTable](pidtagdetailstable-canonical-property.md)) property should be passed to the host provider.</span></span> <span data-ttu-id="01ca1-141">La implementación del proveedor puede usar la tabla devuelta para interceptar las notificaciones de la tabla para mostrar o para agregar las suyas propias si es necesario.</span><span class="sxs-lookup"><span data-stu-id="01ca1-141">Your provider's implementation can use the returned table to intercept display table notifications or to add its own if necessary.</span></span> 
  
<span data-ttu-id="01ca1-142">La siguiente lista incluye tareas que normalmente se implementan en el objeto de propiedad ajustado implementado por proveedores externos:</span><span class="sxs-lookup"><span data-stu-id="01ca1-142">The following list includes tasks that are typically implemented in the wrapped property object implemented by foreign providers:</span></span>
  
- <span data-ttu-id="01ca1-143">Valores de propiedad de preprocesamiento y posprocesamiento para el destinatario del host [en IMAPIProp::GetProps](imapiprop-getprops.md).</span><span class="sxs-lookup"><span data-stu-id="01ca1-143">Preprocessing and postprocessing property values for the host recipient in [IMAPIProp::GetProps](imapiprop-getprops.md).</span></span>
    
- <span data-ttu-id="01ca1-144">El control de detalles muestra controles de tabla, como botones y cuadros de lista, **en IMAPIProp::OpenProperty**.</span><span class="sxs-lookup"><span data-stu-id="01ca1-144">Handling details display table controls, such as buttons and list boxes, in **IMAPIProp::OpenProperty**.</span></span>
    
- <span data-ttu-id="01ca1-145">Validar o manipular los valores de propiedad para el destinatario del host [en IMAPIProp::SetProps](imapiprop-setprops.md).</span><span class="sxs-lookup"><span data-stu-id="01ca1-145">Validating or manipulating property values for the host recipient in [IMAPIProp::SetProps](imapiprop-setprops.md).</span></span>
    
- <span data-ttu-id="01ca1-146">Calcular las propiedades necesarias, como **PR_EMAIL_ADDRESS** y comprobar que se han establecido todas las propiedades necesarias antes de guardar el destinatario del host en [IMAPIProp::SaveChanges](imapiprop-savechanges.md).</span><span class="sxs-lookup"><span data-stu-id="01ca1-146">Computing required properties such as **PR_EMAIL_ADDRESS** and verifying that all of the necessary properties have been set before saving the host recipient in [IMAPIProp::SaveChanges](imapiprop-savechanges.md).</span></span>
    
### <a name="to-implement-iablogonopentemplateid"></a><span data-ttu-id="01ca1-147">Para implementar IABLogon::OpenTemplateID</span><span class="sxs-lookup"><span data-stu-id="01ca1-147">To implement IABLogon::OpenTemplateID</span></span>
  
1. <span data-ttu-id="01ca1-148">Compruebe si el identificador de plantilla pasado con el parámetro  _lpTemplateID_ es válido y está en un formato que el proveedor reconoce.</span><span class="sxs-lookup"><span data-stu-id="01ca1-148">Check if the template identifier passed in with the  _lpTemplateID_ parameter is valid and is in a format that your provider recognizes.</span></span> <span data-ttu-id="01ca1-149">Si no es así, se producirá un error y se devolverá MAPI_E_INVALID_ENTRYID.</span><span class="sxs-lookup"><span data-stu-id="01ca1-149">If it is not, fail and return MAPI_E_INVALID_ENTRYID.</span></span> 
    
2. <span data-ttu-id="01ca1-150">Cree un objeto del tipo indicado por el identificador de plantilla, ya sea un usuario de mensajería, una lista de distribución o un destinatario de uso único.</span><span class="sxs-lookup"><span data-stu-id="01ca1-150">Create an object of the type indicated by the template identifier, either a messaging user, distribution list, or one-off recipient.</span></span> 
    
3. <span data-ttu-id="01ca1-151">Llame al **método IUnknown::AddRef** en el objeto de propiedad del proveedor de host, que es el objeto al que apunta el parámetro _lpMAPIPropData._</span><span class="sxs-lookup"><span data-stu-id="01ca1-151">Call the **IUnknown::AddRef** method in the host provider's property object, which is the object pointed to by the  _lpMAPIPropData_ parameter.</span></span> 
    
4. <span data-ttu-id="01ca1-152">Si el  _parámetro ulTemplateFlags_ se establece en FILL_ENTRY:</span><span class="sxs-lookup"><span data-stu-id="01ca1-152">If the  _ulTemplateFlags_ parameter is set to FILL_ENTRY:</span></span> 
    
   1. <span data-ttu-id="01ca1-153">Si el nuevo objeto es un usuario de mensajería o una lista de distribución:</span><span class="sxs-lookup"><span data-stu-id="01ca1-153">If the new object is a messaging user or distribution list:</span></span>
      
      1. <span data-ttu-id="01ca1-154">Recupere todas las propiedades del nuevo objeto, posiblemente llamando a su **método IMAPIProp::GetProps.**</span><span class="sxs-lookup"><span data-stu-id="01ca1-154">Retrieve all of the properties of the new object, possibly by calling its **IMAPIProp::GetProps** method.</span></span> 
          
      2. <span data-ttu-id="01ca1-155">Llame al método **IMAPIProp::SetProps** del proveedor de host para copiar todas las propiedades recuperadas en el objeto de propiedad del proveedor de host.</span><span class="sxs-lookup"><span data-stu-id="01ca1-155">Call the host provider's **IMAPIProp::SetProps** method to copy all of the retrieved properties to the host provider's property object.</span></span> 
      
   2. <span data-ttu-id="01ca1-156">Si el nuevo objeto es un destinatario de uso único, llame al método **IMAPIProp::SetProps** del proveedor de host para establecer las propiedades siguientes:</span><span class="sxs-lookup"><span data-stu-id="01ca1-156">If the new object is a one-off recipient, call the host provider's **IMAPIProp::SetProps** method to set the following properties:</span></span> 
      
      - <span data-ttu-id="01ca1-157">**PR_ADDRTYPE** ([PidTagAddressType](pidtagaddresstype-canonical-property.md)) al tipo de dirección que controla el proveedor.</span><span class="sxs-lookup"><span data-stu-id="01ca1-157">**PR_ADDRTYPE** ([PidTagAddressType](pidtagaddresstype-canonical-property.md)) to the address type handled by your provider.</span></span>
        
      - <span data-ttu-id="01ca1-158">**PR \_ TEMPLATEID** ([PidTagTemplateid](pidtagtemplateid-canonical-property.md)) al identificador de plantilla de los parámetros _lpTemplateID_ y _cbTemplateID._</span><span class="sxs-lookup"><span data-stu-id="01ca1-158">**PR\_TEMPLATEID** ([PidTagTemplateid](pidtagtemplateid-canonical-property.md)) to the template identifier from the  _lpTemplateID_ and  _cbTemplateID_ parameters.</span></span> 
        
      - <span data-ttu-id="01ca1-159">**PR_DISPLAY_TYPE** ([PidTagDisplayType](pidtagdisplaytype-canonical-property.md)) para DT_MAILUSER o DT_DISTLIST, según corresponda.</span><span class="sxs-lookup"><span data-stu-id="01ca1-159">**PR_DISPLAY_TYPE** ([PidTagDisplayType](pidtagdisplaytype-canonical-property.md)) to DT_MAILUSER or DT_DISTLIST, as appropriate.</span></span>
    
5. <span data-ttu-id="01ca1-160">Establezca el contenido del parámetro  _lppMAPIPropNew_ para que apunte al nuevo objeto del proveedor o al objeto de propiedad pasado con el parámetro  _lpMAPIPropData,_ dependiendo de si el proveedor determina que un objeto ajustado es necesario.</span><span class="sxs-lookup"><span data-stu-id="01ca1-160">Set the contents of the  _lppMAPIPropNew_ parameter to point to either your provider's new object or the property object passed in with the  _lpMAPIPropData_ parameter, depending on whether your provider determines a wrapped object is necessary.</span></span> 
    
6. <span data-ttu-id="01ca1-161">Si se produce un error crítico, como un error de red o una condición de falta de memoria, devuelve el valor de error adecuado.</span><span class="sxs-lookup"><span data-stu-id="01ca1-161">If a critical error occurs, such as a network failure or an out of memory condition, return the appropriate error value.</span></span> <span data-ttu-id="01ca1-162">Este valor debe propagarse al cliente con la estructura [MAPIERROR](mapierror.md) adecuada, una tarea realizada por el proveedor de host.</span><span class="sxs-lookup"><span data-stu-id="01ca1-162">This value should get propagated to the client with the appropriate [MAPIERROR](mapierror.md) structure, a task performed by the host provider.</span></span> 
    

