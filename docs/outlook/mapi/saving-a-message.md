---
title: Guardar un mensaje
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
localization_priority: Normal
api_type:
- COM
ms.assetid: 97bff16b-dc7c-4eed-8834-d0c076d83ca3
description: 'Última modificación: 23 de julio de 2011'
ms.openlocfilehash: e61a72691309b2ac632b764c0607f5b1e36b291b
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/11/2018
ms.locfileid: "19820554"
---
# <a name="saving-a-message"></a><span data-ttu-id="48a6e-103">Guardar un mensaje</span><span class="sxs-lookup"><span data-stu-id="48a6e-103">Saving a Message</span></span>

  
  
<span data-ttu-id="48a6e-104">**Hace referencia a**: Outlook</span><span class="sxs-lookup"><span data-stu-id="48a6e-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="48a6e-105">Antes de que se guarde un mensaje, los clientes normalmente llaman al método [IMAPIProp::SetProps](imapiprop-setprops.md) del mensaje para establecer algunas propiedades además de las propiedades de texto del mensaje, las propiedades de los datos adjuntos, **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)) y las propiedades asociada con la lista de destinatarios.</span><span class="sxs-lookup"><span data-stu-id="48a6e-105">Before a message is saved, clients typically call the message's [IMAPIProp::SetProps](imapiprop-setprops.md) method to set a few properties in addition to the message text properties, attachment properties, **PR_SUBJECT** ([PidTagSubject](pidtagsubject-canonical-property.md)), and properties associated with the recipient list.</span></span>
  
<span data-ttu-id="48a6e-106">Establezca la propiedad **PR_MESSAGE_CLASS** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md)) en una cadena de caracteres como IPM. Tenga en cuenta que describe la clase del mensaje saliente.</span><span class="sxs-lookup"><span data-stu-id="48a6e-106">Set the **PR_MESSAGE_CLASS** ([PidTagMessageClass](pidtagmessageclass-canonical-property.md)) property to a character string such as IPM.Note that describes the class of the outgoing message.</span></span> <span data-ttu-id="48a6e-107">Aunque los clientes deben establecer **PR_MESSAGE_CLASS** en todos los mensajes salientes, un valor predeterminado es proporcionado por el proveedor de almacenamiento de mensaje si no se establece.</span><span class="sxs-lookup"><span data-stu-id="48a6e-107">Although clients should set **PR_MESSAGE_CLASS** on all outgoing messages, a default value is supplied by the message store provider if you do not set it.</span></span> <span data-ttu-id="48a6e-108">La clase de mensaje predeterminada para los mensajes salientes es IPM.</span><span class="sxs-lookup"><span data-stu-id="48a6e-108">The default message class for outgoing messages is IPM.</span></span> 
  
<span data-ttu-id="48a6e-109">Establecer la marca MSGFLAG_UNSENT en la propiedad **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="48a6e-109">Set the MSGFLAG_UNSENT flag in the **PR_MESSAGE_FLAGS** ([PidTagMessageFlags](pidtagmessageflags-canonical-property.md)) property.</span></span> <span data-ttu-id="48a6e-110">Si lo desea, también establecer los indicadores MSGFLAG_READ y MSGFLAG_UNMODIFIED.</span><span class="sxs-lookup"><span data-stu-id="48a6e-110">If desired, also set the MSGFLAG_READ and MSGFLAG_UNMODIFIED flags.</span></span> <span data-ttu-id="48a6e-111">Configuración de la MSGFLAG_UNMODIFIED permite un mensaje que esté redactando simular un mensaje entregado.</span><span class="sxs-lookup"><span data-stu-id="48a6e-111">Setting the MSGFLAG_UNMODIFIED allows a message under composition to simulate a delivered message.</span></span> <span data-ttu-id="48a6e-112">Sólo se puede establecer MSGFLAG_UNMODIFIED por los clientes antes de que un mensaje se ha guardado por primera vez.</span><span class="sxs-lookup"><span data-stu-id="48a6e-112">MSGFLAG_UNMODIFIED can only be set by clients before a message has been saved for the first time.</span></span> 
  
<span data-ttu-id="48a6e-113">Cuando esté listo para realizar una copia de un mensaje no enviado permanente, llame a [IMAPIProp::SaveChanges](imapiprop-savechanges.md) en el mensaje y todos sus datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="48a6e-113">When you are ready to make a permanent copy of an unsent message, call [IMAPIProp::SaveChanges](imapiprop-savechanges.md) on the message and all of its attachments.</span></span> <span data-ttu-id="48a6e-114">Si va a enviar el mensaje inmediatamente, no es necesario llamar a **SaveChanges**.</span><span class="sxs-lookup"><span data-stu-id="48a6e-114">If you intend to send the message right away, you do not need to call **SaveChanges**.</span></span> <span data-ttu-id="48a6e-115">La llamada a **SubmitMessage** internamente guarda el mensaje como parte de su procesamiento.</span><span class="sxs-lookup"><span data-stu-id="48a6e-115">The call to **SubmitMessage** internally saves the message as part of its processing.</span></span> 
  
<span data-ttu-id="48a6e-116">Al llamar al método **SaveChanges**, es una buena idea para especificar la marca KEEP_OPEN_READWRITE, que permite que el mensaje que desea modificar en un momento posterior.</span><span class="sxs-lookup"><span data-stu-id="48a6e-116">When calling **SaveChanges**, it is a good idea to specify the KEEP_OPEN_READWRITE flag, which allows the message to be modified at a later time.</span></span> <span data-ttu-id="48a6e-117">Otros marcadores configurables incluyen FORCE_SAVE, lo que indica que el mensaje o adjunto debe cerrarse después de que los cambios se confirman, KEEP_OPEN_READONLY, que indica que no se va a realizar ningún cambio adicional, y el indicador para permitir que al proveedor de almacenamiento de mensajes a solicitudes de cliente de proceso por lotes, MAPI_DEFERRED_ERRORS.</span><span class="sxs-lookup"><span data-stu-id="48a6e-117">Other settable flags include FORCE_SAVE, which indicates that the message or attachment should be closed after changes are committed, KEEP_OPEN_READONLY, which indicates that no further changes will be made, and the flag to allow the message store provider to batch client requests, MAPI_DEFERRED_ERRORS.</span></span>
  
<span data-ttu-id="48a6e-118">Es esencial llamar **SaveChanges** por cada dato adjunto en el mensaje antes de llamar a **SaveChanges** para el mensaje.</span><span class="sxs-lookup"><span data-stu-id="48a6e-118">It is essential that you call **SaveChanges** for every attachment in the message before you call **SaveChanges** for the message.</span></span> <span data-ttu-id="48a6e-119">Si no puede guardar un archivo adjunto, los datos adjuntos no se incluirán con el mensaje cuando se envía y no aparecerá en la tabla de datos adjuntos del mensaje.</span><span class="sxs-lookup"><span data-stu-id="48a6e-119">If you fail to save an attachment, the attachment will not be included with the message when it is sent and it will not appear in the message's attachment table.</span></span> <span data-ttu-id="48a6e-120">Si no puede guardar el mensaje después de guardar todos los datos adjuntos, se perderá el mensaje y los datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="48a6e-120">If you fail to save the message after saving all of the attachments, both the message and the attachments will be lost.</span></span> 
  
<span data-ttu-id="48a6e-121">Cuando se llama a **SaveChanges** , el proveedor de almacenamiento de mensaje actualiza las propiedades siguientes:</span><span class="sxs-lookup"><span data-stu-id="48a6e-121">When **SaveChanges** is called, the message store provider updates the following properties:</span></span> 
  
- <span data-ttu-id="48a6e-122">**PR_DISPLAY_TO de MAPI** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md)) se enumeran a todos los destinatarios principales.</span><span class="sxs-lookup"><span data-stu-id="48a6e-122">**PR_DISPLAY_TO** ([PidTagDisplayTo](pidtagdisplayto-canonical-property.md)) lists all primary recipients.</span></span>
    
- <span data-ttu-id="48a6e-123">**PR_DISPLAY_TO de MAPI** se enumeran a todos los destinatarios en copia oculta.</span><span class="sxs-lookup"><span data-stu-id="48a6e-123">**PR_DISPLAY_TO** lists all carbon copy recipients.</span></span> 
    
- <span data-ttu-id="48a6e-124">**PR_DISPLAY_BCC** ([PidTagDisplayBcc](pidtagdisplaybcc-canonical-property.md)) se enumeran a todos los destinatarios en copia oculta.</span><span class="sxs-lookup"><span data-stu-id="48a6e-124">**PR_DISPLAY_BCC** ([PidTagDisplayBcc](pidtagdisplaybcc-canonical-property.md)) lists all blind carbon copy recipients.</span></span>
    
- <span data-ttu-id="48a6e-125">**PR_LAST_MODIFICATION_TIME** ([PidTagLastModificationTime](pidtaglastmodificationtime-canonical-property.md))</span><span class="sxs-lookup"><span data-stu-id="48a6e-125">**PR_LAST_MODIFICATION_TIME** ([PidTagLastModificationTime](pidtaglastmodificationtime-canonical-property.md))</span></span>
    
- <span data-ttu-id="48a6e-126">**PR_MESSAGE_FLAGS** establece MSGFLAG_HASATTACH si uno o más datos adjuntos se han guardado y borra MSGFLAG_UNMODIFIED para mostrar que el mensaje ha cambiado.</span><span class="sxs-lookup"><span data-stu-id="48a6e-126">**PR_MESSAGE_FLAGS** sets MSGFLAG_HASATTACH if one or more attachments have been saved and clears MSGFLAG_UNMODIFIED to show the message has changed.</span></span> 
    
- <span data-ttu-id="48a6e-127">**PR_MESSAGE_SIZE** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md)) contiene el tamaño del mensaje más reciente.</span><span class="sxs-lookup"><span data-stu-id="48a6e-127">**PR_MESSAGE_SIZE** ([PidTagMessageSize](pidtagmessagesize-canonical-property.md)) contains the most current size of the message.</span></span>
    
- <span data-ttu-id="48a6e-128">**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) proporciona acceso a la tabla de datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="48a6e-128">**PR_MESSAGE_ATTACHMENTS** ([PidTagMessageAttachments](pidtagmessageattachments-canonical-property.md)) provides access to the attachment table.</span></span>
    
- <span data-ttu-id="48a6e-129">**PR_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) proporciona acceso a la tabla de destinatarios.</span><span class="sxs-lookup"><span data-stu-id="48a6e-129">**PR_MESSAGE_RECIPIENTS** ([PidTagMessageRecipients](pidtagmessagerecipients-canonical-property.md)) provides access to the recipient table.</span></span>
    
<span data-ttu-id="48a6e-130">Algunas propiedades del mensaje normalmente suministradas por los clientes o proveedores de servicio cuando se crea un mensaje.</span><span class="sxs-lookup"><span data-stu-id="48a6e-130">Some message properties are typically supplied by clients or service providers when a message is created.</span></span> <span data-ttu-id="48a6e-131">Si un cliente no establecerlos, es hasta el proveedor de almacenamiento de mensajes para actualizarlos en el momento en que se llama a **SaveChanges** .</span><span class="sxs-lookup"><span data-stu-id="48a6e-131">If a client neglects to set them, it is up to the message store provider to update them at the time **SaveChanges** is called.</span></span> <span data-ttu-id="48a6e-132">Por ejemplo, si un mensaje de la **entrada del objeto** ([PidTagEntryId](pidtagentryid-canonical-property.md)) y las propiedades de **PR_RECORD_KEY** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md)) se establecieron cuando se creó el mensaje, no es necesario modificar en el momento de guardar.</span><span class="sxs-lookup"><span data-stu-id="48a6e-132">For example, if a message's **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) and **PR_RECORD_KEY** ([PidTagRecordKey](pidtagrecordkey-canonical-property.md)) properties were set when the message was created, they need not be modified at save time.</span></span> <span data-ttu-id="48a6e-133">Sin embargo, los proveedores de almacén de mensajes que olvidó establecerlas durante la creación del mensaje deben establecerlas la primera vez que se llama a **SaveChanges** .</span><span class="sxs-lookup"><span data-stu-id="48a6e-133">However, message store providers that neglect to set them at message creation must set them the first time that **SaveChanges** is called.</span></span> 
  
<span data-ttu-id="48a6e-134">Si el **valor de SaveChanges** devuelve MAPI_E_CORRUPT_DATA, suponga que los datos que se guardan están ahora perdido.</span><span class="sxs-lookup"><span data-stu-id="48a6e-134">If **SaveChanges** returns MAPI_E_CORRUPT_DATA, assume that the data being saved is now lost.</span></span> <span data-ttu-id="48a6e-135">Los proveedores de almacén de mensajes que usan un modelo de servidor de cliente para su implementación podrían devolver este valor cuando se pierde la conexión de red o el servidor no se está ejecutando.</span><span class="sxs-lookup"><span data-stu-id="48a6e-135">Message store providers that use a client-server model for their implementation might return this value when a network connection is lost or the server is not running.</span></span> <span data-ttu-id="48a6e-136">Antes de devolver un error al usuario, intente escribir y guardar los datos de una segunda vez mediante una llamada a **SetProps** seguida de otra llamada a **SaveChanges**.</span><span class="sxs-lookup"><span data-stu-id="48a6e-136">Before returning an error to the user, try to write and save the data a second time by making a call to **SetProps** followed by another call to **SaveChanges**.</span></span> <span data-ttu-id="48a6e-137">Si los datos se almacena en caché localmente, esto no debería ser un problema.</span><span class="sxs-lookup"><span data-stu-id="48a6e-137">If the data is cached locally, this should not be a problem.</span></span> <span data-ttu-id="48a6e-138">Sin embargo, si no hay ninguna caché local o se produce un error en la segunda llamada **SaveChanges** , mostrar un error para alertar al usuario sobre el problema.</span><span class="sxs-lookup"><span data-stu-id="48a6e-138">However, if there is no local cache or the second **SaveChanges** call fails, display an error to alert the user to the problem.</span></span> 
  

