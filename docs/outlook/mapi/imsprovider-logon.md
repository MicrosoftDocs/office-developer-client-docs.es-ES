---
title: IMSProviderLogon
manager: soliver
ms.date: 11/16/2014
ms.audience: Developer
ms.topic: reference
ms.prod: office-online-server
localization_priority: Normal
api_name:
- IMSProvider.Logon
api_type:
- COM
ms.assetid: 890d9cbe-3570-4cf0-aeae-667c0e5ba181
description: 'Última modificación: 23 de julio de 2011'
ms.openlocfilehash: b89c8129f68852bdd243a7f984497ab312aa2551
ms.sourcegitcommit: 9d60cd82b5413446e5bc8ace2cd689f683fb41a7
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 06/11/2018
ms.locfileid: "19817833"
---
# <a name="imsproviderlogon"></a><span data-ttu-id="e3a83-103">IMSProvider::Logon</span><span class="sxs-lookup"><span data-stu-id="e3a83-103">IMSProvider::Logon</span></span>

  
  
<span data-ttu-id="e3a83-104">**Hace referencia a**: Outlook</span><span class="sxs-lookup"><span data-stu-id="e3a83-104">**Applies to**: Outlook</span></span> 
  
<span data-ttu-id="e3a83-105">Registros MAPI sesión en una instancia de un proveedor de almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e3a83-105">Logs MAPI on to one instance of a message store provider.</span></span>
  
```cpp
HRESULT Logon(
  LPMAPISUP lpMAPISup,
  ULONG_PTR ulUIParam,
  LPSTR lpszProfileName,
  ULONG cbEntryID,
  LPENTRYID lpEntryID,
  ULONG ulFlags,
  LPCIID lpInterface,
  ULONG FAR * lpcbSpoolSecurity,
  LPBYTE FAR * lppbSpoolSecurity,
  LPMAPIERROR FAR * lppMAPIError,
  LPMSLOGON FAR * lppMSLogon,
  LPMDB FAR * lppMDB
);
```

## <a name="parameters"></a><span data-ttu-id="e3a83-106">Parámetros</span><span class="sxs-lookup"><span data-stu-id="e3a83-106">Parameters</span></span>

 <span data-ttu-id="e3a83-107">_lpMAPISup_</span><span class="sxs-lookup"><span data-stu-id="e3a83-107">_lpMAPISup_</span></span>
  
> <span data-ttu-id="e3a83-108">[entrada] Un puntero a la interfaz MAPI actual admite el objeto para el almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e3a83-108">[in] A pointer to the current MAPI support object for the message store.</span></span>
    
 <span data-ttu-id="e3a83-109">_ulUIParam_</span><span class="sxs-lookup"><span data-stu-id="e3a83-109">_ulUIParam_</span></span>
  
> <span data-ttu-id="e3a83-110">[entrada] Un identificador de la ventana principal de windows o cuadros de diálogo que muestra este método.</span><span class="sxs-lookup"><span data-stu-id="e3a83-110">[in] A handle to the parent window of any dialog boxes or windows this method displays.</span></span> 
    
 <span data-ttu-id="e3a83-111">_lpszProfileName_</span><span class="sxs-lookup"><span data-stu-id="e3a83-111">_lpszProfileName_</span></span>
  
> <span data-ttu-id="e3a83-112">[entrada] Un puntero a una cadena que contiene el nombre del perfil que se utiliza para el inicio de sesión de proveedor de almacén.</span><span class="sxs-lookup"><span data-stu-id="e3a83-112">[in] A pointer to a string that contains the name of the profile being used for store provider logon.</span></span> <span data-ttu-id="e3a83-113">Esta cadena se puede que se muestra en los cuadros de diálogo, escriben en un archivo de registro o simplemente se omite.</span><span class="sxs-lookup"><span data-stu-id="e3a83-113">This string can be displayed in dialog boxes, written out to a log file, or simply ignored.</span></span> <span data-ttu-id="e3a83-114">Debe estar en formato Unicode si está establecido el indicador MAPI_UNICODE en el parámetro _ulFlags indicado_ .</span><span class="sxs-lookup"><span data-stu-id="e3a83-114">It must be in Unicode format if the MAPI_UNICODE flag is set in the  _ulFlags_ parameter.</span></span> 
    
 <span data-ttu-id="e3a83-115">_cbEntryID_</span><span class="sxs-lookup"><span data-stu-id="e3a83-115">_cbEntryID_</span></span>
  
> <span data-ttu-id="e3a83-116">[entrada] El tamaño, en bytes, del identificador de entrada indicada por el parámetro _lpEntryID_ .</span><span class="sxs-lookup"><span data-stu-id="e3a83-116">[in] The size, in bytes, of the entry identifier pointed to by the  _lpEntryID_ parameter.</span></span> 
    
 <span data-ttu-id="e3a83-117">_lpEntryID_</span><span class="sxs-lookup"><span data-stu-id="e3a83-117">_lpEntryID_</span></span>
  
> <span data-ttu-id="e3a83-118">[entrada] Un puntero al identificador de entrada para el almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e3a83-118">[in] A pointer to the entry identifier for the message store.</span></span> <span data-ttu-id="e3a83-119">Pasar **null** en _lpEntryID_ indica que no se ha seleccionado aún un almacén de mensajes y que se pueden presentar cuadros de diálogo que permiten al usuario seleccionar un almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e3a83-119">Passing **null** in  _lpEntryID_ indicates that a message store has not yet been selected and that dialog boxes that enable the user to select a message store can be presented.</span></span> 
    
 <span data-ttu-id="e3a83-120">_ulFlags_</span><span class="sxs-lookup"><span data-stu-id="e3a83-120">_ulFlags_</span></span>
  
> <span data-ttu-id="e3a83-121">[entrada] Una máscara de bits de indicadores que controla cómo se realiza el inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="e3a83-121">[in] A bitmask of flags that controls how the logon is performed.</span></span> <span data-ttu-id="e3a83-122">Se pueden establecer los siguientes indicadores:</span><span class="sxs-lookup"><span data-stu-id="e3a83-122">The following flags can be set:</span></span>
    
<span data-ttu-id="e3a83-123">MAPI_DEFERRED_ERRORS</span><span class="sxs-lookup"><span data-stu-id="e3a83-123">MAPI_DEFERRED_ERRORS</span></span> 
  
> <span data-ttu-id="e3a83-124">Se autoriza la llamada se realice correctamente, incluso si el objeto subyacente no está disponible para la implementación de la llamada.</span><span class="sxs-lookup"><span data-stu-id="e3a83-124">The call is allowed to succeed even if the underlying object is not available to the calling implementation.</span></span> <span data-ttu-id="e3a83-125">Si el objeto no está disponible, una llamada posterior al objeto podría provocar un error.</span><span class="sxs-lookup"><span data-stu-id="e3a83-125">If the object is not available, a subsequent call to the object might raise an error.</span></span>
    
<span data-ttu-id="e3a83-126">MAPI_UNICODE.</span><span class="sxs-lookup"><span data-stu-id="e3a83-126">MAPI_UNICODE</span></span> 
  
> <span data-ttu-id="e3a83-127">Las cadenas que se pasan en están en formato Unicode.</span><span class="sxs-lookup"><span data-stu-id="e3a83-127">The passed-in strings are in Unicode format.</span></span> <span data-ttu-id="e3a83-128">Si no se establece MAPI_UNICODE., las cadenas están en formato ANSI.</span><span class="sxs-lookup"><span data-stu-id="e3a83-128">If MAPI_UNICODE is not set, the strings are in ANSI format.</span></span>
    
<span data-ttu-id="e3a83-129">MDB_NO_DIALOG</span><span class="sxs-lookup"><span data-stu-id="e3a83-129">MDB_NO_DIALOG</span></span> 
  
> <span data-ttu-id="e3a83-130">Impide la presentación de cuadros de diálogo de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="e3a83-130">Prevents the display of logon dialog boxes.</span></span> <span data-ttu-id="e3a83-131">Si se establece este marcador, se devuelve el valor de error MAPI_E_LOGON_FAILED si el inicio de sesión se realiza correctamente.</span><span class="sxs-lookup"><span data-stu-id="e3a83-131">If this flag is set, the error value MAPI_E_LOGON_FAILED is returned if the logon is unsuccessful.</span></span> <span data-ttu-id="e3a83-132">Si no se establece este indicador, el proveedor de almacenamiento de mensaje puede solicitar al usuario para corregir un nombre o una contraseña, para insertar un disco, o para llevar a cabo otras acciones que son necesarias para establecer la conexión con el almacén.</span><span class="sxs-lookup"><span data-stu-id="e3a83-132">If this flag is not set, the message store provider can prompt the user to correct a name or password, to insert a disk, or to perform other actions that are necessary to establish connection to the store.</span></span>
    
<span data-ttu-id="e3a83-133">MDB_NO_MAIL</span><span class="sxs-lookup"><span data-stu-id="e3a83-133">MDB_NO_MAIL</span></span> 
  
> <span data-ttu-id="e3a83-134">El almacén de mensajes no debe usarse para enviar o recibir correo.</span><span class="sxs-lookup"><span data-stu-id="e3a83-134">The message store should not be used for sending or receiving mail.</span></span> <span data-ttu-id="e3a83-135">La marca de señales de MAPI no para notificar a la cola MAPI que se va a abrir este almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e3a83-135">The flag signals MAPI not to notify the MAPI spooler that this message store is being opened.</span></span> <span data-ttu-id="e3a83-136">Si se establece este indicador y el almacén de mensajes se complementa con un proveedor de transporte, el proveedor no es necesario llamar al método [SpoolerNotify](imapisupport-spoolernotify.md) .</span><span class="sxs-lookup"><span data-stu-id="e3a83-136">If this flag is set and the message store is tightly coupled with a transport provider, the provider does not need to call the [IMAPISupport::SpoolerNotify](imapisupport-spoolernotify.md) method.</span></span> 
    
<span data-ttu-id="e3a83-137">MDB_TEMPORARY</span><span class="sxs-lookup"><span data-stu-id="e3a83-137">MDB_TEMPORARY</span></span> 
  
> <span data-ttu-id="e3a83-138">Los registros en el almacén de modo que la información se puede recuperar mediante programación en la sección de perfil, sin el uso de cuadros de diálogo.</span><span class="sxs-lookup"><span data-stu-id="e3a83-138">Logs on the store so that information can be retrieved programmatically from the profile section, without use of dialog boxes.</span></span> <span data-ttu-id="e3a83-139">Esta marca indica a MAPI, que es el almacén no que se agregarán a la tabla de almacén de mensajes y que el almacén no se pueden hacer permanente.</span><span class="sxs-lookup"><span data-stu-id="e3a83-139">This flag instructs MAPI that the store is not to be added to the message store table and that the store cannot be made permanent.</span></span> <span data-ttu-id="e3a83-140">Si se establece este marcador, los proveedores de almacén de mensajes no es necesario llamar al método [IMAPISupport::ModifyProfile](imapisupport-modifyprofile.md) .</span><span class="sxs-lookup"><span data-stu-id="e3a83-140">If this flag is set, message store providers do not need to call the [IMAPISupport::ModifyProfile](imapisupport-modifyprofile.md) method.</span></span> 
    
<span data-ttu-id="e3a83-141">MDB_WRITE</span><span class="sxs-lookup"><span data-stu-id="e3a83-141">MDB_WRITE</span></span> 
  
> <span data-ttu-id="e3a83-142">Las solicitudes de permiso de lectura y escritura.</span><span class="sxs-lookup"><span data-stu-id="e3a83-142">Requests read/write permission.</span></span>
    
 <span data-ttu-id="e3a83-143">_lpInterface_</span><span class="sxs-lookup"><span data-stu-id="e3a83-143">_lpInterface_</span></span>
  
> <span data-ttu-id="e3a83-144">[entrada] Un puntero para el identificador de interfaz (IID) para iniciar sesión en el almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e3a83-144">[in] A pointer to the interface identifier (IID) for the message store to log on to.</span></span> <span data-ttu-id="e3a83-145">Si se pasa **null** indica que se devuelve la interfaz de MAPI para el almacén de mensajes ( [IMsgStore](imsgstoreimapiprop.md)).</span><span class="sxs-lookup"><span data-stu-id="e3a83-145">Passing **null** indicates the MAPI interface for the message store ( [IMsgStore](imsgstoreimapiprop.md)) is returned.</span></span> <span data-ttu-id="e3a83-146">El parámetro _lpInterface_ también se puede establecer en un identificador para una interfaz adecuada para el almacén de mensajes (por ejemplo, IID_IUnknown o IID_IMAPIProp).</span><span class="sxs-lookup"><span data-stu-id="e3a83-146">The  _lpInterface_ parameter can also be set to an identifier for an appropriate interface for the message store (for example, IID_IUnknown or IID_IMAPIProp).</span></span> 
    
 <span data-ttu-id="e3a83-147">_lpcbSpoolSecurity_</span><span class="sxs-lookup"><span data-stu-id="e3a83-147">_lpcbSpoolSecurity_</span></span>
  
> <span data-ttu-id="e3a83-148">[out] Un puntero a la variable en el que el proveedor de almacenamiento devuelve el tamaño, en bytes, de los datos de validación en el parámetro _lppbSpoolSecurity_ .</span><span class="sxs-lookup"><span data-stu-id="e3a83-148">[out] A pointer to the variable in which the store provider returns the size, in bytes, of the validation data in the  _lppbSpoolSecurity_ parameter.</span></span> 
    
 <span data-ttu-id="e3a83-149">_lppbSpoolSecurity_</span><span class="sxs-lookup"><span data-stu-id="e3a83-149">_lppbSpoolSecurity_</span></span>
  
> <span data-ttu-id="e3a83-150">[out] Un puntero al puntero a los datos de validación devuelto.</span><span class="sxs-lookup"><span data-stu-id="e3a83-150">[out] A pointer to the pointer to the returned validation data.</span></span> <span data-ttu-id="e3a83-151">Esta validación de datos se proporciona para que el método [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) puede iniciar sesión en el mismo almacén de la cola de MAPI como el proveedor de almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e3a83-151">This validation data is provided so the [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) method can log the MAPI spooler on to the same store as the message store provider.</span></span> 
    
 <span data-ttu-id="e3a83-152">_lppMAPIError_</span><span class="sxs-lookup"><span data-stu-id="e3a83-152">_lppMAPIError_</span></span>
  
> <span data-ttu-id="e3a83-153">[out] Un puntero a un puntero a la [MAPIERROR](mapierror.md) estructura devuelta, si lo hay, que contiene información de versión, el componente y el contexto de un error.</span><span class="sxs-lookup"><span data-stu-id="e3a83-153">[out] A pointer to a pointer to the returned [MAPIERROR](mapierror.md) structure, if any, that contains version, component, and context information for an error.</span></span> <span data-ttu-id="e3a83-154">El parámetro _lppMAPIError_ se puede establecer en **null** si no hay ninguna estructura **MAPIERROR** para devolver.</span><span class="sxs-lookup"><span data-stu-id="e3a83-154">The  _lppMAPIError_ parameter can be set to **null** if there is no **MAPIERROR** structure to return.</span></span> 
    
 <span data-ttu-id="e3a83-155">_lppMSLogon_</span><span class="sxs-lookup"><span data-stu-id="e3a83-155">_lppMSLogon_</span></span>
  
> <span data-ttu-id="e3a83-156">[out] Un puntero al puntero para el mensaje almacena el objeto de inicio de sesión de MAPI iniciar sesión en.</span><span class="sxs-lookup"><span data-stu-id="e3a83-156">[out] A pointer to the pointer to the message store logon object for MAPI to log on to.</span></span>
    
 <span data-ttu-id="e3a83-157">_lppMDB_</span><span class="sxs-lookup"><span data-stu-id="e3a83-157">_lppMDB_</span></span>
  
> <span data-ttu-id="e3a83-158">[out] Un puntero al puntero para el mensaje almacena el objeto de la cola MAPI y las aplicaciones de cliente para iniciar sesión en.</span><span class="sxs-lookup"><span data-stu-id="e3a83-158">[out] A pointer to the pointer to the message store object for the MAPI spooler and client applications to log on to.</span></span>
    
## <a name="return-value"></a><span data-ttu-id="e3a83-159">Valor devuelto</span><span class="sxs-lookup"><span data-stu-id="e3a83-159">Return value</span></span>

<span data-ttu-id="e3a83-160">S_OK</span><span class="sxs-lookup"><span data-stu-id="e3a83-160">S_OK</span></span> 
  
> <span data-ttu-id="e3a83-161">La llamada se ha realizado correctamente y devuelva el valor esperado o los valores.</span><span class="sxs-lookup"><span data-stu-id="e3a83-161">The call succeeded and has returned the expected value or values.</span></span>
    
<span data-ttu-id="e3a83-162">MAPI_E_FAILONEPROVIDER</span><span class="sxs-lookup"><span data-stu-id="e3a83-162">MAPI_E_FAILONEPROVIDER</span></span> 
  
> <span data-ttu-id="e3a83-163">Este proveedor no puede iniciar sesión, pero este error debe deshabilitar el servicio.</span><span class="sxs-lookup"><span data-stu-id="e3a83-163">This provider cannot log on, but this error should not disable the service.</span></span> 
    
<span data-ttu-id="e3a83-164">MAPI_E_LOGON_FAILED</span><span class="sxs-lookup"><span data-stu-id="e3a83-164">MAPI_E_LOGON_FAILED</span></span> 
  
> <span data-ttu-id="e3a83-165">No se pudo establecer una sesión de inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="e3a83-165">A logon session could not be established.</span></span>
    
<span data-ttu-id="e3a83-166">MAPI_E_UNCONFIGURED</span><span class="sxs-lookup"><span data-stu-id="e3a83-166">MAPI_E_UNCONFIGURED</span></span> 
  
> <span data-ttu-id="e3a83-167">El perfil no contiene información suficiente para el inicio de sesión para llevar a cabo.</span><span class="sxs-lookup"><span data-stu-id="e3a83-167">The profile does not contain enough information for the logon to complete.</span></span> <span data-ttu-id="e3a83-168">Cuando se devuelve este valor, MAPI llama la función de punto de entrada del servicio de mensajes del proveedor de almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e3a83-168">When this value is returned, MAPI calls the message store provider's message-service entry point function.</span></span>
    
<span data-ttu-id="e3a83-169">MAPI_E_USER_CANCEL</span><span class="sxs-lookup"><span data-stu-id="e3a83-169">MAPI_E_USER_CANCEL</span></span> 
  
> <span data-ttu-id="e3a83-170">El usuario canceló la operación, normalmente haciendo clic en el botón **Cancelar** en un cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="e3a83-170">The user canceled the operation, typically by clicking the **Cancel** button in a dialog box.</span></span> 
    
<span data-ttu-id="e3a83-171">MAPI_E_UNKNOWN_CPID</span><span class="sxs-lookup"><span data-stu-id="e3a83-171">MAPI_E_UNKNOWN_CPID</span></span> 
  
> <span data-ttu-id="e3a83-172">El servidor no está configurado para admitir la página de códigos del cliente.</span><span class="sxs-lookup"><span data-stu-id="e3a83-172">The server is not configured to support the client's code page.</span></span>
    
<span data-ttu-id="e3a83-173">MAPI_E_UNKNOWN_LCID</span><span class="sxs-lookup"><span data-stu-id="e3a83-173">MAPI_E_UNKNOWN_LCID</span></span> 
  
> <span data-ttu-id="e3a83-174">El servidor no está configurado para admitir la información de configuración regional del cliente.</span><span class="sxs-lookup"><span data-stu-id="e3a83-174">The server is not configured to support the client's locale information.</span></span>
    
<span data-ttu-id="e3a83-175">MAPI_W_ERRORS_RETURNED</span><span class="sxs-lookup"><span data-stu-id="e3a83-175">MAPI_W_ERRORS_RETURNED</span></span> 
  
> <span data-ttu-id="e3a83-176">La llamada se ha realizado correctamente, pero el proveedor de almacén de mensajes tiene información de error disponible.</span><span class="sxs-lookup"><span data-stu-id="e3a83-176">The call succeeded, but the message store provider has error information available.</span></span> <span data-ttu-id="e3a83-177">Cuando se devuelve esta advertencia, la llamada se debe controlarse como correcta.</span><span class="sxs-lookup"><span data-stu-id="e3a83-177">When this warning is returned, the call should be handled as successful.</span></span> <span data-ttu-id="e3a83-178">Para probar esta advertencia, utilice la macro **HR_FAILED** .</span><span class="sxs-lookup"><span data-stu-id="e3a83-178">To test for this warning, use the **HR_FAILED** macro.</span></span> <span data-ttu-id="e3a83-179">Para obtener más información, vea [Uso de Macros para el control de errores](using-macros-for-error-handling.md).</span><span class="sxs-lookup"><span data-stu-id="e3a83-179">For more information, see [Using Macros for Error Handling](using-macros-for-error-handling.md).</span></span> <span data-ttu-id="e3a83-180">Para obtener la información de error desde el proveedor, llame al método [IMAPISession::GetLastError](imapisession-getlasterror.md) .</span><span class="sxs-lookup"><span data-stu-id="e3a83-180">To get the error information from the provider, call the [IMAPISession::GetLastError](imapisession-getlasterror.md) method.</span></span> 
    
## <a name="remarks"></a><span data-ttu-id="e3a83-181">Comentarios</span><span class="sxs-lookup"><span data-stu-id="e3a83-181">Remarks</span></span>

<span data-ttu-id="e3a83-182">MAPI llama el método **IMSProvider::Logon** para llevar a cabo la mayoría de los procesos necesarios para obtener acceso a un almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e3a83-182">MAPI calls the **IMSProvider::Logon** method to do the majority of processing necessary to obtain access to a message store.</span></span> <span data-ttu-id="e3a83-183">Los proveedores de almacén de mensajes validar cualquier las credenciales de usuario necesarias para tener acceso a un almacén determinado y devolver un objeto de almacén de mensajes en el parámetro _lppMDB_ que las aplicaciones de cliente y de la cola de impresión MAPI pueden iniciar sesión en.</span><span class="sxs-lookup"><span data-stu-id="e3a83-183">Message store providers validate any user credentials necessary to access a particular store and return a message store object in the  _lppMDB_ parameter that the MAPI spooler and client applications can log on to.</span></span> 
  
<span data-ttu-id="e3a83-184">Además del objeto de almacén de mensaje devuelto para el cliente y el uso de la cola de impresión MAPI, el proveedor también devuelve un objeto de inicio de sesión del almacén de mensajes de MAPI usar en el control de la tienda abierta.</span><span class="sxs-lookup"><span data-stu-id="e3a83-184">In addition to the returned message store object for client and MAPI spooler use, the provider also returns a message store logon object for MAPI to use in controlling the opened store.</span></span> <span data-ttu-id="e3a83-185">El objeto de inicio de sesión del almacén de mensajes y el objeto de almacén de mensajes deben vincularse estrechamente dentro del proveedor de almacén de mensajes para cada uno de ellos puede afectar a la otra.</span><span class="sxs-lookup"><span data-stu-id="e3a83-185">The message store logon object and the message store object should be tightly linked inside the message store provider so each can affect the other.</span></span> <span data-ttu-id="e3a83-186">El uso del objeto de almacenamiento y el objeto de inicio de sesión debe ser idéntico; debe haber una correspondencia uno a uno entre el objeto de inicio de sesión y el objeto de almacén de manera que los objetos que actúe como si fueran un único objeto que expone dos interfaces.</span><span class="sxs-lookup"><span data-stu-id="e3a83-186">The use of the store object and the logon object should be identical; there should be a one-to-one correspondence between the logon object and the store object such that the objects act as if they are one object that exposes two interfaces.</span></span> <span data-ttu-id="e3a83-187">Los dos objetos también se deben crear juntos y liberado juntos.</span><span class="sxs-lookup"><span data-stu-id="e3a83-187">The two objects should also be created together and freed together.</span></span> 
  
<span data-ttu-id="e3a83-188">El objeto compatible con MAPI, creado por MAPI y se pasan al proveedor en el parámetro _lpMAPISup_ , proporciona acceso a las funciones de MAPI que requiere el proveedor.</span><span class="sxs-lookup"><span data-stu-id="e3a83-188">The MAPI support object, created by MAPI and passed to the provider in the  _lpMAPISup_ parameter, provides access to functions in MAPI that the provider requires.</span></span> <span data-ttu-id="e3a83-189">Éstas incluyen las funciones que guardar y recuperar información de perfil, tener acceso a las libretas de direcciones y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="e3a83-189">These include functions that save and retrieve profile information, access address books, and so on.</span></span> <span data-ttu-id="e3a83-190">El puntero _lpMAPISup_ puede ser diferente para cada almacén que se abre.</span><span class="sxs-lookup"><span data-stu-id="e3a83-190">The  _lpMAPISup_ pointer can be different for each store that is opened.</span></span> <span data-ttu-id="e3a83-191">Mientras el procesamiento llama a un almacén de mensajes después de inicio de sesión, el proveedor de almacenamiento debe usar la variable _lpMAPISup_ que es específica de ese almacén.</span><span class="sxs-lookup"><span data-stu-id="e3a83-191">While processing calls for a message store after logon, the store provider should use the  _lpMAPISup_ variable that is specific to that store.</span></span> <span data-ttu-id="e3a83-192">Para cualquier llamada de **Inicio de sesión** que se abre un almacén de mensajes y funciona correctamente en la creación de un objeto de inicio de sesión del almacén de mensajes, el proveedor debe guardar un puntero al objeto de compatibilidad con MAPI en el objeto de inicio de sesión de almacén y debe llamar al método [IUnknown:: AddRef](http://msdn.microsoft.com/en-us/library/ms691379%28v=VS.85%29.aspx) para agregar una referencia para el objeto de soporte.</span><span class="sxs-lookup"><span data-stu-id="e3a83-192">For any **Logon** call that opens a message store and succeeds in creating a message store logon object, the provider must save a pointer to the MAPI support object in the store logon object and must call the [IUnknown::AddRef](http://msdn.microsoft.com/en-us/library/ms691379%28v=VS.85%29.aspx) method to add a reference for the support object.</span></span> 
  
<span data-ttu-id="e3a83-193">El parámetro _ulUIParam_ debe usarse si el proveedor presenta cuadros de diálogo durante la llamada de **Inicio de sesión** .</span><span class="sxs-lookup"><span data-stu-id="e3a83-193">The  _ulUIParam_ parameter should be used if the provider presents dialog boxes during the **Logon** call.</span></span> <span data-ttu-id="e3a83-194">Sin embargo, cuadros de diálogo no deben presentarse si _ulFlags_ contiene la marca MDB_NO_DIALOG.</span><span class="sxs-lookup"><span data-stu-id="e3a83-194">However, dialog boxes should not be presented if  _ulFlags_ contains the MDB_NO_DIALOG flag.</span></span> <span data-ttu-id="e3a83-195">Si necesita una interfaz de usuario que se llame pero _ulFlags_ no permitir, o si por alguna otra razón no se puede mostrar una interfaz de usuario, el proveedor debe devolver MAPI_E_LOGON_FAILED.</span><span class="sxs-lookup"><span data-stu-id="e3a83-195">If a user interface needs to be called but  _ulFlags_ does not allow it, or if for some other reason a user interface cannot be displayed, the provider should return MAPI_E_LOGON_FAILED.</span></span> <span data-ttu-id="e3a83-196">Si el **Inicio de sesión** muestra un cuadro de diálogo y el usuario cancela el inicio de sesión, normalmente haciendo clic en el botón **Cancelar** del cuadro de diálogo, el proveedor debe devolver MAPI_E_USER_CANCEL.</span><span class="sxs-lookup"><span data-stu-id="e3a83-196">If **Logon** displays a dialog box and the user cancels the logon, typically by clicking the dialog box's **Cancel** button, the provider should return MAPI_E_USER_CANCEL.</span></span> 
  
<span data-ttu-id="e3a83-197">El parámetro _lpEntryID_ puede ser **null** o elija un identificador de entrada no ajustado almacén que almacenar este mensaje creado anteriormente.</span><span class="sxs-lookup"><span data-stu-id="e3a83-197">The  _lpEntryID_ parameter can either be **null** or point to an unwrapped store entry identifier that this message store previously created.</span></span> <span data-ttu-id="e3a83-198">Si _lpEntryID_ señala a un identificador de entrada no ajustado, ese identificador de entrada puede proceder de uno de varios lugares:</span><span class="sxs-lookup"><span data-stu-id="e3a83-198">If  _lpEntryID_ points to an unwrapped entry identifier, that entry identifier can come from one of several places:</span></span> 
  
- <span data-ttu-id="e3a83-199">Puede ser un identificador de entrada que el proveedor de almacenamiento anteriormente ajustado y se escribió en la sección de perfil como una propiedad de **entrada del objeto** ([PidTagEntryId](pidtagentryid-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="e3a83-199">It can be an entry identifier that the store provider previously wrapped and wrote to the profile section as a **PR_ENTRYID** ([PidTagEntryId](pidtagentryid-canonical-property.md)) property.</span></span>
    
- <span data-ttu-id="e3a83-200">Puede ser un identificador de entrada que el proveedor anteriormente ajustado y vuelvan a un cliente de la llamada como una propiedad de **PR_STORE_ENTRYID** ([PidTagStoreEntryId](pidtagstoreentryid-canonical-property.md)).</span><span class="sxs-lookup"><span data-stu-id="e3a83-200">It can be an entry identifier that the provider previously wrapped and returned to a calling client as a **PR_STORE_ENTRYID** ([PidTagStoreEntryId](pidtagstoreentryid-canonical-property.md)) property.</span></span> 
    
- <span data-ttu-id="e3a83-201">Puede ser un identificador de entrada que el proveedor anteriormente ajustado y vuelvan a un cliente de la llamada como la propiedad de **entrada del objeto** de un objeto de almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e3a83-201">It can be an entry identifier that the provider previously wrapped and returned to a calling client as the **PR_ENTRYID** property of a message store object.</span></span> 
    
<span data-ttu-id="e3a83-202">En cualquiera de estos casos, es posible que el identificador de entrada se ha creado en un equipo diferente del que usa actualmente.</span><span class="sxs-lookup"><span data-stu-id="e3a83-202">In any of these cases, it is possible that the entry identifier was created on a different computer than the one currently being used.</span></span>
  
<span data-ttu-id="e3a83-203">Cuando _lpEntryID_ no es **nulo**, debe contener toda la información necesaria para identificar y busque el almacén de mensajes.</span><span class="sxs-lookup"><span data-stu-id="e3a83-203">When  _lpEntryID_ is not **null**, it should contain all of the information needed to identify and locate the message store.</span></span> <span data-ttu-id="e3a83-204">Esta información puede incluir los nombres de volumen de red, los números de teléfono, nombres de cuenta de usuario y así sucesivamente.</span><span class="sxs-lookup"><span data-stu-id="e3a83-204">This information can include network volume names, phone numbers, user account names, and so on.</span></span> <span data-ttu-id="e3a83-205">Si la conexión con el almacén no puede realizarse mediante el uso de los datos en el identificador de entrada, el proveedor de almacenamiento debe mostrar un cuadro de diálogo que permite al usuario seleccionar el almacén que se va a abrir.</span><span class="sxs-lookup"><span data-stu-id="e3a83-205">If the connection to the store cannot be made by using the data in the entry identifier, the store provider should display a dialog box that enables the user to select the store to be opened.</span></span> <span data-ttu-id="e3a83-206">Un cuadro de diálogo puede ser necesario, por ejemplo, si se ha cambiado el nombre de un servidor, un nombre de cuenta ha cambiado o partes de la red no están disponibles.</span><span class="sxs-lookup"><span data-stu-id="e3a83-206">A dialog box might be required, for example, if a server has been renamed, an account name has changed, or portions of the network are not available.</span></span>
  
<span data-ttu-id="e3a83-207">Cuando _lpEntryID_ es **null**, se que aún no se ha seleccionado el almacén de mensajes para usar.</span><span class="sxs-lookup"><span data-stu-id="e3a83-207">When  _lpEntryID_ is **null**, the message store to use has not yet been selected.</span></span> <span data-ttu-id="e3a83-208">El proveedor aún puede tener acceso a un almacén sin mostrar un cuadro de diálogo si es compatible con otros métodos para especificar el almacén.</span><span class="sxs-lookup"><span data-stu-id="e3a83-208">The provider can still access a store without displaying a dialog box if it supports further methods to specify the store.</span></span> <span data-ttu-id="e3a83-209">Por ejemplo, el proveedor puede comprobar su archivo de inicialización o que puede buscar las propiedades adicionales que se colocaron en la sección de perfil de su o su mensaje del servicio en la configuración.</span><span class="sxs-lookup"><span data-stu-id="e3a83-209">For example, the provider can check its initialization file, or it can look for additional properties that were placed in its or its message service's profile section at configuration.</span></span>
  
<span data-ttu-id="e3a83-210">Si un proveedor busca todas la información necesaria no está en el perfil, debe devolver MAPI_E_UNCONFIGURED.</span><span class="sxs-lookup"><span data-stu-id="e3a83-210">If a provider finds that all the required information is not in the profile, it should return MAPI_E_UNCONFIGURED.</span></span> <span data-ttu-id="e3a83-211">MAPI le llamará en función del punto de entrada del proveedor mensaje servicio para permitir que el usuario para seleccionar un almacén, o incluso para crear uno, y escribir un nombre de cuenta y una contraseña, como sea necesario.</span><span class="sxs-lookup"><span data-stu-id="e3a83-211">MAPI will then call the provider's message service entry point function to enable the user to select a store, or even to create one, and to enter an account name and password, as needed.</span></span> <span data-ttu-id="e3a83-212">MAPI crea automáticamente una nueva sección de perfil para un nuevo almacén; en esta sección de perfil nuevo puede ser temporal o permanente, dependiendo de cómo se ha agregado.</span><span class="sxs-lookup"><span data-stu-id="e3a83-212">MAPI automatically creates a new profile section for a new store; this new profile section can be temporary or permanent, depending on how it has been added.</span></span> <span data-ttu-id="e3a83-213">Si el proveedor de almacenamiento llama al método de **IMAPISupport::ModifyProfile** , la nueva sección de perfil se convierte en permanente y el almacén se agrega a la lista de almacenes de mensaje devuelto por el método [IMAPISession::GetMsgStoresTable](imapisession-getmsgstorestable.md) .</span><span class="sxs-lookup"><span data-stu-id="e3a83-213">If the store provider calls the **IMAPISupport::ModifyProfile** method, the new profile section becomes permanent and the store is added to the list of message stores returned by the [IMAPISession::GetMsgStoresTable](imapisession-getmsgstorestable.md) method.</span></span> 
  
<span data-ttu-id="e3a83-214">El parámetro _lpInterface_ especifica el IID de la interfaz necesaria para el objeto store acaba de abrir.</span><span class="sxs-lookup"><span data-stu-id="e3a83-214">The  _lpInterface_ parameter specifies the IID of the interface required for the newly opened store object.</span></span> <span data-ttu-id="e3a83-215">Pasar **null** en _lpInterface_ especifica que la interfaz de almacén de mensajes MAPI, **IMsgStore**, es necesaria.</span><span class="sxs-lookup"><span data-stu-id="e3a83-215">Passing **null** in  _lpInterface_ specifies that the MAPI message store interface, **IMsgStore**, is required.</span></span> <span data-ttu-id="e3a83-216">Pase el objeto de almacén de mensajes, IID_IMsgStore, también especifica que se requiere **IMsgStore** .</span><span class="sxs-lookup"><span data-stu-id="e3a83-216">Passing the message store object, IID_IMsgStore, also specifies that **IMsgStore** is required.</span></span> <span data-ttu-id="e3a83-217">Si se pasa IID_IUnknown en _lpInterface_, el proveedor debe abrir el almacén de mediante el uso de cualquier interfaz derivada de [IUnknown](http://msdn.microsoft.com/en-us/library/ms680509%28v=VS.85%29.aspx) es mejor para el proveedor (de nuevo, esto es normalmente **IMsgStore**).</span><span class="sxs-lookup"><span data-stu-id="e3a83-217">If IID_IUnknown is passed in  _lpInterface_, the provider should open the store by using whatever interface derived from [IUnknown](http://msdn.microsoft.com/en-us/library/ms680509%28v=VS.85%29.aspx) is best for the provider (again, this is typically **IMsgStore**).</span></span> <span data-ttu-id="e3a83-218">Cuando se pasa IID_IUnknown, la implementación llamada usa el método [IUnknown:: QueryInterface](http://msdn.microsoft.com/en-us/library/ms682521%28v=VS.85%29.aspx) para seleccionar una interfaz después de que se haya realizado correctamente la operación de apertura de almacén.</span><span class="sxs-lookup"><span data-stu-id="e3a83-218">When IID_IUnknown is passed, the calling implementation uses the [IUnknown::QueryInterface](http://msdn.microsoft.com/en-us/library/ms682521%28v=VS.85%29.aspx) method to select an interface after the store open operation succeeds.</span></span> 
  
<span data-ttu-id="e3a83-219">La llamada **IMSProvider::Logon** debe devolver información suficiente, como una ruta de acceso en el almacén y las credenciales para tener acceso al almacén, para permitir que la cola MAPI iniciar sesión en el mismo almacén que el proveedor de almacenamiento hace sin presentar un cuadro de diálogo.</span><span class="sxs-lookup"><span data-stu-id="e3a83-219">The **IMSProvider::Logon** call should return sufficient information, such as a path to the store and credentials for accessing the store, to allow the MAPI spooler to log on to the same store that the store provider does without presenting a dialog box.</span></span> <span data-ttu-id="e3a83-220">Los parámetros _lpcbSpoolSecurity_ y _lppbSpoolSecurity_ se utilizan para devolver esta información.</span><span class="sxs-lookup"><span data-stu-id="e3a83-220">The  _lpcbSpoolSecurity_ and  _lppbSpoolSecurity_ parameters are used to return this information.</span></span> <span data-ttu-id="e3a83-221">El proveedor asigna la memoria para estos datos pasando un puntero a un búfer en [MSProviderInit](msproviderinit.md) _lpfAllocateBuffer_ parámetro de la función; el proveedor coloca el tamaño de este búfer en _lpcbSpoolSecurity_.</span><span class="sxs-lookup"><span data-stu-id="e3a83-221">The provider allocates the memory for this data by passing a pointer to a buffer in the [MSProviderInit](msproviderinit.md) function's  _lpfAllocateBuffer_ parameter; the provider places the size of this buffer in  _lpcbSpoolSecurity_.</span></span> 
  
<span data-ttu-id="e3a83-222">MAPI libera este búfer cuando sea apropiado.</span><span class="sxs-lookup"><span data-stu-id="e3a83-222">MAPI frees this buffer when appropriate.</span></span> <span data-ttu-id="e3a83-223">Si el inicio de sesión de la cola MAPI en el almacén de puede realizarse de la información en la sección de perfil por sí solo, el proveedor puede devolver null en _lppbSpoolSecurity_ y 0 para el tamaño de la información en _lpcbSpoolSecurity_.</span><span class="sxs-lookup"><span data-stu-id="e3a83-223">If the MAPI spooler's logon to the store can be accomplished from the information in the profile section alone, the provider can return null in  _lppbSpoolSecurity_ and 0 for the information's size in  _lpcbSpoolSecurity_.</span></span> <span data-ttu-id="e3a83-224">El inicio de sesión de la cola MAPI se produce como parte de un proceso diferente que el inicio de sesión de almacén; debido a que el búfer que contiene la información pasada obtiene copiado entre procesos, podría no ser en la memoria en la misma ubicación para el proceso de cola de impresión MAPI que para el proceso de proveedor de almacén.</span><span class="sxs-lookup"><span data-stu-id="e3a83-224">The MAPI spooler logon occurs as part of a different process than the store logon; because the buffer that contains the passed information gets copied between processes, it might not be in memory at the same location for the MAPI spooler process as for the store provider process.</span></span> <span data-ttu-id="e3a83-225">Por lo tanto, un proveedor no debe poner las direcciones en este búfer.</span><span class="sxs-lookup"><span data-stu-id="e3a83-225">Therefore, a provider shouldn't put addresses into this buffer.</span></span> <span data-ttu-id="e3a83-226">Para obtener más información sobre el inicio de sesión MAPI cola de impresión, vea el método [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) .</span><span class="sxs-lookup"><span data-stu-id="e3a83-226">For more information about MAPI spooler logon, see the [IMSProvider::SpoolerLogon](imsprovider-spoolerlogon.md) method.</span></span> 
  
<span data-ttu-id="e3a83-227">La mayoría de los proveedores de almacén use el método [IMAPISession::OpenProfileSection](imapisession-openprofilesection.md) del objeto de soporte técnico pasado en el parámetro _lpMAPISup_ para guardar y recuperar las opciones y las credenciales de usuario.</span><span class="sxs-lookup"><span data-stu-id="e3a83-227">Most store providers use the [IMAPISession::OpenProfileSection](imapisession-openprofilesection.md) method of the support object passed in the  _lpMAPISup_ parameter for saving and retrieving user credentials and options.</span></span> <span data-ttu-id="e3a83-228">**OpenProfileSection** permite que un proveedor de almacenamiento guardar información arbitraria adicional en una sección de perfil y asociarlo a un recurso determinado.</span><span class="sxs-lookup"><span data-stu-id="e3a83-228">**OpenProfileSection** enables a store provider to save additional arbitrary information in a profile section and associate it with a particular resource.</span></span> <span data-ttu-id="e3a83-229">Por ejemplo, un proveedor de almacén puede guardar el nombre de la cuenta de usuario y la contraseña asociada a un recurso y las rutas de acceso u otra información necesaria para tener acceso a ese recurso.</span><span class="sxs-lookup"><span data-stu-id="e3a83-229">For example, a store provider can save the user account name and password associated with a resource and any paths or other information needed to access that resource.</span></span> 
  
<span data-ttu-id="e3a83-230">Las propiedades con identificadores de propiedad 0x6600 a través de 0x67FF son propiedades seguras disponibles para el proveedor para su propio uso almacenar datos privados en las secciones del perfil.</span><span class="sxs-lookup"><span data-stu-id="e3a83-230">Properties with property identifiers 0x6600 through 0x67FF are secure properties available to the provider for its own use to store private data in profile sections.</span></span> <span data-ttu-id="e3a83-231">Para obtener más información acerca de los usos de propiedades en los objetos de sección de perfil, vea el [IProfSect: IMAPIProp](iprofsectimapiprop.md) (método).</span><span class="sxs-lookup"><span data-stu-id="e3a83-231">For more information about the uses of properties in profile section objects, see the [IProfSect : IMAPIProp](iprofsectimapiprop.md) method.</span></span> 
  
<span data-ttu-id="e3a83-232">Además de los datos privados de propiedades con identificadores de 0x6600 a través de 0x67FF, el proveedor de almacenamiento debe proporcionar información de la propiedad **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) en su sección de perfil.</span><span class="sxs-lookup"><span data-stu-id="e3a83-232">In addition to any private data in properties with identifiers 0x6600 through 0x67FF, the store provider should provide information for the **PR_DISPLAY_NAME** ([PidTagDisplayName](pidtagdisplayname-canonical-property.md)) property in its profile section.</span></span> <span data-ttu-id="e3a83-233">Debe colocar en **PR_DISPLAY_NAME** el nombre para mostrar del proveedor: una cadena de identificación (por ejemplo, "Microsoft Personal Information Store") que se muestra a los usuarios para que pueden distinguir este almacén de mensajes de otros usuarios es posible que tenga acceso Para.</span><span class="sxs-lookup"><span data-stu-id="e3a83-233">It should put in **PR_DISPLAY_NAME** the display name of the provider itself — an identifying string (for example, "Microsoft Personal Information Store") that is displayed to users so they can distinguish this message store from others they might have access to.</span></span> <span data-ttu-id="e3a83-234">**PR_DISPLAY_NAME** normalmente contiene un nombre de servidor, el nombre de la cuenta de usuario o la ruta de acceso.</span><span class="sxs-lookup"><span data-stu-id="e3a83-234">**PR_DISPLAY_NAME** commonly contains a server name, user account name, or path.</span></span> 
  
<span data-ttu-id="e3a83-235">Algunas propiedades de la sección de perfil están visibles en la tabla de almacén de mensajes; otros usuarios están visibles durante el programa de instalación, la instalación y la configuración del subsistema MAPI.</span><span class="sxs-lookup"><span data-stu-id="e3a83-235">Some profile section properties are visible in the message store table; others are visible during setup, installation, and configuration of the MAPI subsystem.</span></span> <span data-ttu-id="e3a83-236">Normalmente, el proveedor proporciona información para estas propiedades visibles para una nueva sección de perfil, que aún no incluye las credenciales guardadas o información privada y, cuando se encuentre que ha cambiado la información de la propiedad.</span><span class="sxs-lookup"><span data-stu-id="e3a83-236">The provider typically provides information for these visible properties both for a new profile section, which does not yet include saved credentials or private information, and when it finds that property information has changed.</span></span> <span data-ttu-id="e3a83-237">Para obtener más información acerca de las secciones del perfil, vea [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md).</span><span class="sxs-lookup"><span data-stu-id="e3a83-237">For more information about profile sections, see [IMAPISupport::OpenProfileSection](imapisupport-openprofilesection.md).</span></span>
  
<span data-ttu-id="e3a83-238">Después de iniciar sesión correctamente en un usuario y antes de volver a MAPI, el proveedor de almacenamiento debe crear la matriz de propiedades de la fila de estado para el recurso y llame al método [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) .</span><span class="sxs-lookup"><span data-stu-id="e3a83-238">After successfully logging on a user, and before returning to MAPI, the store provider should create the array of properties for the status row for the resource and call the [IMAPISupport::ModifyStatusRow](imapisupport-modifystatusrow.md) method.</span></span> 
  
 <span data-ttu-id="e3a83-239">Las llamadas de **Inicio de sesión** que se abren los almacenes de mensajes que ya están abiertos para la sesión MAPI actual omitir gran parte del procesamiento descrito anteriormente.</span><span class="sxs-lookup"><span data-stu-id="e3a83-239">**Logon** calls that open message stores that are already open for the current MAPI session skip much of the processing previously described.</span></span> <span data-ttu-id="e3a83-240">Estas llamadas no crear filas de estado, devolver objetos de inicio de sesión del almacén de mensajes, llamar a **AddRef** para el objeto de la compatibilidad con MAPI o devolver datos para el inicio de sesión MAPI cola de impresión.</span><span class="sxs-lookup"><span data-stu-id="e3a83-240">These calls do not create status rows, return message store logon objects, call **AddRef** for the MAPI support object, or return data for MAPI spooler logon.</span></span> <span data-ttu-id="e3a83-241">Estas llamadas devuelve S_OK y devolver un objeto de almacén de mensajes con la interfaz solicitada.</span><span class="sxs-lookup"><span data-stu-id="e3a83-241">These calls do return S_OK and return a message store object with the requested interface.</span></span> 
  
<span data-ttu-id="e3a83-242">Para detectar este tipo de llamadas, el proveedor debe mantener una lista en el objeto de proveedor de almacén de mensajes de almacenes ya está abierto para este objeto de proveedor.</span><span class="sxs-lookup"><span data-stu-id="e3a83-242">To detect such calls, the provider should maintain a list in the message store provider object of stores already open for this provider object.</span></span> <span data-ttu-id="e3a83-243">Cuando se procesa una llamada de **Inicio de sesión** , el proveedor debe analizar esta lista de almacenes de open y determinar si el almacén debe tener una sesión iniciada en ya está abierto.</span><span class="sxs-lookup"><span data-stu-id="e3a83-243">When processing a **Logon** call, the provider should scan this list of open stores and determine whether the store to be logged on to is already open.</span></span> <span data-ttu-id="e3a83-244">Si es así, las credenciales de usuario no es necesario que se va a comprobar y se debe evitar la presentación de un cuadro de diálogo, si es posible.</span><span class="sxs-lookup"><span data-stu-id="e3a83-244">If it is, user credentials do not need to be checked and the display of a dialog box should be avoided, if possible.</span></span> <span data-ttu-id="e3a83-245">Si se deben mostrar cuadros de diálogo, el proveedor debe comprobar la información devuelta para ver si un almacén se ha abierto una segunda vez.</span><span class="sxs-lookup"><span data-stu-id="e3a83-245">If dialog boxes must be displayed, the provider should check returned information to see whether a store has been opened a second time.</span></span> <span data-ttu-id="e3a83-246">Además, debe comprobar el proveedor de aperturas duplicadas mediante _lpEntryID_ al principio de llamada de **Inicio de sesión** de procesamiento.</span><span class="sxs-lookup"><span data-stu-id="e3a83-246">In addition, the provider should check for duplicate openings by using  _lpEntryID_ at the beginning of **Logon** call processing.</span></span> 
  
<span data-ttu-id="e3a83-247">Procesamiento de una llamada de **Inicio de sesión** que obtiene acceso a un almacén de open estándar es como sigue:</span><span class="sxs-lookup"><span data-stu-id="e3a83-247">Standard processing for a **Logon** call that accesses an open store is as follows:</span></span> 
  
1. <span data-ttu-id="e3a83-248">El proveedor de almacenamiento llama a **AddRef** para el objeto de almacenamiento existente si la nueva interfaz que se solicita es el mismo que la interfaz para el almacén existente.</span><span class="sxs-lookup"><span data-stu-id="e3a83-248">The store provider calls **AddRef** for the existing store object if the new interface being requested is the same as the interface for the existing store.</span></span> <span data-ttu-id="e3a83-249">De lo contrario, llama a **QueryInterface** para obtener la nueva interfaz.</span><span class="sxs-lookup"><span data-stu-id="e3a83-249">Otherwise, it calls **QueryInterface** to get the new interface.</span></span> <span data-ttu-id="e3a83-250">Si el almacén no es compatible con la nueva interfaz, el proveedor debe devolver el valor de error MAPI_E_INTERFACE_NOT_SUPPORTED.</span><span class="sxs-lookup"><span data-stu-id="e3a83-250">If the store does not support the new interface, the provider should return the error value MAPI_E_INTERFACE_NOT_SUPPORTED.</span></span> 
    
2. <span data-ttu-id="e3a83-251">El proveedor devuelve un puntero a la interfaz necesaria del objeto de almacenamiento existente en _lppMDB_.</span><span class="sxs-lookup"><span data-stu-id="e3a83-251">The provider returns a pointer to the required interface of the existing store object in  _lppMDB_.</span></span>
    
3. <span data-ttu-id="e3a83-252">El proveedor devuelve **null** en _lppMSLogon_.</span><span class="sxs-lookup"><span data-stu-id="e3a83-252">The provider returns **null** in  _lppMSLogon_.</span></span>
    
4. <span data-ttu-id="e3a83-253">El proveedor no debe abrir el perfil para el objeto de soporte técnico que se pasa en la llamada.</span><span class="sxs-lookup"><span data-stu-id="e3a83-253">The provider should not open the profile for the support object passed in the call.</span></span> <span data-ttu-id="e3a83-254">Además, no debe registrar un identificador único del proveedor, registrar una fila de estado o devolver datos de inicio de sesión de cola de MAPI.</span><span class="sxs-lookup"><span data-stu-id="e3a83-254">In addition, it should not register a provider unique identifier, register a status row, or return MAPI spooler logon data.</span></span>
    
5. <span data-ttu-id="e3a83-255">El proveedor no debe llamar a **AddRef** para el objeto de soporte técnico, ya que no requiere un puntero al objeto.</span><span class="sxs-lookup"><span data-stu-id="e3a83-255">The provider should not call **AddRef** for the support object, because it does not require a pointer to the object.</span></span> 
    
<span data-ttu-id="e3a83-256">Siempre que sea posible, los proveedores deben devolver adecuado de error y advertencia cadenas para las llamadas de **Inicio de sesión** , porque si lo hace, en gran medida facilita la carga de usuarios en determinar por qué algo no funcionó.</span><span class="sxs-lookup"><span data-stu-id="e3a83-256">Whenever possible, providers should return appropriate error and warning strings for **Logon** calls, because doing so greatly eases the burden of users in determining why something did not work.</span></span> <span data-ttu-id="e3a83-257">Para devolver estas cadenas, un proveedor establece a los miembros de la estructura de **MAPIERROR** .</span><span class="sxs-lookup"><span data-stu-id="e3a83-257">To return these strings, a provider sets the members in the **MAPIERROR** structure.</span></span> <span data-ttu-id="e3a83-258">MAPI busca, utiliza y libera la estructura **MAPIERROR** si es devuelto por un proveedor.</span><span class="sxs-lookup"><span data-stu-id="e3a83-258">MAPI looks for, uses, and releases the **MAPIERROR** structure if it is returned by a provider.</span></span> 
  
<span data-ttu-id="e3a83-259">Memoria de esta estructura **MAPIERROR** debe asignarse usando el búfer pasado en _lpfAllocateBuffer_ en la llamada **MSProviderInit** .</span><span class="sxs-lookup"><span data-stu-id="e3a83-259">Memory for this **MAPIERROR** structure should be allocated by using the buffer passed in  _lpfAllocateBuffer_ on the **MSProviderInit** call.</span></span> <span data-ttu-id="e3a83-260">Cualquier error en las cadenas contenidas en la estructura devuelta deben estar en formato Unicode si MAPI_UNICODE se establece en el **Inicio de sesión** _ulFlags;_ en caso contrario, se debe en el carácter ANSI establecer.</span><span class="sxs-lookup"><span data-stu-id="e3a83-260">Any error strings contained in the returned structure should be in Unicode format if MAPI_UNICODE is set in the **Logon** _ulFlags;_ otherwise, they should be in the ANSI character set.</span></span> 
  
<span data-ttu-id="e3a83-261">Para la mayoría de los valores de error devuelta desde el **Inicio de sesión**, MAPI deshabilita los servicios de mensaje a la que pertenece el proveedor con errores.</span><span class="sxs-lookup"><span data-stu-id="e3a83-261">For most error values returned from **Logon**, MAPI disables the message services to which the failing provider belongs.</span></span> <span data-ttu-id="e3a83-262">MAPI no llamará a todos los proveedores que pertenecen a esos servicios durante la vida de la sesión MAPI.</span><span class="sxs-lookup"><span data-stu-id="e3a83-262">MAPI will not call any providers that belong to those services for the life of the MAPI session.</span></span> <span data-ttu-id="e3a83-263">Por el contrario, cuando **Inicio de sesión** , se devuelve el valor de error MAPI_E_FAILONEPROVIDER desde su inicio de sesión, MAPI deshabilitar el servicio de mensajes a la que pertenece el proveedor.</span><span class="sxs-lookup"><span data-stu-id="e3a83-263">In contrast, when **Logon** returns the MAPI_E_FAILONEPROVIDER error value from its logon, MAPI does not disable the message service to which the provider belongs.</span></span> <span data-ttu-id="e3a83-264">**Inicio de sesión** debe devolver MAPI_E_FAILONEPROVIDER si encuentra un error que no merece la pena la deshabilitación del servicio todo la vida de la sesión.</span><span class="sxs-lookup"><span data-stu-id="e3a83-264">**Logon** should return MAPI_E_FAILONEPROVIDER if it encounters an error that does not warrant disabling the entire service for the life of the session.</span></span> <span data-ttu-id="e3a83-265">Por ejemplo, un proveedor podría devolver este error cuando no permite la visualización de una interfaz de usuario y una contraseña requerida no está disponible.</span><span class="sxs-lookup"><span data-stu-id="e3a83-265">For example, a provider might return this error when it does not allow the display of a user interface and a required password is unavailable.</span></span> 
  
<span data-ttu-id="e3a83-266">Si un proveedor devuelve MAPI_E_UNCONFIGURED desde su inicio de sesión, MAPI llamar a la función de entrada de servicio de mensajes del proveedor y, a continuación, vuelva a intentar el inicio de sesión.</span><span class="sxs-lookup"><span data-stu-id="e3a83-266">If a provider returns MAPI_E_UNCONFIGURED from its logon, MAPI will call the provider's message service entry function and then retry the logon.</span></span> <span data-ttu-id="e3a83-267">MAPI pasa MSG_SERVICE_CONFIGURE como el contexto para dar la oportunidad para que se configure el servicio.</span><span class="sxs-lookup"><span data-stu-id="e3a83-267">MAPI passes MSG_SERVICE_CONFIGURE as the context to give the service a chance to configure itself.</span></span> <span data-ttu-id="e3a83-268">Si el cliente ha elegido permitir una interfaz de usuario en el inicio de sesión, el servicio puede presentar su hoja de propiedades de configuración, por lo que el usuario puede escribir información de configuración.</span><span class="sxs-lookup"><span data-stu-id="e3a83-268">If the client has chosen to allow a user interface on the logon, the service can present its configuration property sheet so the user can enter configuration information.</span></span>
  
## <a name="see-also"></a><span data-ttu-id="e3a83-269">Vea también</span><span class="sxs-lookup"><span data-stu-id="e3a83-269">See also</span></span>



[<span data-ttu-id="e3a83-270">IMAPISession::GetMsgStoresTable</span><span class="sxs-lookup"><span data-stu-id="e3a83-270">IMAPISession::GetMsgStoresTable</span></span>](imapisession-getmsgstorestable.md)
  
[<span data-ttu-id="e3a83-271">IMAPISession::OpenMsgStore</span><span class="sxs-lookup"><span data-stu-id="e3a83-271">IMAPISession::OpenMsgStore</span></span>](imapisession-openmsgstore.md)
  
[<span data-ttu-id="e3a83-272">IMAPISession::OpenProfileSection</span><span class="sxs-lookup"><span data-stu-id="e3a83-272">IMAPISession::OpenProfileSection</span></span>](imapisession-openprofilesection.md)
  
[<span data-ttu-id="e3a83-273">IMAPISupport::ModifyProfile</span><span class="sxs-lookup"><span data-stu-id="e3a83-273">IMAPISupport::ModifyProfile</span></span>](imapisupport-modifyprofile.md)
  
[<span data-ttu-id="e3a83-274">IMAPISupport::ModifyStatusRow</span><span class="sxs-lookup"><span data-stu-id="e3a83-274">IMAPISupport::ModifyStatusRow</span></span>](imapisupport-modifystatusrow.md)
  
[<span data-ttu-id="e3a83-275">IMsgStore: IMAPIProp</span><span class="sxs-lookup"><span data-stu-id="e3a83-275">IMsgStore : IMAPIProp</span></span>](imsgstoreimapiprop.md)
  
[<span data-ttu-id="e3a83-276">IMSProvider::SpoolerLogon</span><span class="sxs-lookup"><span data-stu-id="e3a83-276">IMSProvider::SpoolerLogon</span></span>](imsprovider-spoolerlogon.md)
  
[<span data-ttu-id="e3a83-277">IProfSect : IMAPIProp</span><span class="sxs-lookup"><span data-stu-id="e3a83-277">IProfSect : IMAPIProp</span></span>](iprofsectimapiprop.md)
  
[<span data-ttu-id="e3a83-278">MAPIERROR</span><span class="sxs-lookup"><span data-stu-id="e3a83-278">MAPIERROR</span></span>](mapierror.md)
  
[<span data-ttu-id="e3a83-279">MSProviderInit</span><span class="sxs-lookup"><span data-stu-id="e3a83-279">MSProviderInit</span></span>](msproviderinit.md)
  
[<span data-ttu-id="e3a83-280">IMSProvider : IUnknown</span><span class="sxs-lookup"><span data-stu-id="e3a83-280">IMSProvider : IUnknown</span></span>](imsprovideriunknown.md)

