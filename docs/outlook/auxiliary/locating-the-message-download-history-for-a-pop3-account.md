---
title: Buscar el historial de descarga de mensajes de una cuenta POP3
manager: soliver
ms.date: 09/17/2015
ms.audience: Developer
ms.topic: overview
localization_priority: Normal
ms.assetid: 90a51150-5c2c-4d5b-8717-5dacc8532744
description: En este tema se describe cómo un cliente de correo puede obtener acceso a la propiedad PidTagAttachDataBinary para obtener el historial de descargas de mensajes de una cuenta POP3.
ms.openlocfilehash: ae12a044098aa4f42e1c2e5936e82da3d7a128dd
ms.sourcegitcommit: 8fe462c32b91c87911942c188f3445e85a54137c
ms.translationtype: MT
ms.contentlocale: es-ES
ms.lasthandoff: 04/23/2019
ms.locfileid: "32321878"
---
# <a name="locating-the-message-download-history-for-a-pop3-account"></a><span data-ttu-id="4e1e6-103">Buscar el historial de descarga de mensajes de una cuenta POP3</span><span class="sxs-lookup"><span data-stu-id="4e1e6-103">Locating the message download history for a POP3 account</span></span>

<span data-ttu-id="4e1e6-104">En este tema se describe cómo un cliente de correo puede obtener acceso a la propiedad [PidTagAttachDataBinary](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) para obtener el historial de descargas de mensajes de una cuenta POP3.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-104">This topic describes how a mail client can access the [PidTagAttachDataBinary](https://msdn.microsoft.com/library/3b0a8b28-863e-4b96-a4c0-fdb8f40555b9%28Office.15%29.aspx) property to get the message download history for a POP3 account.</span></span> 

<span data-ttu-id="4e1e6-105"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_WhyGetUIDLHistory"> </a></span><span class="sxs-lookup"><span data-stu-id="4e1e6-105"></span></span>

## <a name="why-get-the-message-download-history"></a><span data-ttu-id="4e1e6-106">¿Por qué se obtiene el historial de descargas de mensajes?</span><span class="sxs-lookup"><span data-stu-id="4e1e6-106">Why get the message download history?</span></span>

<span data-ttu-id="4e1e6-107">El proveedor de protocolo de oficina de correos (POP) para Outlook permite a los usuarios recuperar y descargar nuevos mensajes de correo electrónico en su dispositivo local y, posteriormente, dejar o eliminar estos mensajes de correo electrónico en el servidor de correo.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-107">The Post Office Protocol (POP) provider for Outlook allows users to retrieve and download new email messages on their local device, and subsequently to leave or delete these email messages on the mail server.</span></span> <span data-ttu-id="4e1e6-108">Cuando el cliente de correo comprueba si hay mensajes nuevos que descargar, tiene que poder identificar y descargar sólo los mensajes nuevos para esa bandeja de entrada.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-108">When the mail client checks for new messages to download, it has to be able to identify and download only the new messages for that Inbox.</span></span> <span data-ttu-id="4e1e6-109">El cliente de correo lo hace primero usando el comando UIDL (Unique ID Listing), que obtiene un mapa de cada mensaje que se ha entregado alguna vez en la bandeja de entrada a un identificador único (UID).</span><span class="sxs-lookup"><span data-stu-id="4e1e6-109">The mail client does this by first using the UIDL (Unique ID Listing) command, which obtains a map of each message that has ever been delivered to that Inbox to a unique identifier (UID).</span></span> <span data-ttu-id="4e1e6-110">El cliente también obtiene el historial de descargas de mensajes para los mensajes que se han descargado o eliminado para la bandeja de entrada de ese cliente.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-110">The client also gets the message download history for messages that have been downloaded or deleted for the Inbox on that client.</span></span> <span data-ttu-id="4e1e6-111">Con el mapa UID del mensaje y el historial de descargas, el cliente puede identificar los mensajes que están ausentes en el historial como nuevos y, por lo tanto, debe descargarlos.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-111">Using the message UID map and download history, the client can then identify those messages that are absent in the history as new and, hence, should be downloaded.</span></span>
  
<span data-ttu-id="4e1e6-112">Para obtener el historial de descargas de mensajes de una bandeja de entrada:</span><span class="sxs-lookup"><span data-stu-id="4e1e6-112">To get the message download history for an Inbox:</span></span>
  
- <span data-ttu-id="4e1e6-113">Siga los pasos de este tema para buscar la propiedad **PidTagAttachDataBinary** , que contiene el historial en un objeto binario grande (BLOB) que sigue a un formato específico.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-113">Follow the steps in this topic to find the **PidTagAttachDataBinary** property, which contains the history in a binary large object (BLOB) that follows a specific format.</span></span> 
    
- <span data-ttu-id="4e1e6-114">Continúe con [el análisis del historial de descarga de mensajes de una cuenta POP3](parsing-the-message-download-history-for-a-pop3-account.md), que describe cómo analizar este BLOB para identificar los mensajes que se han descargado o eliminado para esa bandeja de entrada.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-114">Continue with [Parsing the message download history for a POP3 account](parsing-the-message-download-history-for-a-pop3-account.md), which describes how to parse this BLOB to identify messages that have been downloaded or deleted for that Inbox.</span></span>
    
## <a name="core-concepts-to-know-for-locating-the-message-download-history"></a><span data-ttu-id="4e1e6-115">Conceptos básicos que deben conocerse para encontrar el historial de descargas de mensajes</span><span class="sxs-lookup"><span data-stu-id="4e1e6-115">Core concepts to know for locating the message download history</span></span>

<span data-ttu-id="4e1e6-116">El historial de descarga de mensajes de una bandeja de entrada se almacena en una propiedad MAPI binaria, **PidTagAttachDataBinary**, en datos adjuntos de un mensaje oculto en la bandeja de entrada.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-116">The message download history for an Inbox is stored in a binary MAPI property, **PidTagAttachDataBinary**, on an attachment of a hidden message in the Inbox.</span></span> <span data-ttu-id="4e1e6-117">La tabla 1 muestra los recursos para conocer los conceptos que le ayudarán a encontrar el historial de descargas de mensajes.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-117">Table 1 shows resources for concepts that help you understand how to locate the message download history.</span></span>
  
<span data-ttu-id="4e1e6-118">**Tabla 1. Conceptos básicos**</span><span class="sxs-lookup"><span data-stu-id="4e1e6-118">**Table 1. Core concepts**</span></span>

|<span data-ttu-id="4e1e6-119">**Título del artículo**</span><span class="sxs-lookup"><span data-stu-id="4e1e6-119">**Article title**</span></span>|<span data-ttu-id="4e1e6-120">**Description**</span><span class="sxs-lookup"><span data-stu-id="4e1e6-120">**Description**</span></span>|
|:-----|:-----|
|[<span data-ttu-id="4e1e6-121">Carpetas ocultas MAPI</span><span class="sxs-lookup"><span data-stu-id="4e1e6-121">MAPI Hidden Folders</span></span>](https://msdn.microsoft.com/library/8b3b9c80-f7f4-4f37-bd6b-323469d020f1%28Office.15%29.aspx) <br/> |<span data-ttu-id="4e1e6-122">MAPI permite que los clientes de correo almacenen información en carpetas ocultas y mensajes ocultos.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-122">MAPI allows mail clients to store information in hidden folders and hidden messages.</span></span> <span data-ttu-id="4e1e6-123">Las carpetas ocultas están en la parte asociada de las carpetas MAPI y normalmente contienen información que no es visible para que la manipulen los usuarios.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-123">Hidden folders are in the associated part of MAPI folders and typically contain information that is not visible to and not to be manipulated by users.</span></span> <span data-ttu-id="4e1e6-124">Los clientes deciden el formato y el contenido que se almacenarán en las carpetas ocultas en los mensajes ocultos.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-124">Clients decide the format and contents to store in hidden messages in hidden folders.</span></span>  <br/> |
|[<span data-ttu-id="4e1e6-125">Mensajes MAPI</span><span class="sxs-lookup"><span data-stu-id="4e1e6-125">MAPI Messages</span></span>](https://msdn.microsoft.com/library/417c113f-bd98-4515-85d1-09db7fc3a227%28Office.15%29.aspx) <br/> |<span data-ttu-id="4e1e6-126">MAPI almacena los mensajes en carpetas, ya sea en el subárbol IPM estándar que es visible para los usuarios de un cliente o fuera del subárbol y no es visible para los usuarios.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-126">MAPI stores messages in folders, either in the standard IPM subtree that is visible to users of a client, or outside of the subtree and invisible to users.</span></span> <span data-ttu-id="4e1e6-127">Los mensajes pueden tener datos adicionales almacenados en datos adjuntos, que pueden tener el formato de un archivo, otro mensaje o un objeto OLE.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-127">Messages can have additional data stored in an attachment, which can be in the form of a file, another message, or an OLE object.</span></span> <span data-ttu-id="4e1e6-128">En el caso del historial de descarga de mensajes, el historial se almacena en una propiedad de un mensaje adjunto a otro mensaje oculto.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-128">In the case of the message download history, the history is stored in a property of a message that is attached to another hidden message.</span></span>  <br/> |
|[<span data-ttu-id="4e1e6-129">Información general de propiedades de mensaje</span><span class="sxs-lookup"><span data-stu-id="4e1e6-129">Message Properties Overview</span></span>](https://msdn.microsoft.com/library/447f54de-9f0d-4f73-89b6-bed9cfea9c15%28Office.15%29.aspx) <br/> |<span data-ttu-id="4e1e6-130">Cuando un cliente almacena información en un mensaje, en realidad se almacena la información en una propiedad del mensaje.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-130">When a client stores information in a message, it actually stores the information in a property of the message.</span></span> <span data-ttu-id="4e1e6-131">MAPI admite muchas propiedades: algunos siempre existen y los pueden configurar los clientes, otros son opcionales y los clientes no pueden esperar que estén disponibles o se establezcan en valores válidos.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-131">MAPI supports many properties—some always exist and can be set by clients, others are optional—and clients cannot expect them to be available or set to valid values.</span></span> <span data-ttu-id="4e1e6-132">El historial de descargas de mensajes se almacena en la propiedad **PidTagAttachDataBinary** de datos adjuntos en un mensaje oculto.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-132">The message download history is stored in the **PidTagAttachDataBinary** property of an attachment to a hidden message.</span></span>  <br/> |
|[<span data-ttu-id="4e1e6-133">Perfiles MAPI</span><span class="sxs-lookup"><span data-stu-id="4e1e6-133">MAPI Profiles</span></span>](https://msdn.microsoft.com/library/493c87a4-317d-47ec-850b-342cac59594b%28Office.15%29.aspx) <br/> |<span data-ttu-id="4e1e6-134">En el momento de inicio de sesión en una sesión, el cliente de correo selecciona un perfil que describe los proveedores y los servicios que se van a usar.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-134">At logon time in a session, the mail client selects a profile that describes the providers and services to be used.</span></span> <span data-ttu-id="4e1e6-135">Un perfil se divide en secciones que contienen propiedades.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-135">A profile is divided into sections that contain properties.</span></span> <span data-ttu-id="4e1e6-136">En concreto, las propiedades [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) y [PidTagProfileName](https://msdn.microsoft.com/library/13ca726d-ae7a-4da9-9c8e-3db3c479f839%28Office.15%29.aspx) (**PR_PROFILE_NAME**) siempre existen.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-136">In particular, the [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) and [PidTagProfileName](https://msdn.microsoft.com/library/13ca726d-ae7a-4da9-9c8e-3db3c479f839%28Office.15%29.aspx) (**PR_PROFILE_NAME**) properties always exist.</span></span> <span data-ttu-id="4e1e6-137">La clave de búsqueda de un perfil es única entre todos los perfiles y se almacena en la sección de perfil identificada por **MUID_PROFILE_INSTANCE** (que se define en MAPIGUID. H).</span><span class="sxs-lookup"><span data-stu-id="4e1e6-137">A profile's search key is unique among all profiles, and is stored in the profile section that is identified by **MUID_PROFILE_INSTANCE** (which is defined in MAPIGUID.H).</span></span> <span data-ttu-id="4e1e6-138">Use [IMAPISession:: OpenProfileSection](https://msdn.microsoft.com/library/e2757028-27e7-4fc0-9674-e8e30737ef1d%28Office.15%29.aspx) para abrir la sección y use [IMAPIProp:: GetProps](https://msdn.microsoft.com/library/1c7a9cd2-d765-4218-9aee-52df1a2aae6c%28Office.15%29.aspx) para obtener los valores de la propiedad.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-138">Use [IMAPISession::OpenProfileSection](https://msdn.microsoft.com/library/e2757028-27e7-4fc0-9674-e8e30737ef1d%28Office.15%29.aspx) to open the section, and use [IMAPIProp::GetProps](https://msdn.microsoft.com/library/1c7a9cd2-d765-4218-9aee-52df1a2aae6c%28Office.15%29.aspx) to get the property values.</span></span>  <br/> |
|[<span data-ttu-id="4e1e6-139">Tablas de contenido</span><span class="sxs-lookup"><span data-stu-id="4e1e6-139">Contents Tables</span></span>](https://msdn.microsoft.com/library/7b8efb4e-b5be-41b8-81bb-9aa1da421433%28Office.15%29.aspx) <br/> |<span data-ttu-id="4e1e6-140">Los proveedores de almacenamiento de mensajes implementan tablas de contenido para sus carpetas.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-140">Message store providers implement contents tables for their folders.</span></span> <span data-ttu-id="4e1e6-141">Para los mensajes ocultos en la parte asociada de una carpeta, los proveedores de almacenamiento de mensajes admiten tablas de contenido asociadas y los clientes pueden usar el método [IMAPIContainer:: GetContentsTable](https://msdn.microsoft.com/library/88c7a666-875d-473a-b126-dbbb7009f7d9%28Office.15%29.aspx) para devolver un puntero a la tabla de contenido asociada.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-141">For hidden messages in the associated part of a folder, message store providers support associated contents tables, and clients can use the [IMAPIContainer::GetContentsTable](https://msdn.microsoft.com/library/88c7a666-875d-473a-b126-dbbb7009f7d9%28Office.15%29.aspx) method to return a pointer to the associated contents table.</span></span>  <br/> |
|[<span data-ttu-id="4e1e6-142">Acerca de las restricciones</span><span class="sxs-lookup"><span data-stu-id="4e1e6-142">About Restrictions</span></span>](https://msdn.microsoft.com/library/e119fa20-08b8-4c8d-93fc-56037220890d%28Office.15%29.aspx) <br/> [<span data-ttu-id="4e1e6-143">Tipos de restricciones</span><span class="sxs-lookup"><span data-stu-id="4e1e6-143">Types of Restrictions</span></span>](https://msdn.microsoft.com/library/0d3bd58b-7100-4117-91ac-27139715c85b%28Office.15%29.aspx) <br/> [<span data-ttu-id="4e1e6-144">Creación de una restricción</span><span class="sxs-lookup"><span data-stu-id="4e1e6-144">Building a Restriction</span></span>](https://msdn.microsoft.com/library/12abbd8c-f825-493e-af42-344371d9658e%28Office.15%29.aspx) <br/> [<span data-ttu-id="4e1e6-145">Ejemplo de código de restricción</span><span class="sxs-lookup"><span data-stu-id="4e1e6-145">Sample Restriction Code</span></span>](https://msdn.microsoft.com/library/9b82097c-dbd6-4ba0-a6cb-292301f9402b%28Office.15%29.aspx) <br/> |<span data-ttu-id="4e1e6-146">En MAPI, los clientes pueden usar restricciones para filtrar tablas de contenido, para buscar filas que representen los mensajes que tienen una propiedad determinada establecida en un valor específico.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-146">In MAPI, clients can use restrictions to filter contents tables, to search for rows that represent messages that have a certain property set to a specific value.</span></span> <span data-ttu-id="4e1e6-147">Las restricciones se definen mediante la estructura de datos [SRestriction](https://msdn.microsoft.com/library/c12b4409-da6f-480b-87af-1e5baea2e8bd%28Office.15%29.aspx) , que puede contener una Unión de estructuras de restricción más especializadas.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-147">Restrictions are defined by using the [SRestriction](https://msdn.microsoft.com/library/c12b4409-da6f-480b-87af-1e5baea2e8bd%28Office.15%29.aspx) data structure, which can contain a union of more specialized restriction structures.</span></span> <span data-ttu-id="4e1e6-148">El método [IMAPITable:: FindRow](https://msdn.microsoft.com/library/6511368c-9777-497e-9eea-cf390c04b92e%28Office.15%29.aspx) aplica una restricción y recupera la primera fila de una tabla que coincida con los criterios de restricción.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-148">The [IMAPITable::FindRow](https://msdn.microsoft.com/library/6511368c-9777-497e-9eea-cf390c04b92e%28Office.15%29.aspx) method applies a restriction and retrieves the first row in a table that matches the restriction criteria.</span></span>  <br/> |
|[<span data-ttu-id="4e1e6-149">Acerca del registro de almacenes para la indización</span><span class="sxs-lookup"><span data-stu-id="4e1e6-149">About Registering Stores for Indexing</span></span>](https://msdn.microsoft.com/library/dd2aa06a-96e8-1291-18b5-fc3c40b74e4d%28Office.15%29.aspx) <br/> |<span data-ttu-id="4e1e6-150">Use la propiedad [PidTagStoreProvider](https://msdn.microsoft.com/library/6f6cc66f-a08e-4f8e-b33a-d3674319248e%28Office.15%29.aspx) (**PR_MDB_PROVIDER**) para comprobar el tipo de proveedor de almacenamiento.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-150">Use the [PidTagStoreProvider](https://msdn.microsoft.com/library/6f6cc66f-a08e-4f8e-b33a-d3674319248e%28Office.15%29.aspx) (**PR_MDB_PROVIDER**) property to verify the type of store provider.</span></span> <span data-ttu-id="4e1e6-151">Por ejemplo, para comprobar si un almacén es un almacén de Exchange, la propiedad **PidTagStoreProvider** debe devolver un valor representado por la constante **pbExchangeProviderPrimaryUserGuid**, que se define en el archivo de encabezado público edkmdb. h.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-151">For example, to verify whether a store is an Exchange store, the **PidTagStoreProvider** property should return a value represented by the constant **pbExchangeProviderPrimaryUserGuid**, which is defined in the public header file edkmdb.h.</span></span>  <br/> |
   
## <a name="locating-the-appropriate-hidden-message-and-attachment"></a><span data-ttu-id="4e1e6-152">Buscar el mensaje y los datos adjuntos ocultos apropiados</span><span class="sxs-lookup"><span data-stu-id="4e1e6-152">Locating the appropriate hidden message and attachment</span></span>

<span data-ttu-id="4e1e6-153">Ahora que sabemos que el historial de descarga de mensajes de una bandeja de entrada está en la propiedad **PidTagAttachDataBinary** de datos adjuntos en un mensaje oculto, el procedimiento para buscar los datos adjuntos adecuados del mensaje oculto apropiado implica lo siguiente: los</span><span class="sxs-lookup"><span data-stu-id="4e1e6-153">Now that we know the message download history for an Inbox is in the **PidTagAttachDataBinary** property of an attachment to a hidden message, the procedure to locate the appropriate attachment of the appropriate hidden message involves the following procedures:</span></span> 
  
1. [<span data-ttu-id="4e1e6-154">Buscar el mensaje oculto apropiado</span><span class="sxs-lookup"><span data-stu-id="4e1e6-154">Find the appropriate hidden message</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindHiddenMsg)
    
2. [<span data-ttu-id="4e1e6-155">Buscar el archivo adjunto apropiado del mensaje oculto</span><span class="sxs-lookup"><span data-stu-id="4e1e6-155">Find the appropriate attachment of the hidden message</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindAttachment)
    
3. [<span data-ttu-id="4e1e6-156">Obtener acceso a la propiedad PidTagAttachDataBinary de los datos adjuntos del mensaje</span><span class="sxs-lookup"><span data-stu-id="4e1e6-156">Access the PidTagAttachDataBinary property of the message attachment</span></span>](#OL15Con_AuxRef_LocatingMsgsUIDLHistory_AccessProp)

<span data-ttu-id="4e1e6-157"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindHiddenMsg"> </a></span><span class="sxs-lookup"><span data-stu-id="4e1e6-157"></span></span>

### <a name="find-the-appropriate-hidden-message"></a><span data-ttu-id="4e1e6-158">Buscar el mensaje oculto apropiado</span><span class="sxs-lookup"><span data-stu-id="4e1e6-158">Find the appropriate hidden message</span></span>

1. <span data-ttu-id="4e1e6-159">Obtenga la propiedad [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) del perfil, en la sección de perfil especificada por **MUID_PROFILE_INSTANCE**.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-159">Get the [PidTagSearchKey](https://msdn.microsoft.com/library/fcab369a-a1f4-4425-a272-e35046914a4d%28Office.15%29.aspx) (**PR_SEARCH_KEY**) property from the profile, in the profile section specified by **MUID_PROFILE_INSTANCE**.</span></span>
    
2. <span data-ttu-id="4e1e6-160">Abra el contenido asociado a la carpeta Bandeja de entrada llamando a **IMAPIContainer:: GetContentsTable**.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-160">Open the Associated Contents for the Inbox folder by calling **IMAPIContainer::GetContentsTable**.</span></span>
    
3. <span data-ttu-id="4e1e6-161">Cree una restricción basada en las propiedades [PidTagConversationKey](https://msdn.microsoft.com/library/52c97d6c-7f4b-4522-aeac-0c1ed8475952%28Office.15%29.aspx) (**PR_CONVERSATION_KEY**) **, PidTagSearchKey** (**PR_SEARCH_KEY**) y [PidTagMessageClass](https://msdn.microsoft.com/library/1e704023-1992-4b43-857e-0a7da7bc8e87%28Office.15%29.aspx) (**PR_MESSAGE_CLASS**) para obtener una tabla que contiene todos los mensajes ocultos en el contenido asociado de la bandeja de entrada.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-161">Create a restriction based on the [PidTagConversationKey](https://msdn.microsoft.com/library/52c97d6c-7f4b-4522-aeac-0c1ed8475952%28Office.15%29.aspx) (**PR_CONVERSATION_KEY**), **PidTagSearchKey** (**PR_SEARCH_KEY**), and [PidTagMessageClass](https://msdn.microsoft.com/library/1e704023-1992-4b43-857e-0a7da7bc8e87%28Office.15%29.aspx) (**PR_MESSAGE_CLASS**) properties to get a table that contains all the hidden messages in the Associated Contents of the Inbox.</span></span> <span data-ttu-id="4e1e6-162">El siguiente es un ejemplo de una restricción que se extrae [al buscar el historial de UIDL de POP3](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx).</span><span class="sxs-lookup"><span data-stu-id="4e1e6-162">The following is an example of a restriction extracted from [Locating the POP3 UIDL History](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx).</span></span>
    
   ```cpp
      SRestriction rgRes[3]; 
      SPropValue rgProps[3]; 
      rgRes[0].rt = RES_AND; 
      rgRes[0].res.resAnd.cRes = 2; 
      rgRes[0].res.resAnd.lpRes = &amp;rgRes[1]; 
      rgRes[1].rt = RES_PROPERTY; 
      rgRes[1].res.resProperty.relop = RELOP_EQ; 
      rgRes[1].res.resProperty.ulPropTag = PR_CONVERSATION_KEY; 
      rgRes[1].res.resProperty.lpProp = &amp;rgProps[0]; 
      rgRes[2].rt = RES_PROPERTY; 
      rgRes[2].res.resProperty.relop = RELOP_EQ; 
      rgRes[2].res.resProperty.ulPropTag = PR_MESSAGE_CLASS; 
      rgRes[2].res.resProperty.lpProp = &amp;rgProps[1]; 
      rgProps[0].ulPropTag = PR_CONVERSATION_KEY; 
      rgProps[0].Value.bin = pVals[iSearchKey].Value.bin; // PR_SEARCH_KEY from the profile 
      rgProps[1].ulPropTag = PR_MESSAGE_CLASS; 
      rgProps[1].Value.LPSZ = (LPTSTR)"IPM.MessageManager";
   ```

4. <span data-ttu-id="4e1e6-163">En la tabla, busque el mensaje oculto mediante **IMAPITable:: FindRow**.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-163">From the table, find the hidden message by using **IMAPITable::FindRow**.</span></span>
    
5. <span data-ttu-id="4e1e6-164">Si el paso 4 no encuentra un mensaje oculto, cambie la restricción para usar **PidTagSearchKey** (**PR_SEARCH_KEY**) en lugar de **PidTagConversationKey**, tal como se muestra a continuación:</span><span class="sxs-lookup"><span data-stu-id="4e1e6-164">If step 4 fails to find a hidden message, change the restriction to use **PidTagSearchKey** (**PR_SEARCH_KEY**) instead of **PidTagConversationKey**, as shown below:</span></span>
    
   ```cpp
    rgRes[1].res.resProperty.ulPropTag = rgProps[0].ulPropTag = PR_SEARCH_KEY;
   ```

6. <span data-ttu-id="4e1e6-165">Buscar el mensaje oculto mediante **IMAPITable:: FindRow**.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-165">Find the hidden message using **IMAPITable::FindRow**.</span></span> 
    
7. <span data-ttu-id="4e1e6-166">Si se produce un error en el paso 6, cambie la restricción para que use [PidTagSubject](https://msdn.microsoft.com/library/aa7ba4d9-c5e0-4ce7-a34e-65f675223bc9%28Office.15%29.aspx) (**PR_SUBJECT**) sea igual que el `printf` siguiente valor (que se muestra a continuación con sustitución de estilo para mayor brevedad).</span><span class="sxs-lookup"><span data-stu-id="4e1e6-166">If Step 6 fails, change the restriction to use [PidTagSubject](https://msdn.microsoft.com/library/aa7ba4d9-c5e0-4ce7-a34e-65f675223bc9%28Office.15%29.aspx) (**PR_SUBJECT**) being equal to the following value (shown below using  `printf` style substitution for brevity).</span></span> 
    
   ```cpp
    "Outlook Message Manager (%s) (KEY: %s)", PR_PROFILE_NAME, HexFromBin(PR_SEARCH_KEY)
   ```

8. <span data-ttu-id="4e1e6-167">Busque el mensaje oculto mediante **IMAPITable:: FindRow**.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-167">Find the hidden message by using **IMAPITable::FindRow**.</span></span>
    
9. <span data-ttu-id="4e1e6-168">Si está ejecutando Outlook 2010 o una versión posterior, use los siguientes valores para **PidTagProfileName** (**PR_PROFILE_NAME**) y **PidTagSearchKey** (**PR_SEARCH_KEY**), respectivamente.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-168">If you are running Outlook 2010 or a later version, use the following values for **PidTagProfileName** (**PR_PROFILE_NAME**) and **PidTagSearchKey** (**PR_SEARCH_KEY**), respectively.</span></span>
    
   ```cpp
    CHAR g_szGeneralKey[] = "General Key"; 
    const SBinary g_binGeneralKey = {sizeof(g_szGeneralKey), (LPBYTE)g_szGeneralKey};
   ```

   <span data-ttu-id="4e1e6-169">Realice los pasos 3 a 8.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-169">Run through Steps 3 through 8.</span></span> <span data-ttu-id="4e1e6-170">Si no encuentra un mensaje, revierte a los pasos originales 3 a 8.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-170">If this fails to find a message, fall back to the original steps 3 through 8.</span></span>
    
10. <span data-ttu-id="4e1e6-171">Abra el mensaje oculto que se encuentra en el paso 4, 6 u 8.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-171">Open the hidden message found in Step 4, 6, or 8.</span></span>

<span data-ttu-id="4e1e6-172"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_FindAttachment"> </a></span><span class="sxs-lookup"><span data-stu-id="4e1e6-172"></span></span>

### <a name="find-the-appropriate-attachment-of-the-hidden-message"></a><span data-ttu-id="4e1e6-173">Buscar el archivo adjunto apropiado del mensaje oculto</span><span class="sxs-lookup"><span data-stu-id="4e1e6-173">Find the appropriate attachment of the hidden message</span></span>

<span data-ttu-id="4e1e6-174">Como el mensaje oculto puede tener más de un archivo de datos adjuntos, busque el archivo adjunto apropiado en el siguiente orden.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-174">Because the hidden message may have more than one attachment, look for the appropriate attachment in the following order.</span></span>
  
> [!NOTE]
> <span data-ttu-id="4e1e6-175">De nuevo, este procedimiento `printf` usa la sustitución de estilo para mayor brevedad.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-175">This procedure again uses the  `printf` style substitution for brevity.</span></span> 

1. <span data-ttu-id="4e1e6-176">Busque datos adjuntos cuyo [PidTagAttachLongFilename](https://msdn.microsoft.com/library/83b69e8f-0b5a-4992-b5b8-160d3bdfa22a%28Office.15%29.aspx) (**PR_ATTACH_LONG_FILENAME**) coincida con la siguiente cadena `szEmailAddress` , donde es la dirección SMTP del usuario, como se especifica en el perfil del usuario.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-176">Look for an attachment whose [PidTagAttachLongFilename](https://msdn.microsoft.com/library/83b69e8f-0b5a-4992-b5b8-160d3bdfa22a%28Office.15%29.aspx) (**PR_ATTACH_LONG_FILENAME**) matches the following string, where  `szEmailAddress` is the user's SMTP address, as specified in the user's profile.</span></span> <span data-ttu-id="4e1e6-177">.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-177"></span></span> 
    
   ```cpp
    "BlobPOP%s", szEmailAddress
   ```

2. <span data-ttu-id="4e1e6-178">Busque datos adjuntos cuyo [PidTagAttachFilename](https://msdn.microsoft.com/library/cbf34dd6-7733-47f6-9c41-9d82656ca9dc%28Office.15%29.aspx) (**PR_ATTACH_FILENAME**) coincida con "BlobPOP% s `szEmailAddress`",.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-178">Look for an attachment whose [PidTagAttachFilename](https://msdn.microsoft.com/library/cbf34dd6-7733-47f6-9c41-9d82656ca9dc%28Office.15%29.aspx) (**PR_ATTACH_FILENAME**) matches "BlobPOP%s",  `szEmailAddress`.</span></span>
    
3. <span data-ttu-id="4e1e6-179">Busque datos adjuntos cuyo [PidTagDisplayName](https://msdn.microsoft.com/library/bd094e00-5c60-4bb3-9a45-b943fab52876%28Office.15%29.aspx) (**PR_DISPLAY_NAME**) coincida con "BlobPOP% s `szEmailAddress`",.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-179">Look for an attachment whose [PidTagDisplayName](https://msdn.microsoft.com/library/bd094e00-5c60-4bb3-9a45-b943fab52876%28Office.15%29.aspx) (**PR_DISPLAY_NAME**) matches "BlobPOP%s",  `szEmailAddress`.</span></span>
    
4. <span data-ttu-id="4e1e6-180">Busque datos adjuntos cuyo **PidTagAttachFilename** (**PR_ATTACH_FILENAME**) coincida con "BLOB%. 8x `dwAcctUID`", `dwAcctUID` , donde proviene de [PROP_ACCT_MINI_UID](prop_acct_mini_uid.md).</span><span class="sxs-lookup"><span data-stu-id="4e1e6-180">Look for an attachment whose **PidTagAttachFilename** (**PR_ATTACH_FILENAME**) matches "Blob%.8x",  `dwAcctUID`, where  `dwAcctUID` comes from [PROP_ACCT_MINI_UID](prop_acct_mini_uid.md).</span></span> <span data-ttu-id="4e1e6-181">Puede usar el método [IOlkAccount:: GetProp](iolkaccount-getprop.md) para obtener acceso a la propiedad **PROP_ACCT_MINI_UID** .</span><span class="sxs-lookup"><span data-stu-id="4e1e6-181">You can use the [IOlkAccount::GetProp](iolkaccount-getprop.md) method to access the **PROP_ACCT_MINI_UID** property.</span></span> 

<span data-ttu-id="4e1e6-182"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_AccessProp"> </a></span><span class="sxs-lookup"><span data-stu-id="4e1e6-182"></span></span>

### <a name="access-the-pidtagattachdatabinary-property-of-the-message-attachment"></a><span data-ttu-id="4e1e6-183">Obtener acceso a la propiedad PidTagAttachDataBinary de los datos adjuntos del mensaje</span><span class="sxs-lookup"><span data-stu-id="4e1e6-183">Access the PidTagAttachDataBinary property of the message attachment</span></span>

<span data-ttu-id="4e1e6-184">Una vez que haya encontrado el mensaje adjunto al mensaje oculto, use **IMAPIProp:: GetProps** para leer la propiedad **PidTagAttachDataBinary** de los datos adjuntos.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-184">After locating the appropriate message attachment of the hidden message, use **IMAPIProp::GetProps** to read the **PidTagAttachDataBinary** property of the attachment.</span></span> 

<span data-ttu-id="4e1e6-185"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_NextSteps"> </a></span><span class="sxs-lookup"><span data-stu-id="4e1e6-185"></span></span>

## <a name="next-steps"></a><span data-ttu-id="4e1e6-186">Pasos siguientes</span><span class="sxs-lookup"><span data-stu-id="4e1e6-186">Next steps</span></span>

<span data-ttu-id="4e1e6-187">Ha aprendido en este tema cómo buscar el historial de descarga de mensajes de la bandeja de entrada de un cliente de correo POP3.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-187">You have learned from this topic how to locate the message download history for the Inbox of a POP3 mail client.</span></span> <span data-ttu-id="4e1e6-188">Consulte [analizar el historial de descarga de mensajes de una cuenta POP3](parsing-the-message-download-history-for-a-pop3-account.md) para obtener información sobre cómo analizar este historial para identificar los mensajes que se han descargado o eliminado para la bandeja de entrada.</span><span class="sxs-lookup"><span data-stu-id="4e1e6-188">See [Parsing the message download history for a POP3 account](parsing-the-message-download-history-for-a-pop3-account.md) to learn how to parse this history to identify messages that have been downloaded or deleted for the Inbox.</span></span> 

<span data-ttu-id="4e1e6-189"><a name="OL15Con_AuxRef_LocatingMsgsUIDLHistory_AdditionalRsc"> </a></span><span class="sxs-lookup"><span data-stu-id="4e1e6-189"></span></span>

## <a name="see-also"></a><span data-ttu-id="4e1e6-190">Vea también</span><span class="sxs-lookup"><span data-stu-id="4e1e6-190">See also</span></span>

- [<span data-ttu-id="4e1e6-191">Administrar la descarga de mensajes de las cuentas POP3</span><span class="sxs-lookup"><span data-stu-id="4e1e6-191">Managing message downloads for POP3 accounts</span></span>](managing-message-downloads-for-pop3-accounts.md)   
- [<span data-ttu-id="4e1e6-192">Analizar el historial de descarga de mensajes de una cuenta POP3</span><span class="sxs-lookup"><span data-stu-id="4e1e6-192">Parsing the message download history for a POP3 account</span></span>](parsing-the-message-download-history-for-a-pop3-account.md)
- [<span data-ttu-id="4e1e6-193">Buscar el historial de UIDL de POP3</span><span class="sxs-lookup"><span data-stu-id="4e1e6-193">Locating the POP3 UIDL History</span></span>](https://blogs.msdn.com/b/stephen_griffin/archive/2012/12/03/locating-the-pop3-uidl-history.aspx)
    

